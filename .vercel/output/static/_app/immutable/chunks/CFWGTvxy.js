import{g as eu,D as tu,t as nu,a as ru,f as iu}from"./BjvSjcul.js";import"./DsnmJJEf.js";import"./DiPfm8AY.js";import{a as ou}from"./CW0Rmjp7.js";import{p as su}from"./jvGfUjpY.js";function Lp(e,t,r){eu(()=>{var o=tu(()=>t(e,r?.())||{});if(o?.destroy)return()=>o.destroy()})}function vs(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function Fs(e,...t){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(e.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}function au(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");vs(e.outputLen),vs(e.blockLen)}function Ar(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function cu(e,t){Fs(e);const r=t.outputLen;if(e.length<r)throw new Error(`digestInto() expects output buffer of length at least ${r}`)}const Ii=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Vs=e=>e instanceof Uint8Array,Pi=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),ot=(e,t)=>e<<32-t|e>>>t,uu=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!uu)throw new Error("Non little-endian hardware is not supported");function lu(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function no(e){if(typeof e=="string"&&(e=lu(e)),!Vs(e))throw new Error(`expected Uint8Array, got ${typeof e}`);return e}function fu(...e){const t=new Uint8Array(e.reduce((o,s)=>o+s.length,0));let r=0;return e.forEach(o=>{if(!Vs(o))throw new Error("Uint8Array expected");t.set(o,r),r+=o.length}),t}let zs=class{clone(){return this._cloneInto()}};function hu(e){const t=o=>e().update(no(o)).digest(),r=e();return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=()=>e(),t}function Ws(e=32){if(Ii&&typeof Ii.getRandomValues=="function")return Ii.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}function du(e,t,r,o){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,r,o);const s=BigInt(32),c=BigInt(4294967295),f=Number(r>>s&c),d=Number(r&c),h=o?4:0,m=o?0:4;e.setUint32(t+h,f,o),e.setUint32(t+m,d,o)}let pu=class extends zs{constructor(t,r,o,s){super(),this.blockLen=t,this.outputLen=r,this.padOffset=o,this.isLE=s,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=Pi(this.buffer)}update(t){Ar(this);const{view:r,buffer:o,blockLen:s}=this;t=no(t);const c=t.length;for(let f=0;f<c;){const d=Math.min(s-this.pos,c-f);if(d===s){const h=Pi(t);for(;s<=c-f;f+=s)this.process(h,f);continue}o.set(t.subarray(f,f+d),this.pos),this.pos+=d,f+=d,this.pos===s&&(this.process(r,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){Ar(this),cu(t,this),this.finished=!0;const{buffer:r,view:o,blockLen:s,isLE:c}=this;let{pos:f}=this;r[f++]=128,this.buffer.subarray(f).fill(0),this.padOffset>s-f&&(this.process(o,0),f=0);for(let b=f;b<s;b++)r[b]=0;du(o,s-8,BigInt(this.length*8),c),this.process(o,0);const d=Pi(t),h=this.outputLen;if(h%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const m=h/4,v=this.get();if(m>v.length)throw new Error("_sha2: outputLen bigger than state");for(let b=0;b<m;b++)d.setUint32(4*b,v[b],c)}digest(){const{buffer:t,outputLen:r}=this;this.digestInto(t);const o=t.slice(0,r);return this.destroy(),o}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:r,buffer:o,length:s,finished:c,destroyed:f,pos:d}=this;return t.length=s,t.pos=d,t.finished=c,t.destroyed=f,s%r&&t.buffer.set(o),t}};const yu=(e,t,r)=>e&t^~e&r,gu=(e,t,r)=>e&t^e&r^t&r,mu=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Bt=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Ct=new Uint32Array(64);let bu=class extends pu{constructor(){super(64,32,8,!1),this.A=Bt[0]|0,this.B=Bt[1]|0,this.C=Bt[2]|0,this.D=Bt[3]|0,this.E=Bt[4]|0,this.F=Bt[5]|0,this.G=Bt[6]|0,this.H=Bt[7]|0}get(){const{A:t,B:r,C:o,D:s,E:c,F:f,G:d,H:h}=this;return[t,r,o,s,c,f,d,h]}set(t,r,o,s,c,f,d,h){this.A=t|0,this.B=r|0,this.C=o|0,this.D=s|0,this.E=c|0,this.F=f|0,this.G=d|0,this.H=h|0}process(t,r){for(let b=0;b<16;b++,r+=4)Ct[b]=t.getUint32(r,!1);for(let b=16;b<64;b++){const C=Ct[b-15],N=Ct[b-2],L=ot(C,7)^ot(C,18)^C>>>3,O=ot(N,17)^ot(N,19)^N>>>10;Ct[b]=O+Ct[b-7]+L+Ct[b-16]|0}let{A:o,B:s,C:c,D:f,E:d,F:h,G:m,H:v}=this;for(let b=0;b<64;b++){const C=ot(d,6)^ot(d,11)^ot(d,25),N=v+C+yu(d,h,m)+mu[b]+Ct[b]|0,O=(ot(o,2)^ot(o,13)^ot(o,22))+gu(o,s,c)|0;v=m,m=h,h=d,d=f+N|0,f=c,c=s,s=o,o=N+O|0}o=o+this.A|0,s=s+this.B|0,c=c+this.C|0,f=f+this.D|0,d=d+this.E|0,h=h+this.F|0,m=m+this.G|0,v=v+this.H|0,this.set(o,s,c,f,d,h,m,v)}roundClean(){Ct.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const Di=hu(()=>new bu);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */BigInt(0);const vu=BigInt(1),wu=BigInt(2),Cr=e=>e instanceof Uint8Array,Eu=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function En(e){if(!Cr(e))throw new Error("Uint8Array expected");let t="";for(let r=0;r<e.length;r++)t+=Eu[e[r]];return t}function ro(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);return BigInt(e===""?"0":`0x${e}`)}function Hn(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);const t=e.length;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const r=new Uint8Array(t/2);for(let o=0;o<r.length;o++){const s=o*2,c=e.slice(s,s+2),f=Number.parseInt(c,16);if(Number.isNaN(f)||f<0)throw new Error("Invalid byte sequence");r[o]=f}return r}function He(e){return ro(En(e))}function io(e){if(!Cr(e))throw new Error("Uint8Array expected");return ro(En(Uint8Array.from(e).reverse()))}function $t(e,t){return Hn(e.toString(16).padStart(t*2,"0"))}function oo(e,t){return $t(e,t).reverse()}function Ue(e,t,r){let o;if(typeof t=="string")try{o=Hn(t)}catch(c){throw new Error(`${e} must be valid hex string, got "${t}". Cause: ${c}`)}else if(Cr(t))o=Uint8Array.from(t);else throw new Error(`${e} must be hex string or Uint8Array`);const s=o.length;if(typeof r=="number"&&s!==r)throw new Error(`${e} expected ${r} bytes, got ${s}`);return o}function en(...e){const t=new Uint8Array(e.reduce((o,s)=>o+s.length,0));let r=0;return e.forEach(o=>{if(!Cr(o))throw new Error("Uint8Array expected");t.set(o,r),r+=o.length}),t}const so=e=>(wu<<BigInt(e-1))-vu,Oi=e=>new Uint8Array(e),ws=e=>Uint8Array.from(e);function Gs(e,t,r){if(typeof e!="number"||e<2)throw new Error("hashLen must be a number");if(typeof t!="number"||t<2)throw new Error("qByteLen must be a number");if(typeof r!="function")throw new Error("hmacFn must be a function");let o=Oi(e),s=Oi(e),c=0;const f=()=>{o.fill(1),s.fill(0),c=0},d=(...b)=>r(s,o,...b),h=(b=Oi())=>{s=d(ws([0]),b),o=d(),b.length!==0&&(s=d(ws([1]),b),o=d())},m=()=>{if(c++>=1e3)throw new Error("drbg: tried 1000 values");let b=0;const C=[];for(;b<t;){o=d();const N=o.slice();C.push(N),b+=o.length}return en(...C)};return(b,C)=>{f(),h(b);let N;for(;!(N=C(m()));)h();return f(),N}}const xu={bigint:e=>typeof e=="bigint",function:e=>typeof e=="function",boolean:e=>typeof e=="boolean",string:e=>typeof e=="string",stringOrUint8Array:e=>typeof e=="string"||e instanceof Uint8Array,isSafeInteger:e=>Number.isSafeInteger(e),array:e=>Array.isArray(e),field:(e,t)=>t.Fp.isValid(e),hash:e=>typeof e=="function"&&Number.isSafeInteger(e.outputLen)};function Wn(e,t,r={}){const o=(s,c,f)=>{const d=xu[c];if(typeof d!="function")throw new Error(`Invalid validator "${c}", expected function`);const h=e[s];if(!(f&&h===void 0)&&!d(h,e))throw new Error(`Invalid param ${String(s)}=${h} (${typeof h}), expected ${c}`)};for(const[s,c]of Object.entries(t))o(s,c,!1);for(const[s,c]of Object.entries(r))o(s,c,!0);return e}const _u=Object.freeze(Object.defineProperty({__proto__:null,bitMask:so,bytesToHex:En,bytesToNumberBE:He,bytesToNumberLE:io,concatBytes:en,createHmacDrbg:Gs,ensureBytes:Ue,hexToBytes:Hn,hexToNumber:ro,numberToBytesBE:$t,numberToBytesLE:oo,validateObject:Wn},Symbol.toStringTag,{value:"Module"}));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Ne=BigInt(0),Be=BigInt(1),Jt=BigInt(2),ku=BigInt(3),Hi=BigInt(4),Es=BigInt(5),xs=BigInt(8);BigInt(9);BigInt(16);function Me(e,t){const r=e%t;return r>=Ne?r:t+r}function Au(e,t,r){if(r<=Ne||t<Ne)throw new Error("Expected power/modulo > 0");if(r===Be)return Ne;let o=Be;for(;t>Ne;)t&Be&&(o=o*e%r),e=e*e%r,t>>=Be;return o}function Ye(e,t,r){let o=e;for(;t-- >Ne;)o*=o,o%=r;return o}function Fi(e,t){if(e===Ne||t<=Ne)throw new Error(`invert: expected positive integers, got n=${e} mod=${t}`);let r=Me(e,t),o=t,s=Ne,c=Be;for(;r!==Ne;){const d=o/r,h=o%r,m=s-c*d;o=r,r=h,s=c,c=m}if(o!==Be)throw new Error("invert: does not exist");return Me(s,t)}function Su(e){const t=(e-Be)/Jt;let r,o,s;for(r=e-Be,o=0;r%Jt===Ne;r/=Jt,o++);for(s=Jt;s<e&&Au(s,t,e)!==e-Be;s++);if(o===1){const f=(e+Be)/Hi;return function(h,m){const v=h.pow(m,f);if(!h.eql(h.sqr(v),m))throw new Error("Cannot find square root");return v}}const c=(r+Be)/Jt;return function(d,h){if(d.pow(h,t)===d.neg(d.ONE))throw new Error("Cannot find square root");let m=o,v=d.pow(d.mul(d.ONE,s),r),b=d.pow(h,c),C=d.pow(h,r);for(;!d.eql(C,d.ONE);){if(d.eql(C,d.ZERO))return d.ZERO;let N=1;for(let O=d.sqr(C);N<m&&!d.eql(O,d.ONE);N++)O=d.sqr(O);const L=d.pow(v,Be<<BigInt(m-N-1));v=d.sqr(L),b=d.mul(b,L),C=d.mul(C,v),m=N}return b}}function Tu(e){if(e%Hi===ku){const t=(e+Be)/Hi;return function(o,s){const c=o.pow(s,t);if(!o.eql(o.sqr(c),s))throw new Error("Cannot find square root");return c}}if(e%xs===Es){const t=(e-Es)/xs;return function(o,s){const c=o.mul(s,Jt),f=o.pow(c,t),d=o.mul(s,f),h=o.mul(o.mul(d,Jt),f),m=o.mul(d,o.sub(h,o.ONE));if(!o.eql(o.sqr(m),s))throw new Error("Cannot find square root");return m}}return Su(e)}const Iu=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Pu(e){const t={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},r=Iu.reduce((o,s)=>(o[s]="function",o),t);return Wn(e,r)}function Ou(e,t,r){if(r<Ne)throw new Error("Expected power > 0");if(r===Ne)return e.ONE;if(r===Be)return t;let o=e.ONE,s=t;for(;r>Ne;)r&Be&&(o=e.mul(o,s)),s=e.sqr(s),r>>=Be;return o}function Bu(e,t){const r=new Array(t.length),o=t.reduce((c,f,d)=>e.is0(f)?c:(r[d]=c,e.mul(c,f)),e.ONE),s=e.inv(o);return t.reduceRight((c,f,d)=>e.is0(f)?c:(r[d]=e.mul(c,r[d]),e.mul(c,f)),s),r}function Zs(e,t){const r=t!==void 0?t:e.toString(2).length,o=Math.ceil(r/8);return{nBitLength:r,nByteLength:o}}function Cu(e,t,r=!1,o={}){if(e<=Ne)throw new Error(`Expected Field ORDER > 0, got ${e}`);const{nBitLength:s,nByteLength:c}=Zs(e,t);if(c>2048)throw new Error("Field lengths over 2048 bytes are not supported");const f=Tu(e),d=Object.freeze({ORDER:e,BITS:s,BYTES:c,MASK:so(s),ZERO:Ne,ONE:Be,create:h=>Me(h,e),isValid:h=>{if(typeof h!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof h}`);return Ne<=h&&h<e},is0:h=>h===Ne,isOdd:h=>(h&Be)===Be,neg:h=>Me(-h,e),eql:(h,m)=>h===m,sqr:h=>Me(h*h,e),add:(h,m)=>Me(h+m,e),sub:(h,m)=>Me(h-m,e),mul:(h,m)=>Me(h*m,e),pow:(h,m)=>Ou(d,h,m),div:(h,m)=>Me(h*Fi(m,e),e),sqrN:h=>h*h,addN:(h,m)=>h+m,subN:(h,m)=>h-m,mulN:(h,m)=>h*m,inv:h=>Fi(h,e),sqrt:o.sqrt||(h=>f(d,h)),invertBatch:h=>Bu(d,h),cmov:(h,m,v)=>v?m:h,toBytes:h=>r?oo(h,c):$t(h,c),fromBytes:h=>{if(h.length!==c)throw new Error(`Fp.fromBytes: expected ${c}, got ${h.length}`);return r?io(h):He(h)}});return Object.freeze(d)}function Ys(e){if(typeof e!="bigint")throw new Error("field order must be bigint");const t=e.toString(2).length;return Math.ceil(t/8)}function Js(e){const t=Ys(e);return t+Math.ceil(t/2)}function Ru(e,t,r=!1){const o=e.length,s=Ys(t),c=Js(t);if(o<16||o<c||o>1024)throw new Error(`expected ${c}-1024 bytes of input, got ${o}`);const f=r?He(e):io(e),d=Me(f,t-Be)+Be;return r?oo(d,s):$t(d,s)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Lu=BigInt(0),Bi=BigInt(1);function Nu(e,t){const r=(s,c)=>{const f=c.negate();return s?f:c},o=s=>{const c=Math.ceil(t/s)+1,f=2**(s-1);return{windows:c,windowSize:f}};return{constTimeNegate:r,unsafeLadder(s,c){let f=e.ZERO,d=s;for(;c>Lu;)c&Bi&&(f=f.add(d)),d=d.double(),c>>=Bi;return f},precomputeWindow(s,c){const{windows:f,windowSize:d}=o(c),h=[];let m=s,v=m;for(let b=0;b<f;b++){v=m,h.push(v);for(let C=1;C<d;C++)v=v.add(m),h.push(v);m=v.double()}return h},wNAF(s,c,f){const{windows:d,windowSize:h}=o(s);let m=e.ZERO,v=e.BASE;const b=BigInt(2**s-1),C=2**s,N=BigInt(s);for(let L=0;L<d;L++){const O=L*h;let R=Number(f&b);f>>=N,R>h&&(R-=C,f+=Bi);const $=O,F=O+Math.abs(R)-1,ee=L%2!==0,se=R<0;R===0?v=v.add(r(ee,c[$])):m=m.add(r(se,c[F]))}return{p:m,f:v}},wNAFCached(s,c,f,d){const h=s._WINDOW_SIZE||1;let m=c.get(s);return m||(m=this.precomputeWindow(s,h),h!==1&&c.set(s,d(m))),this.wNAF(h,m,f)}}}function Xs(e){return Pu(e.Fp),Wn(e,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...Zs(e.n,e.nBitLength),...e,p:e.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Mu(e){const t=Xs(e);Wn(t,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:r,Fp:o,a:s}=t;if(r){if(!o.eql(s,o.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof r!="object"||typeof r.beta!="bigint"||typeof r.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...t})}const{bytesToNumberBE:$u,hexToBytes:Uu}=_u,Qt={Err:class extends Error{constructor(t=""){super(t)}},_parseInt(e){const{Err:t}=Qt;if(e.length<2||e[0]!==2)throw new t("Invalid signature integer tag");const r=e[1],o=e.subarray(2,r+2);if(!r||o.length!==r)throw new t("Invalid signature integer: wrong length");if(o[0]&128)throw new t("Invalid signature integer: negative");if(o[0]===0&&!(o[1]&128))throw new t("Invalid signature integer: unnecessary leading zero");return{d:$u(o),l:e.subarray(r+2)}},toSig(e){const{Err:t}=Qt,r=typeof e=="string"?Uu(e):e;if(!(r instanceof Uint8Array))throw new Error("ui8a expected");let o=r.length;if(o<2||r[0]!=48)throw new t("Invalid signature tag");if(r[1]!==o-2)throw new t("Invalid signature: incorrect length");const{d:s,l:c}=Qt._parseInt(r.subarray(2)),{d:f,l:d}=Qt._parseInt(c);if(d.length)throw new t("Invalid signature: left bytes after parsing");return{r:s,s:f}},hexFromSig(e){const t=m=>Number.parseInt(m[0],16)&8?"00"+m:m,r=m=>{const v=m.toString(16);return v.length&1?`0${v}`:v},o=t(r(e.s)),s=t(r(e.r)),c=o.length/2,f=s.length/2,d=r(c),h=r(f);return`30${r(f+c+4)}02${h}${s}02${d}${o}`}},mt=BigInt(0),Je=BigInt(1);BigInt(2);const _s=BigInt(3);BigInt(4);function Ku(e){const t=Mu(e),{Fp:r}=t,o=t.toBytes||((L,O,R)=>{const $=O.toAffine();return en(Uint8Array.from([4]),r.toBytes($.x),r.toBytes($.y))}),s=t.fromBytes||(L=>{const O=L.subarray(1),R=r.fromBytes(O.subarray(0,r.BYTES)),$=r.fromBytes(O.subarray(r.BYTES,2*r.BYTES));return{x:R,y:$}});function c(L){const{a:O,b:R}=t,$=r.sqr(L),F=r.mul($,L);return r.add(r.add(F,r.mul(L,O)),R)}if(!r.eql(r.sqr(t.Gy),c(t.Gx)))throw new Error("bad generator point: equation left != right");function f(L){return typeof L=="bigint"&&mt<L&&L<t.n}function d(L){if(!f(L))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function h(L){const{allowedPrivateKeyLengths:O,nByteLength:R,wrapPrivateKey:$,n:F}=t;if(O&&typeof L!="bigint"){if(L instanceof Uint8Array&&(L=En(L)),typeof L!="string"||!O.includes(L.length))throw new Error("Invalid key");L=L.padStart(R*2,"0")}let ee;try{ee=typeof L=="bigint"?L:He(Ue("private key",L,R))}catch{throw new Error(`private key must be ${R} bytes, hex or bigint, not ${typeof L}`)}return $&&(ee=Me(ee,F)),d(ee),ee}const m=new Map;function v(L){if(!(L instanceof b))throw new Error("ProjectivePoint expected")}class b{constructor(O,R,$){if(this.px=O,this.py=R,this.pz=$,O==null||!r.isValid(O))throw new Error("x required");if(R==null||!r.isValid(R))throw new Error("y required");if($==null||!r.isValid($))throw new Error("z required")}static fromAffine(O){const{x:R,y:$}=O||{};if(!O||!r.isValid(R)||!r.isValid($))throw new Error("invalid affine point");if(O instanceof b)throw new Error("projective point not allowed");const F=ee=>r.eql(ee,r.ZERO);return F(R)&&F($)?b.ZERO:new b(R,$,r.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(O){const R=r.invertBatch(O.map($=>$.pz));return O.map(($,F)=>$.toAffine(R[F])).map(b.fromAffine)}static fromHex(O){const R=b.fromAffine(s(Ue("pointHex",O)));return R.assertValidity(),R}static fromPrivateKey(O){return b.BASE.multiply(h(O))}_setWindowSize(O){this._WINDOW_SIZE=O,m.delete(this)}assertValidity(){if(this.is0()){if(t.allowInfinityPoint&&!r.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:O,y:R}=this.toAffine();if(!r.isValid(O)||!r.isValid(R))throw new Error("bad point: x or y not FE");const $=r.sqr(R),F=c(O);if(!r.eql($,F))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:O}=this.toAffine();if(r.isOdd)return!r.isOdd(O);throw new Error("Field doesn't support isOdd")}equals(O){v(O);const{px:R,py:$,pz:F}=this,{px:ee,py:se,pz:ce}=O,z=r.eql(r.mul(R,ce),r.mul(ee,F)),Z=r.eql(r.mul($,ce),r.mul(se,F));return z&&Z}negate(){return new b(this.px,r.neg(this.py),this.pz)}double(){const{a:O,b:R}=t,$=r.mul(R,_s),{px:F,py:ee,pz:se}=this;let ce=r.ZERO,z=r.ZERO,Z=r.ZERO,te=r.mul(F,F),xe=r.mul(ee,ee),le=r.mul(se,se),ae=r.mul(F,ee);return ae=r.add(ae,ae),Z=r.mul(F,se),Z=r.add(Z,Z),ce=r.mul(O,Z),z=r.mul($,le),z=r.add(ce,z),ce=r.sub(xe,z),z=r.add(xe,z),z=r.mul(ce,z),ce=r.mul(ae,ce),Z=r.mul($,Z),le=r.mul(O,le),ae=r.sub(te,le),ae=r.mul(O,ae),ae=r.add(ae,Z),Z=r.add(te,te),te=r.add(Z,te),te=r.add(te,le),te=r.mul(te,ae),z=r.add(z,te),le=r.mul(ee,se),le=r.add(le,le),te=r.mul(le,ae),ce=r.sub(ce,te),Z=r.mul(le,xe),Z=r.add(Z,Z),Z=r.add(Z,Z),new b(ce,z,Z)}add(O){v(O);const{px:R,py:$,pz:F}=this,{px:ee,py:se,pz:ce}=O;let z=r.ZERO,Z=r.ZERO,te=r.ZERO;const xe=t.a,le=r.mul(t.b,_s);let ae=r.mul(R,ee),me=r.mul($,se),pe=r.mul(F,ce),Ae=r.add(R,$),q=r.add(ee,se);Ae=r.mul(Ae,q),q=r.add(ae,me),Ae=r.sub(Ae,q),q=r.add(R,F);let V=r.add(ee,ce);return q=r.mul(q,V),V=r.add(ae,pe),q=r.sub(q,V),V=r.add($,F),z=r.add(se,ce),V=r.mul(V,z),z=r.add(me,pe),V=r.sub(V,z),te=r.mul(xe,q),z=r.mul(le,pe),te=r.add(z,te),z=r.sub(me,te),te=r.add(me,te),Z=r.mul(z,te),me=r.add(ae,ae),me=r.add(me,ae),pe=r.mul(xe,pe),q=r.mul(le,q),me=r.add(me,pe),pe=r.sub(ae,pe),pe=r.mul(xe,pe),q=r.add(q,pe),ae=r.mul(me,q),Z=r.add(Z,ae),ae=r.mul(V,q),z=r.mul(Ae,z),z=r.sub(z,ae),ae=r.mul(Ae,me),te=r.mul(V,te),te=r.add(te,ae),new b(z,Z,te)}subtract(O){return this.add(O.negate())}is0(){return this.equals(b.ZERO)}wNAF(O){return N.wNAFCached(this,m,O,R=>{const $=r.invertBatch(R.map(F=>F.pz));return R.map((F,ee)=>F.toAffine($[ee])).map(b.fromAffine)})}multiplyUnsafe(O){const R=b.ZERO;if(O===mt)return R;if(d(O),O===Je)return this;const{endo:$}=t;if(!$)return N.unsafeLadder(this,O);let{k1neg:F,k1:ee,k2neg:se,k2:ce}=$.splitScalar(O),z=R,Z=R,te=this;for(;ee>mt||ce>mt;)ee&Je&&(z=z.add(te)),ce&Je&&(Z=Z.add(te)),te=te.double(),ee>>=Je,ce>>=Je;return F&&(z=z.negate()),se&&(Z=Z.negate()),Z=new b(r.mul(Z.px,$.beta),Z.py,Z.pz),z.add(Z)}multiply(O){d(O);let R=O,$,F;const{endo:ee}=t;if(ee){const{k1neg:se,k1:ce,k2neg:z,k2:Z}=ee.splitScalar(R);let{p:te,f:xe}=this.wNAF(ce),{p:le,f:ae}=this.wNAF(Z);te=N.constTimeNegate(se,te),le=N.constTimeNegate(z,le),le=new b(r.mul(le.px,ee.beta),le.py,le.pz),$=te.add(le),F=xe.add(ae)}else{const{p:se,f:ce}=this.wNAF(R);$=se,F=ce}return b.normalizeZ([$,F])[0]}multiplyAndAddUnsafe(O,R,$){const F=b.BASE,ee=(ce,z)=>z===mt||z===Je||!ce.equals(F)?ce.multiplyUnsafe(z):ce.multiply(z),se=ee(this,R).add(ee(O,$));return se.is0()?void 0:se}toAffine(O){const{px:R,py:$,pz:F}=this,ee=this.is0();O==null&&(O=ee?r.ONE:r.inv(F));const se=r.mul(R,O),ce=r.mul($,O),z=r.mul(F,O);if(ee)return{x:r.ZERO,y:r.ZERO};if(!r.eql(z,r.ONE))throw new Error("invZ was invalid");return{x:se,y:ce}}isTorsionFree(){const{h:O,isTorsionFree:R}=t;if(O===Je)return!0;if(R)return R(b,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:O,clearCofactor:R}=t;return O===Je?this:R?R(b,this):this.multiplyUnsafe(t.h)}toRawBytes(O=!0){return this.assertValidity(),o(b,this,O)}toHex(O=!0){return En(this.toRawBytes(O))}}b.BASE=new b(t.Gx,t.Gy,r.ONE),b.ZERO=new b(r.ZERO,r.ONE,r.ZERO);const C=t.nBitLength,N=Nu(b,t.endo?Math.ceil(C/2):C);return{CURVE:t,ProjectivePoint:b,normPrivateKeyToScalar:h,weierstrassEquation:c,isWithinCurveOrder:f}}function qu(e){const t=Xs(e);return Wn(t,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...t})}function ju(e){const t=qu(e),{Fp:r,n:o}=t,s=r.BYTES+1,c=2*r.BYTES+1;function f(q){return mt<q&&q<r.ORDER}function d(q){return Me(q,o)}function h(q){return Fi(q,o)}const{ProjectivePoint:m,normPrivateKeyToScalar:v,weierstrassEquation:b,isWithinCurveOrder:C}=Ku({...t,toBytes(q,V,ne){const oe=V.toAffine(),ie=r.toBytes(oe.x),ue=en;return ne?ue(Uint8Array.from([V.hasEvenY()?2:3]),ie):ue(Uint8Array.from([4]),ie,r.toBytes(oe.y))},fromBytes(q){const V=q.length,ne=q[0],oe=q.subarray(1);if(V===s&&(ne===2||ne===3)){const ie=He(oe);if(!f(ie))throw new Error("Point is not on curve");const ue=b(ie);let Ee=r.sqrt(ue);const fe=(Ee&Je)===Je;return(ne&1)===1!==fe&&(Ee=r.neg(Ee)),{x:ie,y:Ee}}else if(V===c&&ne===4){const ie=r.fromBytes(oe.subarray(0,r.BYTES)),ue=r.fromBytes(oe.subarray(r.BYTES,2*r.BYTES));return{x:ie,y:ue}}else throw new Error(`Point of length ${V} was invalid. Expected ${s} compressed bytes or ${c} uncompressed bytes`)}}),N=q=>En($t(q,t.nByteLength));function L(q){const V=o>>Je;return q>V}function O(q){return L(q)?d(-q):q}const R=(q,V,ne)=>He(q.slice(V,ne));class ${constructor(V,ne,oe){this.r=V,this.s=ne,this.recovery=oe,this.assertValidity()}static fromCompact(V){const ne=t.nByteLength;return V=Ue("compactSignature",V,ne*2),new $(R(V,0,ne),R(V,ne,2*ne))}static fromDER(V){const{r:ne,s:oe}=Qt.toSig(Ue("DER",V));return new $(ne,oe)}assertValidity(){if(!C(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!C(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(V){return new $(this.r,this.s,V)}recoverPublicKey(V){const{r:ne,s:oe,recovery:ie}=this,ue=Z(Ue("msgHash",V));if(ie==null||![0,1,2,3].includes(ie))throw new Error("recovery id invalid");const Ee=ie===2||ie===3?ne+t.n:ne;if(Ee>=r.ORDER)throw new Error("recovery id 2 or 3 invalid");const fe=(ie&1)===0?"02":"03",Fe=m.fromHex(fe+N(Ee)),je=h(Ee),ft=d(-ue*je),et=d(oe*je),De=m.BASE.multiplyAndAddUnsafe(Fe,ft,et);if(!De)throw new Error("point at infinify");return De.assertValidity(),De}hasHighS(){return L(this.s)}normalizeS(){return this.hasHighS()?new $(this.r,d(-this.s),this.recovery):this}toDERRawBytes(){return Hn(this.toDERHex())}toDERHex(){return Qt.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return Hn(this.toCompactHex())}toCompactHex(){return N(this.r)+N(this.s)}}const F={isValidPrivateKey(q){try{return v(q),!0}catch{return!1}},normPrivateKeyToScalar:v,randomPrivateKey:()=>{const q=Js(t.n);return Ru(t.randomBytes(q),t.n)},precompute(q=8,V=m.BASE){return V._setWindowSize(q),V.multiply(BigInt(3)),V}};function ee(q,V=!0){return m.fromPrivateKey(q).toRawBytes(V)}function se(q){const V=q instanceof Uint8Array,ne=typeof q=="string",oe=(V||ne)&&q.length;return V?oe===s||oe===c:ne?oe===2*s||oe===2*c:q instanceof m}function ce(q,V,ne=!0){if(se(q))throw new Error("first arg must be private key");if(!se(V))throw new Error("second arg must be public key");return m.fromHex(V).multiply(v(q)).toRawBytes(ne)}const z=t.bits2int||function(q){const V=He(q),ne=q.length*8-t.nBitLength;return ne>0?V>>BigInt(ne):V},Z=t.bits2int_modN||function(q){return d(z(q))},te=so(t.nBitLength);function xe(q){if(typeof q!="bigint")throw new Error("bigint expected");if(!(mt<=q&&q<te))throw new Error(`bigint expected < 2^${t.nBitLength}`);return $t(q,t.nByteLength)}function le(q,V,ne=ae){if(["recovered","canonical"].some(ht=>ht in ne))throw new Error("sign() legacy options not supported");const{hash:oe,randomBytes:ie}=t;let{lowS:ue,prehash:Ee,extraEntropy:fe}=ne;ue==null&&(ue=!0),q=Ue("msgHash",q),Ee&&(q=Ue("prehashed msgHash",oe(q)));const Fe=Z(q),je=v(V),ft=[xe(je),xe(Fe)];if(fe!=null){const ht=fe===!0?ie(r.BYTES):fe;ft.push(Ue("extraEntropy",ht))}const et=en(...ft),De=Fe;function Kt(ht){const X=z(ht);if(!C(X))return;const Sn=h(X),he=m.BASE.multiply(X).toAffine(),Ge=d(he.x);if(Ge===mt)return;const on=d(Sn*d(De+Ge*je));if(on===mt)return;let tt=(he.x===Ge?0:2)|Number(he.y&Je),Gn=on;return ue&&L(on)&&(Gn=O(on),tt^=1),new $(Ge,Gn,tt)}return{seed:et,k2sig:Kt}}const ae={lowS:t.lowS,prehash:!1},me={lowS:t.lowS,prehash:!1};function pe(q,V,ne=ae){const{seed:oe,k2sig:ie}=le(q,V,ne),ue=t;return Gs(ue.hash.outputLen,ue.nByteLength,ue.hmac)(oe,ie)}m.BASE._setWindowSize(8);function Ae(q,V,ne,oe=me){const ie=q;if(V=Ue("msgHash",V),ne=Ue("publicKey",ne),"strict"in oe)throw new Error("options.strict was renamed to lowS");const{lowS:ue,prehash:Ee}=oe;let fe,Fe;try{if(typeof ie=="string"||ie instanceof Uint8Array)try{fe=$.fromDER(ie)}catch(he){if(!(he instanceof Qt.Err))throw he;fe=$.fromCompact(ie)}else if(typeof ie=="object"&&typeof ie.r=="bigint"&&typeof ie.s=="bigint"){const{r:he,s:Ge}=ie;fe=new $(he,Ge)}else throw new Error("PARSE");Fe=m.fromHex(ne)}catch(he){if(he.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(ue&&fe.hasHighS())return!1;Ee&&(V=t.hash(V));const{r:je,s:ft}=fe,et=Z(V),De=h(ft),Kt=d(et*De),ht=d(je*De),X=m.BASE.multiplyAndAddUnsafe(Fe,Kt,ht)?.toAffine();return X?d(X.x)===je:!1}return{CURVE:t,getPublicKey:ee,getSharedSecret:ce,sign:pe,verify:Ae,ProjectivePoint:m,Signature:$,utils:F}}let Qs=class extends zs{constructor(t,r){super(),this.finished=!1,this.destroyed=!1,au(t);const o=no(r);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const s=this.blockLen,c=new Uint8Array(s);c.set(o.length>s?t.create().update(o).digest():o);for(let f=0;f<c.length;f++)c[f]^=54;this.iHash.update(c),this.oHash=t.create();for(let f=0;f<c.length;f++)c[f]^=106;this.oHash.update(c),c.fill(0)}update(t){return Ar(this),this.iHash.update(t),this}digestInto(t){Ar(this),Fs(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:r,iHash:o,finished:s,destroyed:c,blockLen:f,outputLen:d}=this;return t=t,t.finished=s,t.destroyed=c,t.blockLen=f,t.outputLen=d,t.oHash=r._cloneInto(t.oHash),t.iHash=o._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const ea=(e,t,r)=>new Qs(e,t).update(r).digest();ea.create=(e,t)=>new Qs(e,t);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Du(e){return{hash:e,hmac:(t,...r)=>ea(e,t,fu(...r)),randomBytes:Ws}}function Hu(e,t){const r=o=>ju({...e,...Du(o)});return Object.freeze({...r(t),create:r})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Rr=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),Sr=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),ta=BigInt(1),Tr=BigInt(2),ks=(e,t)=>(e+t/Tr)/t;function na(e){const t=Rr,r=BigInt(3),o=BigInt(6),s=BigInt(11),c=BigInt(22),f=BigInt(23),d=BigInt(44),h=BigInt(88),m=e*e*e%t,v=m*m*e%t,b=Ye(v,r,t)*v%t,C=Ye(b,r,t)*v%t,N=Ye(C,Tr,t)*m%t,L=Ye(N,s,t)*N%t,O=Ye(L,c,t)*L%t,R=Ye(O,d,t)*O%t,$=Ye(R,h,t)*R%t,F=Ye($,d,t)*O%t,ee=Ye(F,r,t)*v%t,se=Ye(ee,f,t)*L%t,ce=Ye(se,o,t)*m%t,z=Ye(ce,Tr,t);if(!Vi.eql(Vi.sqr(z),e))throw new Error("Cannot find square root");return z}const Vi=Cu(Rr,void 0,void 0,{sqrt:na}),kn=Hu({a:BigInt(0),b:BigInt(7),Fp:Vi,n:Sr,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:e=>{const t=Sr,r=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),o=-ta*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),s=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),c=r,f=BigInt("0x100000000000000000000000000000000"),d=ks(c*e,t),h=ks(-o*e,t);let m=Me(e-d*r-h*s,t),v=Me(-d*o-h*c,t);const b=m>f,C=v>f;if(b&&(m=t-m),C&&(v=t-v),m>f||v>f)throw new Error("splitScalar: Endomorphism failed, k="+e);return{k1neg:b,k1:m,k2neg:C,k2:v}}}},Di),Lr=BigInt(0),ra=e=>typeof e=="bigint"&&Lr<e&&e<Rr,Fu=e=>typeof e=="bigint"&&Lr<e&&e<Sr,As={};function Ir(e,...t){let r=As[e];if(r===void 0){const o=Di(Uint8Array.from(e,s=>s.charCodeAt(0)));r=en(o,o),As[e]=r}return Di(en(r,...t))}const ao=e=>e.toRawBytes(!0).slice(1),zi=e=>$t(e,32),Ci=e=>Me(e,Rr),Fn=e=>Me(e,Sr),co=kn.ProjectivePoint,Vu=(e,t,r)=>co.BASE.multiplyAndAddUnsafe(e,t,r);function Wi(e){let t=kn.utils.normPrivateKeyToScalar(e),r=co.fromPrivateKey(t);return{scalar:r.hasEvenY()?t:Fn(-t),bytes:ao(r)}}function ia(e){if(!ra(e))throw new Error("bad x: need 0 < x < p");const t=Ci(e*e),r=Ci(t*e+BigInt(7));let o=na(r);o%Tr!==Lr&&(o=Ci(-o));const s=new co(e,o,ta);return s.assertValidity(),s}function oa(...e){return Fn(He(Ir("BIP0340/challenge",...e)))}function zu(e){return Wi(e).bytes}function Wu(e,t,r=Ws(32)){const o=Ue("message",e),{bytes:s,scalar:c}=Wi(t),f=Ue("auxRand",r,32),d=zi(c^He(Ir("BIP0340/aux",f))),h=Ir("BIP0340/nonce",d,s,o),m=Fn(He(h));if(m===Lr)throw new Error("sign failed: k is zero");const{bytes:v,scalar:b}=Wi(m),C=oa(v,s,o),N=new Uint8Array(64);if(N.set(v,0),N.set(zi(Fn(b+C*c)),32),!sa(N,o,s))throw new Error("sign: Invalid signature produced");return N}function sa(e,t,r){const o=Ue("signature",e,64),s=Ue("message",t),c=Ue("publicKey",r,32);try{const f=ia(He(c)),d=He(o.subarray(0,32));if(!ra(d))return!1;const h=He(o.subarray(32,64));if(!Fu(h))return!1;const m=oa(zi(d),ao(f),s),v=Vu(f,h,Fn(-m));return!(!v||!v.hasEvenY()||v.toAffine().x!==d)}catch{return!1}}const qn={getPublicKey:zu,sign:Wu,verify:sa,utils:{randomPrivateKey:kn.utils.randomPrivateKey,lift_x:ia,pointToBytes:ao,numberToBytesBE:$t,bytesToNumberBE:He,taggedHash:Ir,mod:Me}},Ri=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const uo=e=>e instanceof Uint8Array,Li=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),st=(e,t)=>e<<32-t|e>>>t,Gu=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!Gu)throw new Error("Non little-endian hardware is not supported");const Zu=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function Ke(e){if(!uo(e))throw new Error("Uint8Array expected");let t="";for(let r=0;r<e.length;r++)t+=Zu[e[r]];return t}function tn(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);const t=e.length;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const r=new Uint8Array(t/2);for(let o=0;o<r.length;o++){const s=o*2,c=e.slice(s,s+2),f=Number.parseInt(c,16);if(Number.isNaN(f)||f<0)throw new Error("Invalid byte sequence");r[o]=f}return r}function Yu(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function Vn(e){if(typeof e=="string"&&(e=Yu(e)),!uo(e))throw new Error(`expected Uint8Array, got ${typeof e}`);return e}function Nr(...e){const t=new Uint8Array(e.reduce((o,s)=>o+s.length,0));let r=0;return e.forEach(o=>{if(!uo(o))throw new Error("Uint8Array expected");t.set(o,r),r+=o.length}),t}class aa{clone(){return this._cloneInto()}}function ca(e){const t=o=>e().update(Vn(o)).digest(),r=e();return t.outputLen=r.outputLen,t.blockLen=r.blockLen,t.create=()=>e(),t}function ua(e=32){if(Ri&&typeof Ri.getRandomValues=="function")return Ri.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}function Gi(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function Ju(e){if(typeof e!="boolean")throw new Error(`Expected boolean, not ${e}`)}function la(e,...t){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(e.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}function Xu(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Gi(e.outputLen),Gi(e.blockLen)}function Qu(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function el(e,t){la(e);const r=t.outputLen;if(e.length<r)throw new Error(`digestInto() expects output buffer of length at least ${r}`)}const at={number:Gi,bool:Ju,bytes:la,hash:Xu,exists:Qu,output:el};function tl(e,t,r,o){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,r,o);const s=BigInt(32),c=BigInt(4294967295),f=Number(r>>s&c),d=Number(r&c),h=o?4:0,m=o?0:4;e.setUint32(t+h,f,o),e.setUint32(t+m,d,o)}class nl extends aa{constructor(t,r,o,s){super(),this.blockLen=t,this.outputLen=r,this.padOffset=o,this.isLE=s,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=Li(this.buffer)}update(t){at.exists(this);const{view:r,buffer:o,blockLen:s}=this;t=Vn(t);const c=t.length;for(let f=0;f<c;){const d=Math.min(s-this.pos,c-f);if(d===s){const h=Li(t);for(;s<=c-f;f+=s)this.process(h,f);continue}o.set(t.subarray(f,f+d),this.pos),this.pos+=d,f+=d,this.pos===s&&(this.process(r,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){at.exists(this),at.output(t,this),this.finished=!0;const{buffer:r,view:o,blockLen:s,isLE:c}=this;let{pos:f}=this;r[f++]=128,this.buffer.subarray(f).fill(0),this.padOffset>s-f&&(this.process(o,0),f=0);for(let b=f;b<s;b++)r[b]=0;tl(o,s-8,BigInt(this.length*8),c),this.process(o,0);const d=Li(t),h=this.outputLen;if(h%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const m=h/4,v=this.get();if(m>v.length)throw new Error("_sha2: outputLen bigger than state");for(let b=0;b<m;b++)d.setUint32(4*b,v[b],c)}digest(){const{buffer:t,outputLen:r}=this;this.digestInto(t);const o=t.slice(0,r);return this.destroy(),o}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:r,buffer:o,length:s,finished:c,destroyed:f,pos:d}=this;return t.length=s,t.pos=d,t.finished=c,t.destroyed=f,s%r&&t.buffer.set(o),t}}const rl=(e,t,r)=>e&t^~e&r,il=(e,t,r)=>e&t^e&r^t&r,ol=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Rt=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Lt=new Uint32Array(64);class fa extends nl{constructor(){super(64,32,8,!1),this.A=Rt[0]|0,this.B=Rt[1]|0,this.C=Rt[2]|0,this.D=Rt[3]|0,this.E=Rt[4]|0,this.F=Rt[5]|0,this.G=Rt[6]|0,this.H=Rt[7]|0}get(){const{A:t,B:r,C:o,D:s,E:c,F:f,G:d,H:h}=this;return[t,r,o,s,c,f,d,h]}set(t,r,o,s,c,f,d,h){this.A=t|0,this.B=r|0,this.C=o|0,this.D=s|0,this.E=c|0,this.F=f|0,this.G=d|0,this.H=h|0}process(t,r){for(let b=0;b<16;b++,r+=4)Lt[b]=t.getUint32(r,!1);for(let b=16;b<64;b++){const C=Lt[b-15],N=Lt[b-2],L=st(C,7)^st(C,18)^C>>>3,O=st(N,17)^st(N,19)^N>>>10;Lt[b]=O+Lt[b-7]+L+Lt[b-16]|0}let{A:o,B:s,C:c,D:f,E:d,F:h,G:m,H:v}=this;for(let b=0;b<64;b++){const C=st(d,6)^st(d,11)^st(d,25),N=v+C+rl(d,h,m)+ol[b]+Lt[b]|0,O=(st(o,2)^st(o,13)^st(o,22))+il(o,s,c)|0;v=m,m=h,h=d,d=f+N|0,f=c,c=s,s=o,o=N+O|0}o=o+this.A|0,s=s+this.B|0,c=c+this.C|0,f=f+this.D|0,d=d+this.E|0,h=h+this.F|0,m=m+this.G|0,v=v+this.H|0,this.set(o,s,c,f,d,h,m,v)}roundClean(){Lt.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}class sl extends fa{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}const rn=ca(()=>new fa);ca(()=>new sl);/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function An(e){if(!Number.isSafeInteger(e))throw new Error(`Wrong integer: ${e}`)}function Et(...e){const t=(s,c)=>f=>s(c(f)),r=Array.from(e).reverse().reduce((s,c)=>s?t(s,c.encode):c.encode,void 0),o=e.reduce((s,c)=>s?t(s,c.decode):c.decode,void 0);return{encode:r,decode:o}}function xt(e){return{encode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return t.map(r=>{if(An(r),r<0||r>=e.length)throw new Error(`Digit index outside alphabet: ${r} (alphabet: ${e.length})`);return e[r]})},decode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="string")throw new Error("alphabet.decode input should be array of strings");return t.map(r=>{if(typeof r!="string")throw new Error(`alphabet.decode: not string element=${r}`);const o=e.indexOf(r);if(o===-1)throw new Error(`Unknown letter: "${r}". Allowed: ${e}`);return o})}}}function _t(e=""){if(typeof e!="string")throw new Error("join separator should be string");return{encode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="string")throw new Error("join.encode input should be array of strings");for(let r of t)if(typeof r!="string")throw new Error(`join.encode: non-string input=${r}`);return t.join(e)},decode:t=>{if(typeof t!="string")throw new Error("join.decode input should be string");return t.split(e)}}}function Mr(e,t="="){if(An(e),typeof t!="string")throw new Error("padding chr should be string");return{encode(r){if(!Array.isArray(r)||r.length&&typeof r[0]!="string")throw new Error("padding.encode input should be array of strings");for(let o of r)if(typeof o!="string")throw new Error(`padding.encode: non-string input=${o}`);for(;r.length*e%8;)r.push(t);return r},decode(r){if(!Array.isArray(r)||r.length&&typeof r[0]!="string")throw new Error("padding.encode input should be array of strings");for(let s of r)if(typeof s!="string")throw new Error(`padding.decode: non-string input=${s}`);let o=r.length;if(o*e%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;o>0&&r[o-1]===t;o--)if(!((o-1)*e%8))throw new Error("Invalid padding: string has too much padding");return r.slice(0,o)}}}function ha(e){if(typeof e!="function")throw new Error("normalize fn should be function");return{encode:t=>t,decode:t=>e(t)}}function Ss(e,t,r){if(t<2)throw new Error(`convertRadix: wrong from=${t}, base cannot be less than 2`);if(r<2)throw new Error(`convertRadix: wrong to=${r}, base cannot be less than 2`);if(!Array.isArray(e))throw new Error("convertRadix: data should be array");if(!e.length)return[];let o=0;const s=[],c=Array.from(e);for(c.forEach(f=>{if(An(f),f<0||f>=t)throw new Error(`Wrong integer: ${f}`)});;){let f=0,d=!0;for(let h=o;h<c.length;h++){const m=c[h],v=t*f+m;if(!Number.isSafeInteger(v)||t*f/t!==f||v-m!==t*f)throw new Error("convertRadix: carry overflow");if(f=v%r,c[h]=Math.floor(v/r),!Number.isSafeInteger(c[h])||c[h]*r+f!==v)throw new Error("convertRadix: carry overflow");if(d)c[h]?d=!1:o=h;else continue}if(s.push(f),d)break}for(let f=0;f<e.length-1&&e[f]===0;f++)s.push(0);return s.reverse()}const da=(e,t)=>t?da(t,e%t):e,Pr=(e,t)=>e+(t-da(e,t));function Zi(e,t,r,o){if(!Array.isArray(e))throw new Error("convertRadix2: data should be array");if(t<=0||t>32)throw new Error(`convertRadix2: wrong from=${t}`);if(r<=0||r>32)throw new Error(`convertRadix2: wrong to=${r}`);if(Pr(t,r)>32)throw new Error(`convertRadix2: carry overflow from=${t} to=${r} carryBits=${Pr(t,r)}`);let s=0,c=0;const f=2**r-1,d=[];for(const h of e){if(An(h),h>=2**t)throw new Error(`convertRadix2: invalid data word=${h} from=${t}`);if(s=s<<t|h,c+t>32)throw new Error(`convertRadix2: carry overflow pos=${c} from=${t}`);for(c+=t;c>=r;c-=r)d.push((s>>c-r&f)>>>0);s&=2**c-1}if(s=s<<r-c&f,!o&&c>=t)throw new Error("Excess padding");if(!o&&s)throw new Error(`Non-zero padding: ${s}`);return o&&c>0&&d.push(s>>>0),d}function al(e){return An(e),{encode:t=>{if(!(t instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return Ss(Array.from(t),2**8,e)},decode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(Ss(t,e,2**8))}}}function Ut(e,t=!1){if(An(e),e<=0||e>32)throw new Error("radix2: bits should be in (0..32]");if(Pr(8,e)>32||Pr(e,8)>32)throw new Error("radix2: carry overflow");return{encode:r=>{if(!(r instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return Zi(Array.from(r),8,e,!t)},decode:r=>{if(!Array.isArray(r)||r.length&&typeof r[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(Zi(r,e,8,t))}}}function Ts(e){if(typeof e!="function")throw new Error("unsafeWrapper fn should be function");return function(...t){try{return e.apply(null,t)}catch{}}}const cl=Et(Ut(4),xt("0123456789ABCDEF"),_t("")),ul=Et(Ut(5),xt("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),Mr(5),_t(""));Et(Ut(5),xt("0123456789ABCDEFGHIJKLMNOPQRSTUV"),Mr(5),_t(""));Et(Ut(5),xt("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),_t(""),ha(e=>e.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")));const wt=Et(Ut(6),xt("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),Mr(6),_t("")),ll=Et(Ut(6),xt("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),Mr(6),_t("")),lo=e=>Et(al(58),xt(e),_t("")),Yi=lo("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");lo("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ");lo("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const Is=[0,2,3,5,6,7,9,10,11],fl={encode(e){let t="";for(let r=0;r<e.length;r+=8){const o=e.subarray(r,r+8);t+=Yi.encode(o).padStart(Is[o.length],"1")}return t},decode(e){let t=[];for(let r=0;r<e.length;r+=11){const o=e.slice(r,r+11),s=Is.indexOf(o.length),c=Yi.decode(o);for(let f=0;f<c.length-s;f++)if(c[f]!==0)throw new Error("base58xmr: wrong padding");t=t.concat(Array.from(c.slice(c.length-s)))}return Uint8Array.from(t)}},Ji=Et(xt("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),_t("")),Ps=[996825010,642813549,513874426,1027748829,705979059];function jn(e){const t=e>>25;let r=(e&33554431)<<5;for(let o=0;o<Ps.length;o++)(t>>o&1)===1&&(r^=Ps[o]);return r}function Os(e,t,r=1){const o=e.length;let s=1;for(let c=0;c<o;c++){const f=e.charCodeAt(c);if(f<33||f>126)throw new Error(`Invalid prefix (${e})`);s=jn(s)^f>>5}s=jn(s);for(let c=0;c<o;c++)s=jn(s)^e.charCodeAt(c)&31;for(let c of t)s=jn(s)^c;for(let c=0;c<6;c++)s=jn(s);return s^=r,Ji.encode(Zi([s%2**30],30,5,!1))}function pa(e){const t=e==="bech32"?1:734539939,r=Ut(5),o=r.decode,s=r.encode,c=Ts(o);function f(v,b,C=90){if(typeof v!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof v}`);if(!Array.isArray(b)||b.length&&typeof b[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof b}`);const N=v.length+7+b.length;if(C!==!1&&N>C)throw new TypeError(`Length ${N} exceeds limit ${C}`);return v=v.toLowerCase(),`${v}1${Ji.encode(b)}${Os(v,b,t)}`}function d(v,b=90){if(typeof v!="string")throw new Error(`bech32.decode input should be string, not ${typeof v}`);if(v.length<8||b!==!1&&v.length>b)throw new TypeError(`Wrong string length: ${v.length} (${v}). Expected (8..${b})`);const C=v.toLowerCase();if(v!==C&&v!==v.toUpperCase())throw new Error("String must be lowercase or uppercase");v=C;const N=v.lastIndexOf("1");if(N===0||N===-1)throw new Error('Letter "1" must be present between prefix and data only');const L=v.slice(0,N),O=v.slice(N+1);if(O.length<6)throw new Error("Data must be at least 6 characters long");const R=Ji.decode(O).slice(0,-6),$=Os(L,R,t);if(!O.endsWith($))throw new Error(`Invalid checksum in ${v}: expected "${$}"`);return{prefix:L,words:R}}const h=Ts(d);function m(v){const{prefix:b,words:C}=d(v,!1);return{prefix:b,words:C,bytes:o(C)}}return{encode:f,decode:d,decodeToBytes:m,decodeUnsafe:h,fromWords:o,fromWordsUnsafe:c,toWords:s}}const xn=pa("bech32");pa("bech32m");const hl={encode:e=>new TextDecoder().decode(e),decode:e=>new TextEncoder().encode(e)},dl=Et(Ut(4),xt("0123456789abcdef"),_t(""),ha(e=>{if(typeof e!="string"||e.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof e} with length ${e.length}`);return e.toLowerCase()})),pl={utf8:hl,hex:dl,base16:cl,base32:ul,base64:wt,base64url:ll,base58:Yi,base58xmr:fl};`${Object.keys(pl).join(", ")}`;function Ni(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`positive integer expected, not ${e}`)}function Bs(e){if(typeof e!="boolean")throw new Error(`boolean expected, not ${e}`)}function yl(e){return e instanceof Uint8Array||e!=null&&typeof e=="object"&&e.constructor.name==="Uint8Array"}function ct(e,...t){if(!yl(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error(`Uint8Array expected of length ${t}, not of length=${e.length}`)}/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */const qe=e=>new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4)),gl=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!gl)throw new Error("Non little-endian hardware is not supported");const ml=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function yn(e){ct(e);let t="";for(let r=0;r<e.length;r++)t+=ml[e[r]];return t}const yt={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function Cs(e){if(e>=yt._0&&e<=yt._9)return e-yt._0;if(e>=yt._A&&e<=yt._F)return e-(yt._A-10);if(e>=yt._a&&e<=yt._f)return e-(yt._a-10)}function ya(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);const t=e.length,r=t/2;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const o=new Uint8Array(r);for(let s=0,c=0;s<r;s++,c+=2){const f=Cs(e.charCodeAt(c)),d=Cs(e.charCodeAt(c+1));if(f===void 0||d===void 0){const h=e[c]+e[c+1];throw new Error('hex string expected, got non-hex character "'+h+'" at index '+c)}o[s]=f*16+d}return o}function bl(e,t){if(t==null||typeof t!="object")throw new Error("options must be defined");return Object.assign(e,t)}function vl(e,t){if(e.length!==t.length)return!1;let r=0;for(let o=0;o<e.length;o++)r|=e[o]^t[o];return r===0}const wl=(e,t)=>(Object.assign(t,e),t),Mt=16,El=283;function fo(e){return e<<1^El&-(e>>7)}function gn(e,t){let r=0;for(;t>0;t>>=1)r^=e&-(t&1),e=fo(e);return r}const Xi=(()=>{let e=new Uint8Array(256);for(let r=0,o=1;r<256;r++,o^=fo(o))e[r]=o;const t=new Uint8Array(256);t[0]=99;for(let r=0;r<255;r++){let o=e[255-r];o|=o<<8,t[e[r]]=(o^o>>4^o>>5^o>>6^o>>7^99)&255}return t})(),xl=Xi.map((e,t)=>Xi.indexOf(t)),_l=e=>e<<24|e>>>8,Mi=e=>e<<8|e>>>24;function ga(e,t){if(e.length!==256)throw new Error("Wrong sbox length");const r=new Uint32Array(256).map((m,v)=>t(e[v])),o=r.map(Mi),s=o.map(Mi),c=s.map(Mi),f=new Uint32Array(256*256),d=new Uint32Array(256*256),h=new Uint16Array(256*256);for(let m=0;m<256;m++)for(let v=0;v<256;v++){const b=m*256+v;f[b]=r[m]^o[v],d[b]=s[m]^c[v],h[b]=e[m]<<8|e[v]}return{sbox:e,sbox2:h,T0:r,T1:o,T2:s,T3:c,T01:f,T23:d}}const ho=ga(Xi,e=>gn(e,3)<<24|e<<16|e<<8|gn(e,2)),ma=ga(xl,e=>gn(e,11)<<24|gn(e,13)<<16|gn(e,9)<<8|gn(e,14)),kl=(()=>{const e=new Uint8Array(16);for(let t=0,r=1;t<16;t++,r=fo(r))e[t]=r;return e})();function ba(e){ct(e);const t=e.length;if(![16,24,32].includes(t))throw new Error(`aes: wrong key size: should be 16, 24 or 32, got: ${t}`);const{sbox2:r}=ho,o=qe(e),s=o.length,c=d=>ut(r,d,d,d,d),f=new Uint32Array(t+28);f.set(o);for(let d=s;d<f.length;d++){let h=f[d-1];d%s===0?h=c(_l(h))^kl[d/s-1]:s>6&&d%s===4&&(h=c(h)),f[d]=f[d-s]^h}return f}function Al(e){const t=ba(e),r=t.slice(),o=t.length,{sbox2:s}=ho,{T0:c,T1:f,T2:d,T3:h}=ma;for(let m=0;m<o;m+=4)for(let v=0;v<4;v++)r[m+v]=t[o-m-4+v];t.fill(0);for(let m=4;m<o-4;m++){const v=r[m],b=ut(s,v,v,v,v);r[m]=c[b&255]^f[b>>>8&255]^d[b>>>16&255]^h[b>>>24]}return r}function Nt(e,t,r,o,s,c){return e[r<<8&65280|o>>>8&255]^t[s>>>8&65280|c>>>24&255]}function ut(e,t,r,o,s){return e[t&255|r&65280]|e[o>>>16&255|s>>>16&65280]<<16}function Rs(e,t,r,o,s){const{sbox2:c,T01:f,T23:d}=ho;let h=0;t^=e[h++],r^=e[h++],o^=e[h++],s^=e[h++];const m=e.length/4-2;for(let L=0;L<m;L++){const O=e[h++]^Nt(f,d,t,r,o,s),R=e[h++]^Nt(f,d,r,o,s,t),$=e[h++]^Nt(f,d,o,s,t,r),F=e[h++]^Nt(f,d,s,t,r,o);t=O,r=R,o=$,s=F}const v=e[h++]^ut(c,t,r,o,s),b=e[h++]^ut(c,r,o,s,t),C=e[h++]^ut(c,o,s,t,r),N=e[h++]^ut(c,s,t,r,o);return{s0:v,s1:b,s2:C,s3:N}}function Sl(e,t,r,o,s){const{sbox2:c,T01:f,T23:d}=ma;let h=0;t^=e[h++],r^=e[h++],o^=e[h++],s^=e[h++];const m=e.length/4-2;for(let L=0;L<m;L++){const O=e[h++]^Nt(f,d,t,s,o,r),R=e[h++]^Nt(f,d,r,t,s,o),$=e[h++]^Nt(f,d,o,r,t,s),F=e[h++]^Nt(f,d,s,o,r,t);t=O,r=R,o=$,s=F}const v=e[h++]^ut(c,t,s,o,r),b=e[h++]^ut(c,r,t,s,o),C=e[h++]^ut(c,o,r,t,s),N=e[h++]^ut(c,s,o,r,t);return{s0:v,s1:b,s2:C,s3:N}}function va(e,t){if(!t)return new Uint8Array(e);if(ct(t),t.length<e)throw new Error(`aes: wrong destination length, expected at least ${e}, got: ${t.length}`);return t}function Tl(e){if(ct(e),e.length%Mt!==0)throw new Error(`aes/(cbc-ecb).decrypt ciphertext should consist of blocks with size ${Mt}`)}function Il(e,t,r){let o=e.length;const s=o%Mt;if(!t&&s!==0)throw new Error("aec/(cbc-ecb): unpadded plaintext with disabled padding");const c=qe(e);if(t){let h=Mt-s;h||(h=Mt),o=o+h}const f=va(o,r),d=qe(f);return{b:c,o:d,out:f}}function Pl(e,t){if(!t)return e;const r=e.length;if(!r)throw new Error("aes/pcks5: empty ciphertext not allowed");const o=e[r-1];if(o<=0||o>16)throw new Error(`aes/pcks5: wrong padding byte: ${o}`);const s=e.subarray(0,-o);for(let c=0;c<o;c++)if(e[r-c-1]!==o)throw new Error("aes/pcks5: wrong padding");return s}function Ol(e){const t=new Uint8Array(16),r=qe(t);t.set(e);const o=Mt-e.length;for(let s=Mt-o;s<Mt;s++)t[s]=o;return r}const wa=wl({blockSize:16,nonceLength:16},function(t,r,o={}){ct(t),ct(r,16);const s=!o.disablePadding;return{encrypt:(c,f)=>{const d=ba(t),{b:h,o:m,out:v}=Il(c,s,f),b=qe(r);let C=b[0],N=b[1],L=b[2],O=b[3],R=0;for(;R+4<=h.length;)C^=h[R+0],N^=h[R+1],L^=h[R+2],O^=h[R+3],{s0:C,s1:N,s2:L,s3:O}=Rs(d,C,N,L,O),m[R++]=C,m[R++]=N,m[R++]=L,m[R++]=O;if(s){const $=Ol(c.subarray(R*4));C^=$[0],N^=$[1],L^=$[2],O^=$[3],{s0:C,s1:N,s2:L,s3:O}=Rs(d,C,N,L,O),m[R++]=C,m[R++]=N,m[R++]=L,m[R++]=O}return d.fill(0),v},decrypt:(c,f)=>{Tl(c);const d=Al(t),h=qe(r),m=va(c.length,f),v=qe(c),b=qe(m);let C=h[0],N=h[1],L=h[2],O=h[3];for(let R=0;R+4<=v.length;){const $=C,F=N,ee=L,se=O;C=v[R+0],N=v[R+1],L=v[R+2],O=v[R+3];const{s0:ce,s1:z,s2:Z,s3:te}=Sl(d,C,N,L,O);b[R++]=ce^$,b[R++]=z^F,b[R++]=Z^ee,b[R++]=te^se}return d.fill(0),Pl(m,s)}}}),Ea=e=>Uint8Array.from(e.split("").map(t=>t.charCodeAt(0))),Bl=Ea("expand 16-byte k"),Cl=Ea("expand 32-byte k"),Rl=qe(Bl),xa=qe(Cl);xa.slice();function we(e,t){return e<<t|e>>>32-t}function Qi(e){return e.byteOffset%4===0}const wr=64,Ll=16,_a=2**32-1,Ls=new Uint32Array;function Nl(e,t,r,o,s,c,f,d){const h=s.length,m=new Uint8Array(wr),v=qe(m),b=Qi(s)&&Qi(c),C=b?qe(s):Ls,N=b?qe(c):Ls;for(let L=0;L<h;f++){if(e(t,r,o,v,f,d),f>=_a)throw new Error("arx: counter overflow");const O=Math.min(wr,h-L);if(b&&O===wr){const R=L/4;if(L%4!==0)throw new Error("arx: invalid block position");for(let $=0,F;$<Ll;$++)F=R+$,N[F]=C[F]^v[$];L+=wr;continue}for(let R=0,$;R<O;R++)$=L+R,c[$]=s[$]^m[R];L+=O}}function Ml(e,t){const{allowShortKeys:r,extendNonceFn:o,counterLength:s,counterRight:c,rounds:f}=bl({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},t);if(typeof e!="function")throw new Error("core must be a function");return Ni(s),Ni(f),Bs(c),Bs(r),(d,h,m,v,b=0)=>{ct(d),ct(h),ct(m);const C=m.length;if(v||(v=new Uint8Array(C)),ct(v),Ni(b),b<0||b>=_a)throw new Error("arx: counter overflow");if(v.length<C)throw new Error(`arx: output (${v.length}) is shorter than data (${C})`);const N=[];let L=d.length,O,R;if(L===32)O=d.slice(),N.push(O),R=xa;else if(L===16&&r)O=new Uint8Array(32),O.set(d),O.set(d,16),R=Rl,N.push(O);else throw new Error(`arx: invalid 32-byte key, got length=${L}`);Qi(h)||(h=h.slice(),N.push(h));const $=qe(O);if(o){if(h.length!==24)throw new Error("arx: extended nonce must be 24 bytes");o(R,$,qe(h.subarray(0,16)),$),h=h.subarray(16)}const F=16-s;if(F!==h.length)throw new Error(`arx: nonce must be ${F} or 16 bytes`);if(F!==12){const se=new Uint8Array(12);se.set(h,c?0:12-h.length),h=se,N.push(h)}const ee=qe(h);for(Nl(e,R,$,ee,m,v,b,f);N.length>0;)N.pop().fill(0);return v}}function $l(e,t,r,o,s,c=20){let f=e[0],d=e[1],h=e[2],m=e[3],v=t[0],b=t[1],C=t[2],N=t[3],L=t[4],O=t[5],R=t[6],$=t[7],F=s,ee=r[0],se=r[1],ce=r[2],z=f,Z=d,te=h,xe=m,le=v,ae=b,me=C,pe=N,Ae=L,q=O,V=R,ne=$,oe=F,ie=ee,ue=se,Ee=ce;for(let Fe=0;Fe<c;Fe+=2)z=z+le|0,oe=we(oe^z,16),Ae=Ae+oe|0,le=we(le^Ae,12),z=z+le|0,oe=we(oe^z,8),Ae=Ae+oe|0,le=we(le^Ae,7),Z=Z+ae|0,ie=we(ie^Z,16),q=q+ie|0,ae=we(ae^q,12),Z=Z+ae|0,ie=we(ie^Z,8),q=q+ie|0,ae=we(ae^q,7),te=te+me|0,ue=we(ue^te,16),V=V+ue|0,me=we(me^V,12),te=te+me|0,ue=we(ue^te,8),V=V+ue|0,me=we(me^V,7),xe=xe+pe|0,Ee=we(Ee^xe,16),ne=ne+Ee|0,pe=we(pe^ne,12),xe=xe+pe|0,Ee=we(Ee^xe,8),ne=ne+Ee|0,pe=we(pe^ne,7),z=z+ae|0,Ee=we(Ee^z,16),V=V+Ee|0,ae=we(ae^V,12),z=z+ae|0,Ee=we(Ee^z,8),V=V+Ee|0,ae=we(ae^V,7),Z=Z+me|0,oe=we(oe^Z,16),ne=ne+oe|0,me=we(me^ne,12),Z=Z+me|0,oe=we(oe^Z,8),ne=ne+oe|0,me=we(me^ne,7),te=te+pe|0,ie=we(ie^te,16),Ae=Ae+ie|0,pe=we(pe^Ae,12),te=te+pe|0,ie=we(ie^te,8),Ae=Ae+ie|0,pe=we(pe^Ae,7),xe=xe+le|0,ue=we(ue^xe,16),q=q+ue|0,le=we(le^q,12),xe=xe+le|0,ue=we(ue^xe,8),q=q+ue|0,le=we(le^q,7);let fe=0;o[fe++]=f+z|0,o[fe++]=d+Z|0,o[fe++]=h+te|0,o[fe++]=m+xe|0,o[fe++]=v+le|0,o[fe++]=b+ae|0,o[fe++]=C+me|0,o[fe++]=N+pe|0,o[fe++]=L+Ae|0,o[fe++]=O+q|0,o[fe++]=R+V|0,o[fe++]=$+ne|0,o[fe++]=F+oe|0,o[fe++]=ee+ie|0,o[fe++]=se+ue|0,o[fe++]=ce+Ee|0}const ka=Ml($l,{counterRight:!1,counterLength:4,allowShortKeys:!1});class Aa extends aa{constructor(t,r){super(),this.finished=!1,this.destroyed=!1,at.hash(t);const o=Vn(r);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const s=this.blockLen,c=new Uint8Array(s);c.set(o.length>s?t.create().update(o).digest():o);for(let f=0;f<c.length;f++)c[f]^=54;this.iHash.update(c),this.oHash=t.create();for(let f=0;f<c.length;f++)c[f]^=106;this.oHash.update(c),c.fill(0)}update(t){return at.exists(this),this.iHash.update(t),this}digestInto(t){at.exists(this),at.bytes(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:r,iHash:o,finished:s,destroyed:c,blockLen:f,outputLen:d}=this;return t=t,t.finished=s,t.destroyed=c,t.blockLen=f,t.outputLen=d,t.oHash=r._cloneInto(t.oHash),t.iHash=o._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const $r=(e,t,r)=>new Aa(e,t).update(r).digest();$r.create=(e,t)=>new Aa(e,t);function Ul(e,t,r){return at.hash(e),$r(e,Vn(r),Vn(t))}const $i=new Uint8Array([0]),Ns=new Uint8Array;function Kl(e,t,r,o=32){if(at.hash(e),at.number(o),o>255*e.outputLen)throw new Error("Length should be <= 255*HashLen");const s=Math.ceil(o/e.outputLen);r===void 0&&(r=Ns);const c=new Uint8Array(s*e.outputLen),f=$r.create(e,t),d=f._cloneInto(),h=new Uint8Array(f.outputLen);for(let m=0;m<s;m++)$i[0]=m+1,d.update(m===0?Ns:h).update(r).update($i).digestInto(h),c.set(h,e.outputLen*m),f._cloneInto(d);return f.destroy(),d.destroy(),h.fill(0),$i.fill(0),c.slice(0,o)}var ql=Object.defineProperty,ke=(e,t)=>{for(var r in t)ql(e,r,{get:t[r],enumerable:!0})},Yt=Symbol("verified"),jl=e=>e instanceof Object;function po(e){if(!jl(e)||typeof e.kind!="number"||typeof e.content!="string"||typeof e.created_at!="number"||typeof e.pubkey!="string"||!e.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(e.tags))return!1;for(let t=0;t<e.tags.length;t++){let r=e.tags[t];if(!Array.isArray(r))return!1;for(let o=0;o<r.length;o++)if(typeof r[o]!="string")return!1}return!0}var Dl={};ke(Dl,{Queue:()=>Ta,QueueNode:()=>Sa,binarySearch:()=>yo,bytesToHex:()=>Ke,hexToBytes:()=>tn,insertEventIntoAscendingList:()=>Fl,insertEventIntoDescendingList:()=>Hl,normalizeURL:()=>Xt,utf8Decoder:()=>vt,utf8Encoder:()=>Qe});var vt=new TextDecoder("utf-8"),Qe=new TextEncoder;function Xt(e){try{e.indexOf("://")===-1&&(e="wss://"+e);let t=new URL(e);return t.protocol==="http:"?t.protocol="ws:":t.protocol==="https:"&&(t.protocol="wss:"),t.pathname=t.pathname.replace(/\/+/g,"/"),t.pathname.endsWith("/")&&(t.pathname=t.pathname.slice(0,-1)),(t.port==="80"&&t.protocol==="ws:"||t.port==="443"&&t.protocol==="wss:")&&(t.port=""),t.searchParams.sort(),t.hash="",t.toString()}catch{throw new Error(`Invalid URL: ${e}`)}}function Hl(e,t){const[r,o]=yo(e,s=>t.id===s.id?0:t.created_at===s.created_at?-1:s.created_at-t.created_at);return o||e.splice(r,0,t),e}function Fl(e,t){const[r,o]=yo(e,s=>t.id===s.id?0:t.created_at===s.created_at?-1:t.created_at-s.created_at);return o||e.splice(r,0,t),e}function yo(e,t){let r=0,o=e.length-1;for(;r<=o;){const s=Math.floor((r+o)/2),c=t(e[s]);if(c===0)return[s,!0];c<0?o=s-1:r=s+1}return[r,!1]}var Sa=class{value;next=null;prev=null;constructor(e){this.value=e}},Ta=class{first;last;constructor(){this.first=null,this.last=null}enqueue(e){const t=new Sa(e);return this.last?this.last===this.first?(this.last=t,this.last.prev=this.first,this.first.next=t):(t.prev=this.last,this.last.next=t,this.last=t):(this.first=t,this.last=t),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){const t=this.first;return this.first=null,this.last=null,t.value}const e=this.first;return this.first=e.next,this.first&&(this.first.prev=null),e.value}},Vl=class{generateSecretKey(){return qn.utils.randomPrivateKey()}getPublicKey(e){return Ke(qn.getPublicKey(e))}finalizeEvent(e,t){const r=e;return r.pubkey=Ke(qn.getPublicKey(t)),r.id=xr(r),r.sig=Ke(qn.sign(xr(r),t)),r[Yt]=!0,r}verifyEvent(e){if(typeof e[Yt]=="boolean")return e[Yt];const t=xr(e);if(t!==e.id)return e[Yt]=!1,!1;try{const r=qn.verify(e.sig,t,e.pubkey);return e[Yt]=r,r}catch{return e[Yt]=!1,!1}}};function zl(e){if(!po(e))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content])}function xr(e){let t=rn(Qe.encode(zl(e)));return Ke(t)}var Ur=new Vl,Wl=Ur.generateSecretKey,go=Ur.getPublicKey,lt=Ur.finalizeEvent,Kr=Ur.verifyEvent,Gl={};ke(Gl,{Application:()=>ah,BadgeAward:()=>nf,BadgeDefinition:()=>eh,BlockedRelaysList:()=>Mf,BlossomServerList:()=>Hf,BookmarkList:()=>Rf,Bookmarksets:()=>Jf,Calendar:()=>ph,CalendarEventRSVP:()=>yh,ChannelCreation:()=>Ra,ChannelHideMessage:()=>Ma,ChannelMessage:()=>Na,ChannelMetadata:()=>La,ChannelMuteUser:()=>$a,ChatMessage:()=>rf,ClassifiedListing:()=>lh,ClientAuth:()=>Ka,Comment:()=>df,CommunitiesList:()=>Lf,CommunityDefinition:()=>vh,CommunityPostApproval:()=>Ef,Contacts:()=>Ql,CreateOrUpdateProduct:()=>rh,CreateOrUpdateStall:()=>nh,Curationsets:()=>Xf,Date:()=>hh,DirectMessageRelaysList:()=>jf,DraftClassifiedListing:()=>fh,DraftLong:()=>oh,Emojisets:()=>sh,EncryptedDirectMessage:()=>ef,EventDeletion:()=>tf,FavoriteRelays:()=>Uf,FileMessage:()=>sf,FileMetadata:()=>hf,FileServerPreference:()=>Df,Followsets:()=>Gf,ForumThread:()=>of,GenericRepost:()=>Eo,Genericlists:()=>Zf,GiftWrap:()=>Ua,GroupMetadata:()=>wh,HTTPAuth:()=>xo,Handlerinformation:()=>bh,Handlerrecommendation:()=>mh,Highlights:()=>If,InterestsList:()=>Kf,Interestsets:()=>th,JobFeedback:()=>kf,JobRequest:()=>xf,JobResult:()=>_f,Label:()=>wf,LightningPubRPC:()=>Vf,LiveChatMessage:()=>pf,LiveEvent:()=>ch,LongFormArticle:()=>ih,Metadata:()=>Jl,Mutelist:()=>Of,NWCWalletInfo:()=>Ff,NWCWalletRequest:()=>qa,NWCWalletResponse:()=>zf,NormalVideo:()=>cf,NostrConnect:()=>Wf,OpenTimestamps:()=>lf,Photo:()=>af,Pinlist:()=>Bf,Poll:()=>ff,PollResponse:()=>Pf,PrivateDirectMessage:()=>Ca,ProblemTracker:()=>mf,ProfileBadges:()=>Qf,PublicChatsList:()=>Nf,Reaction:()=>wo,RecommendRelay:()=>Xl,RelayList:()=>Cf,RelayReview:()=>gh,Relaysets:()=>Yf,Report:()=>bf,Reporting:()=>vf,Repost:()=>vo,Seal:()=>Ba,SearchRelaysList:()=>$f,ShortTextNote:()=>Oa,ShortVideo:()=>uf,Time:()=>dh,UserEmojiList:()=>qf,UserStatuses:()=>uh,Voice:()=>yf,VoiceComment:()=>gf,Zap:()=>Tf,ZapGoal:()=>Af,ZapRequest:()=>Sf,classifyKind:()=>Zl,isAddressableKind:()=>bo,isEphemeralKind:()=>Pa,isKind:()=>Yl,isRegularKind:()=>Ia,isReplaceableKind:()=>mo});function Ia(e){return e<1e4&&e!==0&&e!==3}function mo(e){return e===0||e===3||1e4<=e&&e<2e4}function Pa(e){return 2e4<=e&&e<3e4}function bo(e){return 3e4<=e&&e<4e4}function Zl(e){return Ia(e)?"regular":mo(e)?"replaceable":Pa(e)?"ephemeral":bo(e)?"parameterized":"unknown"}function Yl(e,t){const r=t instanceof Array?t:[t];return po(e)&&r.includes(e.kind)||!1}var Jl=0,Oa=1,Xl=2,Ql=3,ef=4,tf=5,vo=6,wo=7,nf=8,rf=9,of=11,Ba=13,Ca=14,sf=15,Eo=16,af=20,cf=21,uf=22,Ra=40,La=41,Na=42,Ma=43,$a=44,lf=1040,Ua=1059,ff=1068,hf=1063,df=1111,pf=1311,yf=1222,gf=1244,mf=1971,bf=1984,vf=1984,wf=1985,Ef=4550,xf=5999,_f=6999,kf=7e3,Af=9041,Sf=9734,Tf=9735,If=9802,Pf=1018,Of=1e4,Bf=10001,Cf=10002,Rf=10003,Lf=10004,Nf=10005,Mf=10006,$f=10007,Uf=10012,Kf=10015,qf=10030,jf=10050,Df=10096,Hf=10063,Ff=13194,Vf=21e3,Ka=22242,qa=23194,zf=23195,Wf=24133,xo=27235,Gf=3e4,Zf=30001,Yf=30002,Jf=30003,Xf=30004,Qf=30008,eh=30009,th=30015,nh=30017,rh=30018,ih=30023,oh=30024,sh=30030,ah=30078,ch=30311,uh=30315,lh=30402,fh=30403,hh=31922,dh=31923,ph=31924,yh=31925,gh=31987,mh=31989,bh=31990,vh=34550,wh=39e3;function Eh(e,t){if(e.ids&&e.ids.indexOf(t.id)===-1||e.kinds&&e.kinds.indexOf(t.kind)===-1||e.authors&&e.authors.indexOf(t.pubkey)===-1)return!1;for(let r in e)if(r[0]==="#"){let o=r.slice(1),s=e[`#${o}`];if(s&&!t.tags.find(([c,f])=>c===r.slice(1)&&s.indexOf(f)!==-1))return!1}return!(e.since&&t.created_at<e.since||e.until&&t.created_at>e.until)}function xh(e,t){for(let r=0;r<e.length;r++)if(Eh(e[r],t))return!0;return!1}var _h={};ke(_h,{getHex64:()=>qr,getInt:()=>ja,getSubscriptionId:()=>Da,matchEventId:()=>kh,matchEventKind:()=>Sh,matchEventPubkey:()=>Ah});function qr(e,t){let r=t.length+3,o=e.indexOf(`"${t}":`)+r,s=e.slice(o).indexOf('"')+o+1;return e.slice(s,s+64)}function ja(e,t){let r=t.length,o=e.indexOf(`"${t}":`)+r+3,s=e.slice(o),c=Math.min(s.indexOf(","),s.indexOf("}"));return parseInt(s.slice(0,c),10)}function Da(e){let t=e.slice(0,22).indexOf('"EVENT"');if(t===-1)return null;let r=e.slice(t+7+1).indexOf('"');if(r===-1)return null;let o=t+7+1+r,s=e.slice(o+1,80).indexOf('"');if(s===-1)return null;let c=o+1+s;return e.slice(o+1,c)}function kh(e,t){return t===qr(e,"id")}function Ah(e,t){return t===qr(e,"pubkey")}function Sh(e,t){return t===ja(e,"kind")}var Th={};ke(Th,{makeAuthEvent:()=>Ha});function Ha(e,t){return{kind:Ka,created_at:Math.floor(Date.now()/1e3),tags:[["relay",e],["challenge",t]],content:""}}async function Ih(){return new Promise((e,t)=>{try{if(typeof MessageChannel<"u"){const r=new MessageChannel,o=()=>{r.port1.removeEventListener("message",o),e()};r.port1.addEventListener("message",o),r.port2.postMessage(0),r.port1.start()}else typeof setImmediate<"u"?setImmediate(e):typeof setTimeout<"u"?setTimeout(e,0):e()}catch(r){console.error("during yield: ",r),t(r)}})}var Ph=e=>(e[Yt]=!0,!0),Fa=class extends Error{constructor(e,t){super(`Tried to send message '${e} on a closed connection to ${t}.`),this.name="SendingOnClosedConnection"}},Va=class{url;_connected=!1;onclose=null;onnotice=e=>console.debug(`NOTICE from ${this.url}: ${e}`);onauth;baseEoseTimeout=4400;connectionTimeout=4400;publishTimeout=4400;pingFrequency=29e3;pingTimeout=2e4;resubscribeBackoff=[1e4,1e4,1e4,2e4,2e4,3e4,6e4];openSubs=new Map;enablePing;enableReconnect;connectionTimeoutHandle;reconnectTimeoutHandle;pingIntervalHandle;reconnectAttempts=0;closedIntentionally=!1;connectionPromise;openCountRequests=new Map;openEventPublishes=new Map;ws;incomingMessageQueue=new Ta;queueRunning=!1;challenge;authPromise;serial=0;verifyEvent;_WebSocket;constructor(e,t){this.url=Xt(e),this.verifyEvent=t.verifyEvent,this._WebSocket=t.websocketImplementation||WebSocket,this.enablePing=t.enablePing,this.enableReconnect=t.enableReconnect||!1}static async connect(e,t){const r=new Va(e,t);return await r.connect(),r}closeAllSubscriptions(e){for(let[t,r]of this.openSubs)r.close(e);this.openSubs.clear();for(let[t,r]of this.openEventPublishes)r.reject(new Error(e));this.openEventPublishes.clear();for(let[t,r]of this.openCountRequests)r.reject(new Error(e));this.openCountRequests.clear()}get connected(){return this._connected}async reconnect(){const e=this.resubscribeBackoff[Math.min(this.reconnectAttempts,this.resubscribeBackoff.length-1)];this.reconnectAttempts++,this.reconnectTimeoutHandle=setTimeout(async()=>{try{await this.connect()}catch{}},e)}handleHardClose(e){this.pingIntervalHandle&&(clearInterval(this.pingIntervalHandle),this.pingIntervalHandle=void 0),this._connected=!1,this.connectionPromise=void 0;const t=this.closedIntentionally;this.closedIntentionally=!1,this.onclose?.(),this.enableReconnect&&!t?this.reconnect():this.closeAllSubscriptions(e)}async connect(){return this.connectionPromise?this.connectionPromise:(this.challenge=void 0,this.authPromise=void 0,this.connectionPromise=new Promise((e,t)=>{this.connectionTimeoutHandle=setTimeout(()=>{t("connection timed out"),this.connectionPromise=void 0,this.onclose?.(),this.closeAllSubscriptions("relay connection timed out")},this.connectionTimeout);try{this.ws=new this._WebSocket(this.url)}catch(r){clearTimeout(this.connectionTimeoutHandle),t(r);return}this.ws.onopen=()=>{this.reconnectTimeoutHandle&&(clearTimeout(this.reconnectTimeoutHandle),this.reconnectTimeoutHandle=void 0),clearTimeout(this.connectionTimeoutHandle),this._connected=!0;const r=this.reconnectAttempts>0;this.reconnectAttempts=0;for(const o of this.openSubs.values()){if(o.eosed=!1,r)for(let s=0;s<o.filters.length;s++)o.lastEmitted&&(o.filters[s].since=o.lastEmitted+1);o.fire()}this.enablePing&&(this.pingIntervalHandle=setInterval(()=>this.pingpong(),this.pingFrequency)),e()},this.ws.onerror=r=>{clearTimeout(this.connectionTimeoutHandle),t(r.message||"websocket error"),this.handleHardClose("relay connection errored")},this.ws.onclose=r=>{clearTimeout(this.connectionTimeoutHandle),t(r.message||"websocket closed"),this.handleHardClose("relay connection closed")},this.ws.onmessage=this._onmessage.bind(this)}),this.connectionPromise)}waitForPingPong(){return new Promise(e=>{this.ws.once("pong",()=>e(!0)),this.ws.ping()})}waitForDummyReq(){return new Promise((e,t)=>{if(!this.connectionPromise)return t(new Error(`no connection to ${this.url}, can't ping`));try{const r=this.subscribe([{ids:["aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"],limit:0}],{label:"forced-ping",oneose:()=>{e(!0),r.close()},onclose(){e(!0)},eoseTimeout:this.pingTimeout+1e3})}catch(r){t(r)}})}async pingpong(){this.ws?.readyState===1&&(await Promise.any([this.ws&&this.ws.ping&&this.ws.once?this.waitForPingPong():this.waitForDummyReq(),new Promise(t=>setTimeout(()=>t(!1),this.pingTimeout))])||this.ws?.readyState===this._WebSocket.OPEN&&this.ws?.close())}async runQueue(){for(this.queueRunning=!0;this.handleNext()!==!1;)await Ih();this.queueRunning=!1}handleNext(){const e=this.incomingMessageQueue.dequeue();if(!e)return!1;const t=Da(e);if(t){const r=this.openSubs.get(t);if(!r)return;const o=qr(e,"id"),s=r.alreadyHaveEvent?.(o);if(r.receivedEvent?.(this,o),s)return}try{let r=JSON.parse(e);switch(r[0]){case"EVENT":{const o=this.openSubs.get(r[1]),s=r[2];this.verifyEvent(s)&&xh(o.filters,s)&&o.onevent(s),(!o.lastEmitted||o.lastEmitted<s.created_at)&&(o.lastEmitted=s.created_at);return}case"COUNT":{const o=r[1],s=r[2],c=this.openCountRequests.get(o);c&&(c.resolve(s.count),this.openCountRequests.delete(o));return}case"EOSE":{const o=this.openSubs.get(r[1]);if(!o)return;o.receivedEose();return}case"OK":{const o=r[1],s=r[2],c=r[3],f=this.openEventPublishes.get(o);f&&(clearTimeout(f.timeout),s?f.resolve(c):f.reject(new Error(c)),this.openEventPublishes.delete(o));return}case"CLOSED":{const o=r[1],s=this.openSubs.get(o);if(!s)return;s.closed=!0,s.close(r[2]);return}case"NOTICE":{this.onnotice(r[1]);return}case"AUTH":{this.challenge=r[1],this.onauth&&this.auth(this.onauth);return}default:{this.openSubs.get(r[1])?.oncustom?.(r);return}}}catch{return}}async send(e){if(!this.connectionPromise)throw new Fa(e,this.url);this.connectionPromise.then(()=>{this.ws?.send(e)})}async auth(e){const t=this.challenge;if(!t)throw new Error("can't perform auth, no challenge was received");return this.authPromise?this.authPromise:(this.authPromise=new Promise(async(r,o)=>{try{let s=await e(Ha(this.url,t)),c=setTimeout(()=>{let f=this.openEventPublishes.get(s.id);f&&(f.reject(new Error("auth timed out")),this.openEventPublishes.delete(s.id))},this.publishTimeout);this.openEventPublishes.set(s.id,{resolve:r,reject:o,timeout:c}),this.send('["AUTH",'+JSON.stringify(s)+"]")}catch(s){console.warn("subscribe auth function failed:",s)}}),this.authPromise)}async publish(e){const t=new Promise((r,o)=>{const s=setTimeout(()=>{const c=this.openEventPublishes.get(e.id);c&&(c.reject(new Error("publish timed out")),this.openEventPublishes.delete(e.id))},this.publishTimeout);this.openEventPublishes.set(e.id,{resolve:r,reject:o,timeout:s})});return this.send('["EVENT",'+JSON.stringify(e)+"]"),t}async count(e,t){this.serial++;const r=t?.id||"count:"+this.serial,o=new Promise((s,c)=>{this.openCountRequests.set(r,{resolve:s,reject:c})});return this.send('["COUNT","'+r+'",'+JSON.stringify(e).substring(1)),o}subscribe(e,t){const r=this.prepareSubscription(e,t);return r.fire(),r}prepareSubscription(e,t){this.serial++;const r=t.id||(t.label?t.label+":":"sub:")+this.serial,o=new Oh(this,r,e,t);return this.openSubs.set(r,o),o}close(){this.closedIntentionally=!0,this.reconnectTimeoutHandle&&(clearTimeout(this.reconnectTimeoutHandle),this.reconnectTimeoutHandle=void 0),this.pingIntervalHandle&&(clearInterval(this.pingIntervalHandle),this.pingIntervalHandle=void 0),this.closeAllSubscriptions("relay connection closed by us"),this._connected=!1,this.onclose?.(),this.ws?.readyState===this._WebSocket.OPEN&&this.ws?.close()}_onmessage(e){this.incomingMessageQueue.enqueue(e.data),this.queueRunning||this.runQueue()}},Oh=class{relay;id;lastEmitted;closed=!1;eosed=!1;filters;alreadyHaveEvent;receivedEvent;onevent;oneose;onclose;oncustom;eoseTimeout;eoseTimeoutHandle;constructor(e,t,r,o){if(r.length===0)throw new Error("subscription can't be created with zero filters");this.relay=e,this.filters=r,this.id=t,this.alreadyHaveEvent=o.alreadyHaveEvent,this.receivedEvent=o.receivedEvent,this.eoseTimeout=o.eoseTimeout||e.baseEoseTimeout,this.oneose=o.oneose,this.onclose=o.onclose,this.onevent=o.onevent||(s=>{console.warn(`onevent() callback not defined for subscription '${this.id}' in relay ${this.relay.url}. event received:`,s)})}fire(){this.relay.send('["REQ","'+this.id+'",'+JSON.stringify(this.filters).substring(1)),this.eoseTimeoutHandle=setTimeout(this.receivedEose.bind(this),this.eoseTimeout)}receivedEose(){this.eosed||(clearTimeout(this.eoseTimeoutHandle),this.eosed=!0,this.oneose?.())}close(e="closed by caller"){if(!this.closed&&this.relay.connected){try{this.relay.send('["CLOSE",'+JSON.stringify(this.id)+"]")}catch(t){if(!(t instanceof Fa))throw t}this.closed=!0}this.relay.openSubs.delete(this.id),this.onclose?.(e)}},Bh;try{Bh=WebSocket}catch{}var Ch=class{relays=new Map;seenOn=new Map;trackRelays=!1;verifyEvent;enablePing;enableReconnect;automaticallyAuth;trustedRelayURLs=new Set;_WebSocket;constructor(e){this.verifyEvent=e.verifyEvent,this._WebSocket=e.websocketImplementation,this.enablePing=e.enablePing,this.enableReconnect=e.enableReconnect||!1,this.automaticallyAuth=e.automaticallyAuth}async ensureRelay(e,t){e=Xt(e);let r=this.relays.get(e);if(r||(r=new Va(e,{verifyEvent:this.trustedRelayURLs.has(e)?Ph:this.verifyEvent,websocketImplementation:this._WebSocket,enablePing:this.enablePing,enableReconnect:this.enableReconnect}),r.onclose=()=>{r&&!r.enableReconnect&&this.relays.delete(e)},t?.connectionTimeout&&(r.connectionTimeout=t.connectionTimeout),this.relays.set(e,r)),this.automaticallyAuth){const o=this.automaticallyAuth(e);o&&(r.onauth=o)}return await r.connect(),r}close(e){e.map(Xt).forEach(t=>{this.relays.get(t)?.close(),this.relays.delete(t)})}subscribe(e,t,r){const o=[];for(let s=0;s<e.length;s++){const c=Xt(e[s]);o.find(f=>f.url===c)||o.push({url:c,filter:t})}return this.subscribeMap(o,r)}subscribeMany(e,t,r){const o=[],s=[];for(let c=0;c<e.length;c++){const f=Xt(e[c]);s.indexOf(f)===-1&&(s.push(f),o.push({url:f,filter:t}))}return this.subscribeMap(o,r)}subscribeMap(e,t){const r=new Map;for(const C of e){const{url:N,filter:L}=C;r.has(N)||r.set(N,[]),r.get(N).push(L)}const o=Array.from(r.entries()).map(([C,N])=>({url:C,filters:N}));this.trackRelays&&(t.receivedEvent=(C,N)=>{let L=this.seenOn.get(N);L||(L=new Set,this.seenOn.set(N,L)),L.add(C)});const s=new Set,c=[],f=[];let d=C=>{f[C]||(f[C]=!0,f.filter(N=>N).length===o.length&&(t.oneose?.(),d=()=>{}))};const h=[];let m=(C,N)=>{h[C]||(d(C),h[C]=N,h.filter(L=>L).length===o.length&&(t.onclose?.(h),m=()=>{}))};const v=C=>{if(t.alreadyHaveEvent?.(C))return!0;const N=s.has(C);return s.add(C),N},b=Promise.all(o.map(async({url:C,filters:N},L)=>{let O;try{O=await this.ensureRelay(C,{connectionTimeout:t.maxWait?Math.max(t.maxWait*.8,t.maxWait-1e3):void 0})}catch($){m(L,$?.message||String($));return}let R=O.subscribe(N,{...t,oneose:()=>d(L),onclose:$=>{$.startsWith("auth-required: ")&&t.onauth?O.auth(t.onauth).then(()=>{O.subscribe(N,{...t,oneose:()=>d(L),onclose:F=>{m(L,F)},alreadyHaveEvent:v,eoseTimeout:t.maxWait})}).catch(F=>{m(L,`auth was required and attempted, but failed with: ${F}`)}):m(L,$)},alreadyHaveEvent:v,eoseTimeout:t.maxWait});c.push(R)}));return{async close(C){await b,c.forEach(N=>{N.close(C)})}}}subscribeEose(e,t,r){const o=this.subscribe(e,t,{...r,oneose(){o.close("closed automatically on eose")}});return o}subscribeManyEose(e,t,r){const o=this.subscribeMany(e,t,{...r,oneose(){o.close("closed automatically on eose")}});return o}async querySync(e,t,r){return new Promise(async o=>{const s=[];this.subscribeEose(e,t,{...r,onevent(c){s.push(c)},onclose(c){o(s)}})})}async get(e,t,r){t.limit=1;const o=await this.querySync(e,t,r);return o.sort((s,c)=>c.created_at-s.created_at),o[0]||null}publish(e,t,r){return e.map(Xt).map(async(o,s,c)=>{if(c.indexOf(o)!==s)return Promise.reject("duplicate url");let f=await this.ensureRelay(o);return f.publish(t).catch(async d=>{if(d instanceof Error&&d.message.startsWith("auth-required: ")&&r?.onauth)return await f.auth(r.onauth),f.publish(t);throw d}).then(d=>{if(this.trackRelays){let h=this.seenOn.get(t.id);h||(h=new Set,this.seenOn.set(t.id,h)),h.add(f)}return d})})}listConnectionStatus(){const e=new Map;return this.relays.forEach((t,r)=>e.set(r,t.connected)),e}destroy(){this.relays.forEach(e=>e.close()),this.relays=new Map}},za;try{za=WebSocket}catch{}var Rh=class extends Ch{constructor(e){super({verifyEvent:Kr,websocketImplementation:za,...e})}},nn={};ke(nn,{BECH32_REGEX:()=>Wa,Bech32MaxSize:()=>_o,NostrTypeGuard:()=>Lh,decode:()=>jr,decodeNostrURI:()=>Mh,encodeBytes:()=>Hr,naddrEncode:()=>Dh,neventEncode:()=>jh,noteEncode:()=>Kh,nprofileEncode:()=>qh,npubEncode:()=>Uh,nsecEncode:()=>$h});var Lh={isNProfile:e=>/^nprofile1[a-z\d]+$/.test(e||""),isNEvent:e=>/^nevent1[a-z\d]+$/.test(e||""),isNAddr:e=>/^naddr1[a-z\d]+$/.test(e||""),isNSec:e=>/^nsec1[a-z\d]{58}$/.test(e||""),isNPub:e=>/^npub1[a-z\d]{58}$/.test(e||""),isNote:e=>/^note1[a-z\d]+$/.test(e||""),isNcryptsec:e=>/^ncryptsec1[a-z\d]+$/.test(e||"")},_o=5e3,Wa=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/;function Nh(e){const t=new Uint8Array(4);return t[0]=e>>24&255,t[1]=e>>16&255,t[2]=e>>8&255,t[3]=e&255,t}function Mh(e){try{return e.startsWith("nostr:")&&(e=e.substring(6)),jr(e)}catch{return{type:"invalid",data:null}}}function jr(e){let{prefix:t,words:r}=xn.decode(e,_o),o=new Uint8Array(xn.fromWords(r));switch(t){case"nprofile":{let s=Ui(o);if(!s[0]?.[0])throw new Error("missing TLV 0 for nprofile");if(s[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:Ke(s[0][0]),relays:s[1]?s[1].map(c=>vt.decode(c)):[]}}}case"nevent":{let s=Ui(o);if(!s[0]?.[0])throw new Error("missing TLV 0 for nevent");if(s[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");if(s[2]&&s[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(s[3]&&s[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:Ke(s[0][0]),relays:s[1]?s[1].map(c=>vt.decode(c)):[],author:s[2]?.[0]?Ke(s[2][0]):void 0,kind:s[3]?.[0]?parseInt(Ke(s[3][0]),16):void 0}}}case"naddr":{let s=Ui(o);if(!s[0]?.[0])throw new Error("missing TLV 0 for naddr");if(!s[2]?.[0])throw new Error("missing TLV 2 for naddr");if(s[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(!s[3]?.[0])throw new Error("missing TLV 3 for naddr");if(s[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:vt.decode(s[0][0]),pubkey:Ke(s[2][0]),kind:parseInt(Ke(s[3][0]),16),relays:s[1]?s[1].map(c=>vt.decode(c)):[]}}}case"nsec":return{type:t,data:o};case"npub":case"note":return{type:t,data:Ke(o)};default:throw new Error(`unknown prefix ${t}`)}}function Ui(e){let t={},r=e;for(;r.length>0;){let o=r[0],s=r[1],c=r.slice(2,2+s);if(r=r.slice(2+s),c.length<s)throw new Error(`not enough data to read on TLV ${o}`);t[o]=t[o]||[],t[o].push(c)}return t}function $h(e){return Hr("nsec",e)}function Uh(e){return Hr("npub",tn(e))}function Kh(e){return Hr("note",tn(e))}function Dr(e,t){let r=xn.toWords(t);return xn.encode(e,r,_o)}function Hr(e,t){return Dr(e,t)}function qh(e){let t=ko({0:[tn(e.pubkey)],1:(e.relays||[]).map(r=>Qe.encode(r))});return Dr("nprofile",t)}function jh(e){let t;e.kind!==void 0&&(t=Nh(e.kind));let r=ko({0:[tn(e.id)],1:(e.relays||[]).map(o=>Qe.encode(o)),2:e.author?[tn(e.author)]:[],3:t?[new Uint8Array(t)]:[]});return Dr("nevent",r)}function Dh(e){let t=new ArrayBuffer(4);new DataView(t).setUint32(0,e.kind,!1);let r=ko({0:[Qe.encode(e.identifier)],1:(e.relays||[]).map(o=>Qe.encode(o)),2:[tn(e.pubkey)],3:[new Uint8Array(t)]});return Dr("naddr",r)}function ko(e){let t=[];return Object.entries(e).reverse().forEach(([r,o])=>{o.forEach(s=>{let c=new Uint8Array(s.length+2);c.set([parseInt(r)],0),c.set([s.length],1),c.set(s,2),t.push(c)})}),Nr(...t)}var Hh={};ke(Hh,{decrypt:()=>Fh,encrypt:()=>Ga});function Ga(e,t,r){const o=e instanceof Uint8Array?Ke(e):e,s=kn.getSharedSecret(o,"02"+t),c=Za(s);let f=Uint8Array.from(ua(16)),d=Qe.encode(r),h=wa(c,f).encrypt(d),m=wt.encode(new Uint8Array(h)),v=wt.encode(new Uint8Array(f.buffer));return`${m}?iv=${v}`}function Fh(e,t,r){const o=e instanceof Uint8Array?Ke(e):e;let[s,c]=r.split("?iv="),f=kn.getSharedSecret(o,"02"+t),d=Za(f),h=wt.decode(c),m=wt.decode(s),v=wa(d,h).decrypt(m);return vt.decode(v)}function Za(e){return e.slice(1,33)}var Vh={};ke(Vh,{NIP05_REGEX:()=>Ao,isNip05:()=>zh,isValid:()=>Zh,queryProfile:()=>Ya,searchDomain:()=>Gh,useFetchImplementation:()=>Wh});var Ao=/^(?:([\w.+-]+)@)?([\w_-]+(\.[\w_-]+)+)$/,zh=e=>Ao.test(e||""),Fr;try{Fr=fetch}catch{}function Wh(e){Fr=e}async function Gh(e,t=""){try{const r=`https://${e}/.well-known/nostr.json?name=${t}`,o=await Fr(r,{redirect:"manual"});if(o.status!==200)throw Error("Wrong response code");return(await o.json()).names}catch{return{}}}async function Ya(e){const t=e.match(Ao);if(!t)return null;const[,r="_",o]=t;try{const s=`https://${o}/.well-known/nostr.json?name=${r}`,c=await Fr(s,{redirect:"manual"});if(c.status!==200)throw Error("Wrong response code");const f=await c.json(),d=f.names[r];return d?{pubkey:d,relays:f.relays?.[d]}:null}catch{return null}}async function Zh(e,t){const r=await Ya(t);return r?r.pubkey===e:!1}var Yh={};ke(Yh,{parse:()=>Jh});function Jh(e){const t={reply:void 0,root:void 0,mentions:[],profiles:[],quotes:[]};let r,o;for(let s=e.tags.length-1;s>=0;s--){const c=e.tags[s];if(c[0]==="e"&&c[1]){const[f,d,h,m,v]=c,b={id:d,relays:h?[h]:[],author:v};if(m==="root"){t.root=b;continue}if(m==="reply"){t.reply=b;continue}if(m==="mention"){t.mentions.push(b);continue}r?o=b:r=b,t.mentions.push(b);continue}if(c[0]==="q"&&c[1]){const[f,d,h]=c;t.quotes.push({id:d,relays:h?[h]:[]})}if(c[0]==="p"&&c[1]){t.profiles.push({pubkey:c[1],relays:c[2]?[c[2]]:[]});continue}}return t.root||(t.root=o||r||t.reply),t.reply||(t.reply=r||t.root),[t.reply,t.root].forEach(s=>{if(!s)return;let c=t.mentions.indexOf(s);if(c!==-1&&t.mentions.splice(c,1),s.author){let f=t.profiles.find(d=>d.pubkey===s.author);f&&f.relays&&(s.relays||(s.relays=[]),f.relays.forEach(d=>{s.relays?.indexOf(d)===-1&&s.relays.push(d)}),f.relays=s.relays)}}),t.mentions.forEach(s=>{if(s.author){let c=t.profiles.find(f=>f.pubkey===s.author);c&&c.relays&&(s.relays||(s.relays=[]),c.relays.forEach(f=>{s.relays.indexOf(f)===-1&&s.relays.push(f)}),c.relays=s.relays)}}),t}var Xh={};ke(Xh,{fetchRelayInformation:()=>ed,useFetchImplementation:()=>Qh});var Ja;try{Ja=fetch}catch{}function Qh(e){Ja=e}async function ed(e){return await(await fetch(e.replace("ws://","http://").replace("wss://","https://"),{headers:{Accept:"application/nostr+json"}})).json()}var td={};ke(td,{fastEventHash:()=>Qa,getPow:()=>Xa,minePow:()=>nd});function Xa(e){let t=0;for(let r=0;r<64;r+=8){const o=parseInt(e.substring(r,r+8),16);if(o===0)t+=32;else{t+=Math.clz32(o);break}}return t}function nd(e,t){let r=0;const o=e,s=["nonce",r.toString(),t.toString()];for(o.tags.push(s);;){const c=Math.floor(new Date().getTime()/1e3);if(c!==o.created_at&&(r=0,o.created_at=c),s[1]=(++r).toString(),o.id=Qa(o),Xa(o.id)>=t)break}return o}function Qa(e){return Ke(rn(Qe.encode(JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content]))))}var rd={};ke(rd,{unwrapEvent:()=>yd,unwrapManyEvents:()=>gd,wrapEvent:()=>hc,wrapManyEvents:()=>pd});var id={};ke(id,{createRumor:()=>cc,createSeal:()=>uc,createWrap:()=>lc,unwrapEvent:()=>Oo,unwrapManyEvents:()=>fc,wrapEvent:()=>Or,wrapManyEvents:()=>hd});var od={};ke(od,{decrypt:()=>Po,encrypt:()=>Io,getConversationKey:()=>So,v2:()=>ld});var ec=1,tc=65535;function So(e,t){const r=kn.getSharedSecret(e,"02"+t).subarray(1,33);return Ul(rn,r,"nip44-v2")}function nc(e,t){const r=Kl(rn,e,t,76);return{chacha_key:r.subarray(0,32),chacha_nonce:r.subarray(32,44),hmac_key:r.subarray(44,76)}}function To(e){if(!Number.isSafeInteger(e)||e<1)throw new Error("expected positive integer");if(e<=32)return 32;const t=1<<Math.floor(Math.log2(e-1))+1,r=t<=256?32:t/8;return r*(Math.floor((e-1)/r)+1)}function sd(e){if(!Number.isSafeInteger(e)||e<ec||e>tc)throw new Error("invalid plaintext size: must be between 1 and 65535 bytes");const t=new Uint8Array(2);return new DataView(t.buffer).setUint16(0,e,!1),t}function ad(e){const t=Qe.encode(e),r=t.length,o=sd(r),s=new Uint8Array(To(r)-r);return Nr(o,t,s)}function cd(e){const t=new DataView(e.buffer).getUint16(0),r=e.subarray(2,2+t);if(t<ec||t>tc||r.length!==t||e.length!==2+To(t))throw new Error("invalid padding");return vt.decode(r)}function rc(e,t,r){if(r.length!==32)throw new Error("AAD associated data must be 32 bytes");const o=Nr(r,t);return $r(rn,e,o)}function ud(e){if(typeof e!="string")throw new Error("payload must be a valid string");const t=e.length;if(t<132||t>87472)throw new Error("invalid payload length: "+t);if(e[0]==="#")throw new Error("unknown encryption version");let r;try{r=wt.decode(e)}catch(c){throw new Error("invalid base64: "+c.message)}const o=r.length;if(o<99||o>65603)throw new Error("invalid data length: "+o);const s=r[0];if(s!==2)throw new Error("unknown encryption version "+s);return{nonce:r.subarray(1,33),ciphertext:r.subarray(33,-32),mac:r.subarray(-32)}}function Io(e,t,r=ua(32)){const{chacha_key:o,chacha_nonce:s,hmac_key:c}=nc(t,r),f=ad(e),d=ka(o,s,f),h=rc(c,d,r);return wt.encode(Nr(new Uint8Array([2]),r,d,h))}function Po(e,t){const{nonce:r,ciphertext:o,mac:s}=ud(e),{chacha_key:c,chacha_nonce:f,hmac_key:d}=nc(t,r),h=rc(d,o,r);if(!vl(h,s))throw new Error("invalid MAC");const m=ka(c,f,o);return cd(m)}var ld={utils:{getConversationKey:So,calcPaddedLen:To},encrypt:Io,decrypt:Po},fd=2880*60,ic=()=>Math.round(Date.now()/1e3),oc=()=>Math.round(ic()-Math.random()*fd),sc=(e,t)=>So(e,t),ac=(e,t,r)=>Io(JSON.stringify(e),sc(t,r)),Ms=(e,t)=>JSON.parse(Po(e.content,sc(t,e.pubkey)));function cc(e,t){const r={created_at:ic(),content:"",tags:[],...e,pubkey:go(t)};return r.id=xr(r),r}function uc(e,t,r){return lt({kind:Ba,content:ac(e,t,r),created_at:oc(),tags:[]},t)}function lc(e,t){const r=Wl();return lt({kind:Ua,content:ac(e,r,t),created_at:oc(),tags:[["p",t]]},r)}function Or(e,t,r){const o=cc(e,t),s=uc(o,t,r);return lc(s,r)}function hd(e,t,r){if(!r||r.length===0)throw new Error("At least one recipient is required.");const o=go(t),s=[Or(e,t,o)];return r.forEach(c=>{s.push(Or(e,t,c))}),s}function Oo(e,t){const r=Ms(e,t);return Ms(r,t)}function fc(e,t){let r=[];return e.forEach(o=>{r.push(Oo(o,t))}),r.sort((o,s)=>o.created_at-s.created_at),r}function dd(e,t,r,o){const s={created_at:Math.ceil(Date.now()/1e3),kind:Ca,tags:[],content:t};return(Array.isArray(e)?e:[e]).forEach(({publicKey:f,relayUrl:d})=>{s.tags.push(d?["p",f,d]:["p",f])}),o&&s.tags.push(["e",o.eventId,o.relayUrl||"","reply"]),r&&s.tags.push(["subject",r]),s}function hc(e,t,r,o,s){const c=dd(t,r,o,s);return Or(c,e,t.publicKey)}function pd(e,t,r,o,s){if(!t||t.length===0)throw new Error("At least one recipient is required.");return[{publicKey:go(e)},...t].map(f=>hc(e,f,r,o,s))}var yd=Oo,gd=fc,md={};ke(md,{finishRepostEvent:()=>bd,getRepostedEvent:()=>vd,getRepostedEventPointer:()=>dc});function bd(e,t,r,o){let s;const c=[...e.tags??[],["e",t.id,r],["p",t.pubkey]];return t.kind===Oa?s=vo:(s=Eo,c.push(["k",String(t.kind)])),lt({kind:s,tags:c,content:e.content===""||t.tags?.find(f=>f[0]==="-")?"":JSON.stringify(t),created_at:e.created_at},o)}function dc(e){if(![vo,Eo].includes(e.kind))return;let t,r;for(let o=e.tags.length-1;o>=0&&(t===void 0||r===void 0);o--){const s=e.tags[o];s.length>=2&&(s[0]==="e"&&t===void 0?t=s:s[0]==="p"&&r===void 0&&(r=s))}if(t!==void 0)return{id:t[1],relays:[t[2],r?.[2]].filter(o=>typeof o=="string"),author:r?.[1]}}function vd(e,{skipVerification:t}={}){const r=dc(e);if(r===void 0||e.content==="")return;let o;try{o=JSON.parse(e.content)}catch{return}if(o.id===r.id&&!(!t&&!Kr(o)))return o}var wd={};ke(wd,{NOSTR_URI_REGEX:()=>Bo,parse:()=>xd,test:()=>Ed});var Bo=new RegExp(`nostr:(${Wa.source})`);function Ed(e){return typeof e=="string"&&new RegExp(`^${Bo.source}$`).test(e)}function xd(e){const t=e.match(new RegExp(`^${Bo.source}$`));if(!t)throw new Error(`Invalid Nostr URI: ${e}`);return{uri:t[0],value:t[1],decoded:jr(t[1])}}var _d={};ke(_d,{finishReactionEvent:()=>kd,getReactedEventPointer:()=>Ad});function kd(e,t,r){const o=t.tags.filter(s=>s.length>=2&&(s[0]==="e"||s[0]==="p"));return lt({...e,kind:wo,tags:[...e.tags??[],...o,["e",t.id],["p",t.pubkey]],content:e.content??"+"},r)}function Ad(e){if(e.kind!==wo)return;let t,r;for(let o=e.tags.length-1;o>=0&&(t===void 0||r===void 0);o--){const s=e.tags[o];s.length>=2&&(s[0]==="e"&&t===void 0?t=s:s[0]==="p"&&r===void 0&&(r=s))}if(!(t===void 0||r===void 0))return{id:t[1],relays:[t[2],r[2]].filter(o=>o!==void 0),author:r[1]}}var Sd={};ke(Sd,{parse:()=>Id});var $s=/\W/m,Us=/[^\w\/] |[^\w\/]$|$|,| /m,Td=42;function*Id(e){let t=[];if(typeof e!="string"){for(let c=0;c<e.tags.length;c++){const f=e.tags[c];f[0]==="emoji"&&f.length>=3&&t.push({type:"emoji",shortcode:f[1],url:f[2]})}e=e.content}const r=e.length;let o=0,s=0;e:for(;s<r;){const c=e.indexOf(":",s),f=e.indexOf("#",s);if(c===-1&&f===-1)break e;if(c===-1||f>=0&&f<c){if(f===0||e[f-1]===" "){const d=e.slice(f+1,f+Td).match($s),h=d?f+1+d.index:r;yield{type:"text",text:e.slice(o,f)},yield{type:"hashtag",value:e.slice(f+1,h)},s=h,o=s;continue e}s=f+1;continue e}if(e.slice(c-5,c)==="nostr"){const d=e.slice(c+60).match($s),h=d?c+60+d.index:r;try{let m,{data:v,type:b}=jr(e.slice(c+1,h));switch(b){case"npub":m={pubkey:v};break;case"note":m={id:v};break;case"nsec":s=h+1;continue;default:m=v}o!==c-5&&(yield{type:"text",text:e.slice(o,c-5)}),yield{type:"reference",pointer:m},s=h,o=s;continue e}catch{s=c+1;continue e}}else if(e.slice(c-5,c)==="https"||e.slice(c-4,c)==="http"){const d=e.slice(c+4).match(Us),h=d?c+4+d.index:r,m=e[c-1]==="s"?5:4;try{let v=new URL(e.slice(c-m,h));if(v.hostname.indexOf(".")===-1)throw new Error("invalid url");if(o!==c-m&&(yield{type:"text",text:e.slice(o,c-m)}),/\.(png|jpe?g|gif|webp|heic|svg)$/i.test(v.pathname)){yield{type:"image",url:v.toString()},s=h,o=s;continue e}if(/\.(mp4|avi|webm|mkv|mov)$/i.test(v.pathname)){yield{type:"video",url:v.toString()},s=h,o=s;continue e}if(/\.(mp3|aac|ogg|opus|wav|flac)$/i.test(v.pathname)){yield{type:"audio",url:v.toString()},s=h,o=s;continue e}yield{type:"url",url:v.toString()},s=h,o=s;continue e}catch{s=h+1;continue e}}else if(e.slice(c-3,c)==="wss"||e.slice(c-2,c)==="ws"){const d=e.slice(c+4).match(Us),h=d?c+4+d.index:r,m=e[c-1]==="s"?3:2;try{let v=new URL(e.slice(c-m,h));if(v.hostname.indexOf(".")===-1)throw new Error("invalid ws url");o!==c-m&&(yield{type:"text",text:e.slice(o,c-m)}),yield{type:"relay",url:v.toString()},s=h,o=s;continue e}catch{s=h+1;continue e}}else{for(let d=0;d<t.length;d++){const h=t[d];if(e[c+h.shortcode.length+1]===":"&&e.slice(c+1,c+h.shortcode.length+1)===h.shortcode){o!==c&&(yield{type:"text",text:e.slice(o,c)}),yield h,s=c+h.shortcode.length+2,o=s;continue e}}s=c+1;continue e}}o!==r&&(yield{type:"text",text:e.slice(o)})}var Pd={};ke(Pd,{channelCreateEvent:()=>Od,channelHideMessageEvent:()=>Rd,channelMessageEvent:()=>Cd,channelMetadataEvent:()=>Bd,channelMuteUserEvent:()=>Ld});var Od=(e,t)=>{let r;if(typeof e.content=="object")r=JSON.stringify(e.content);else if(typeof e.content=="string")r=e.content;else return;return lt({kind:Ra,tags:[...e.tags??[]],content:r,created_at:e.created_at},t)},Bd=(e,t)=>{let r;if(typeof e.content=="object")r=JSON.stringify(e.content);else if(typeof e.content=="string")r=e.content;else return;return lt({kind:La,tags:[["e",e.channel_create_event_id],...e.tags??[]],content:r,created_at:e.created_at},t)},Cd=(e,t)=>{const r=[["e",e.channel_create_event_id,e.relay_url,"root"]];return e.reply_to_channel_message_event_id&&r.push(["e",e.reply_to_channel_message_event_id,e.relay_url,"reply"]),lt({kind:Na,tags:[...r,...e.tags??[]],content:e.content,created_at:e.created_at},t)},Rd=(e,t)=>{let r;if(typeof e.content=="object")r=JSON.stringify(e.content);else if(typeof e.content=="string")r=e.content;else return;return lt({kind:Ma,tags:[["e",e.channel_message_event_id],...e.tags??[]],content:r,created_at:e.created_at},t)},Ld=(e,t)=>{let r;if(typeof e.content=="object")r=JSON.stringify(e.content);else if(typeof e.content=="string")r=e.content;else return;return lt({kind:$a,tags:[["p",e.pubkey_to_mute],...e.tags??[]],content:r,created_at:e.created_at},t)},Nd={};ke(Nd,{EMOJI_SHORTCODE_REGEX:()=>pc,matchAll:()=>Md,regex:()=>Co,replaceAll:()=>$d});var pc=/:(\w+):/,Co=()=>new RegExp(`\\B${pc.source}\\B`,"g");function*Md(e){const t=e.matchAll(Co());for(const r of t)try{const[o,s]=r;yield{shortcode:o,name:s,start:r.index,end:r.index+o.length}}catch{}}function $d(e,t){return e.replaceAll(Co(),(r,o)=>t({shortcode:r,name:o}))}var Ud={};ke(Ud,{useFetchImplementation:()=>Kd,validateGithub:()=>qd});var Ro;try{Ro=fetch}catch{}function Kd(e){Ro=e}async function qd(e,t,r){try{return await(await Ro(`https://gist.github.com/${t}/${r}/raw`)).text()===`Verifying that I control the following Nostr public key: ${e}`}catch{return!1}}var jd={};ke(jd,{makeNwcRequestEvent:()=>Hd,parseConnectionString:()=>Dd});function Dd(e){const{host:t,pathname:r,searchParams:o}=new URL(e),s=r||t,c=o.get("relay"),f=o.get("secret");if(!s||!c||!f)throw new Error("invalid connection string");return{pubkey:s,relay:c,secret:f}}async function Hd(e,t,r){const s=Ga(t,e,JSON.stringify({method:"pay_invoice",params:{invoice:r}})),c={kind:qa,created_at:Math.round(Date.now()/1e3),content:s,tags:[["p",e]]};return lt(c,t)}var Fd={};ke(Fd,{normalizeIdentifier:()=>Vd});function Vd(e){return e=e.trim().toLowerCase(),e=e.normalize("NFKC"),Array.from(e).map(t=>/\p{Letter}/u.test(t)||/\p{Number}/u.test(t)?t:"-").join("")}var zd={};ke(zd,{getSatoshisAmountFromBolt11:()=>Xd,getZapEndpoint:()=>Gd,makeZapReceipt:()=>Jd,makeZapRequest:()=>Zd,useFetchImplementation:()=>Wd,validateZapRequest:()=>Yd});var Lo;try{Lo=fetch}catch{}function Wd(e){Lo=e}async function Gd(e){try{let t="",{lud06:r,lud16:o}=JSON.parse(e.content);if(o){let[f,d]=o.split("@");t=new URL(`/.well-known/lnurlp/${f}`,`https://${d}`).toString()}else if(r){let{words:f}=xn.decode(r,1e3),d=xn.fromWords(f);t=vt.decode(d)}else return null;let c=await(await Lo(t)).json();if(c.allowsNostr&&c.nostrPubkey)return c.callback}catch{}return null}function Zd(e){let t={kind:9734,created_at:Math.round(Date.now()/1e3),content:e.comment||"",tags:[["p","pubkey"in e?e.pubkey:e.event.pubkey],["amount",e.amount.toString()],["relays",...e.relays]]};if("event"in e){if(t.tags.push(["e",e.event.id]),mo(e.event.kind)){const r=["a",`${e.event.kind}:${e.event.pubkey}:`];t.tags.push(r)}else if(bo(e.event.kind)){let r=e.event.tags.find(([s,c])=>s==="d"&&c);if(!r)throw new Error("d tag not found or is empty");const o=["a",`${e.event.kind}:${e.event.pubkey}:${r[1]}`];t.tags.push(o)}t.tags.push(["k",e.event.kind.toString()])}return t}function Yd(e){let t;try{t=JSON.parse(e)}catch{return"Invalid zap request JSON."}if(!po(t))return"Zap request is not a valid Nostr event.";if(!Kr(t))return"Invalid signature on zap request.";let r=t.tags.find(([c,f])=>c==="p"&&f);if(!r)return"Zap request doesn't have a 'p' tag.";if(!r[1].match(/^[a-f0-9]{64}$/))return"Zap request 'p' tag is not valid hex.";let o=t.tags.find(([c,f])=>c==="e"&&f);return o&&!o[1].match(/^[a-f0-9]{64}$/)?"Zap request 'e' tag is not valid hex.":t.tags.find(([c,f])=>c==="relays"&&f)?null:"Zap request doesn't have a 'relays' tag."}function Jd({zapRequest:e,preimage:t,bolt11:r,paidAt:o}){let s=JSON.parse(e),c=s.tags.filter(([d])=>d==="e"||d==="p"||d==="a"),f={kind:9735,created_at:Math.round(o.getTime()/1e3),content:"",tags:[...c,["P",s.pubkey],["bolt11",r],["description",e]]};return t&&f.tags.push(["preimage",t]),f}function Xd(e){if(e.length<50)return 0;e=e.substring(0,50);const t=e.lastIndexOf("1");if(t===-1)return 0;const r=e.substring(0,t);if(!r.startsWith("lnbc"))return 0;const o=r.substring(4);if(o.length<1)return 0;const s=o[o.length-1],c=s.charCodeAt(0)-48,f=c>=0&&c<=9;let d=o.length-1;if(f&&d++,d<1)return 0;const h=parseInt(o.substring(0,d));switch(s){case"m":return h*1e5;case"u":return h*100;case"n":return h/10;case"p":return h/1e4;default:return h*1e8}}var Qd={};ke(Qd,{Negentropy:()=>gc,NegentropyStorageVector:()=>np,NegentropySync:()=>rp});var Ki=97,bn=32,yc=16,Zt={Skip:0,Fingerprint:1,IdList:2},bt=class{_raw;length;constructor(e){typeof e=="number"?(this._raw=new Uint8Array(e),this.length=0):e instanceof Uint8Array?(this._raw=new Uint8Array(e),this.length=e.length):(this._raw=new Uint8Array(512),this.length=0)}unwrap(){return this._raw.subarray(0,this.length)}get capacity(){return this._raw.byteLength}extend(e){if(e instanceof bt&&(e=e.unwrap()),typeof e.length!="number")throw Error("bad length");const t=e.length+this.length;if(this.capacity<t){const r=this._raw,o=Math.max(this.capacity*2,t);this._raw=new Uint8Array(o),this._raw.set(r)}this._raw.set(e,this.length),this.length+=e.length}shift(){const e=this._raw[0];return this._raw=this._raw.subarray(1),this.length--,e}shiftN(e=1){const t=this._raw.subarray(0,e);return this._raw=this._raw.subarray(e),this.length-=e,t}};function Er(e){let t=0;for(;;){if(e.length===0)throw Error("parse ends prematurely");let r=e.shift();if(t=t<<7|r&127,(r&128)===0)break}return t}function gt(e){if(e===0)return new bt(new Uint8Array([0]));let t=[];for(;e!==0;)t.push(e&127),e>>>=7;t.reverse();for(let r=0;r<t.length-1;r++)t[r]|=128;return new bt(new Uint8Array(t))}function ep(e){return _r(e,1)[0]}function _r(e,t){if(e.length<t)throw Error("parse ends prematurely");return e.shiftN(t)}var tp=class{buf;constructor(){this.setToZero()}setToZero(){this.buf=new Uint8Array(bn)}add(e){let t=0,r=0,o=new DataView(this.buf.buffer),s=new DataView(e.buffer);for(let c=0;c<8;c++){let f=c*4,d=o.getUint32(f,!0),h=s.getUint32(f,!0),m=d;m+=t,m+=h,m>4294967295&&(r=1),o.setUint32(f,m&4294967295,!0),t=r,r=0}}negate(){let e=new DataView(this.buf.buffer);for(let r=0;r<8;r++){let o=r*4;e.setUint32(o,~e.getUint32(o,!0))}let t=new Uint8Array(bn);t[0]=1,this.add(t)}getFingerprint(e){let t=new bt;return t.extend(this.buf),t.extend(gt(e)),rn(t.unwrap()).subarray(0,yc)}},np=class{items;sealed;constructor(){this.items=[],this.sealed=!1}insert(e,t){if(this.sealed)throw Error("already sealed");const r=ya(t);if(r.byteLength!==bn)throw Error("bad id size for added item");this.items.push({timestamp:e,id:r})}seal(){if(this.sealed)throw Error("already sealed");this.sealed=!0,this.items.sort(qi);for(let e=1;e<this.items.length;e++)if(qi(this.items[e-1],this.items[e])===0)throw Error("duplicate item inserted")}unseal(){this.sealed=!1}size(){return this._checkSealed(),this.items.length}getItem(e){if(this._checkSealed(),e>=this.items.length)throw Error("out of range");return this.items[e]}iterate(e,t,r){this._checkSealed(),this._checkBounds(e,t);for(let o=e;o<t&&r(this.items[o],o);++o);}findLowerBound(e,t,r){return this._checkSealed(),this._checkBounds(e,t),this._binarySearch(this.items,e,t,o=>qi(o,r)<0)}fingerprint(e,t){let r=new tp;return r.setToZero(),this.iterate(e,t,o=>(r.add(o.id),!0)),r.getFingerprint(t-e)}_checkSealed(){if(!this.sealed)throw Error("not sealed")}_checkBounds(e,t){if(e>t||t>this.items.length)throw Error("bad range")}_binarySearch(e,t,r,o){let s=r-t;for(;s>0;){let c=t,f=Math.floor(s/2);c+=f,o(e[c])?(t=++c,s-=f+1):s=f}return t}},gc=class{storage;frameSizeLimit;lastTimestampIn;lastTimestampOut;constructor(e,t=6e4){if(t<4096)throw Error("frameSizeLimit too small");this.storage=e,this.frameSizeLimit=t,this.lastTimestampIn=0,this.lastTimestampOut=0}_bound(e,t){return{timestamp:e,id:t||new Uint8Array(0)}}initiate(){let e=new bt;return e.extend(new Uint8Array([Ki])),this.splitRange(0,this.storage.size(),this._bound(Number.MAX_VALUE),e),yn(e.unwrap())}reconcile(e,t,r){const o=new bt(ya(e));this.lastTimestampIn=this.lastTimestampOut=0;let s=new bt;s.extend(new Uint8Array([Ki]));let c=ep(o);if(c<96||c>111)throw Error("invalid negentropy protocol version byte");if(c!==Ki)throw Error("unsupported negentropy protocol version requested: "+(c-96));let f=this.storage.size(),d=this._bound(0),h=0,m=!1;for(;o.length!==0;){let v=new bt,b=()=>{m&&(m=!1,v.extend(this.encodeBound(d)),v.extend(gt(Zt.Skip)))},C=this.decodeBound(o),N=Er(o),L=h,O=this.storage.findLowerBound(h,f,C);if(N===Zt.Skip)m=!0;else if(N===Zt.Fingerprint){let R=_r(o,yc),$=this.storage.fingerprint(L,O);mc(R,$)!==0?(b(),this.splitRange(L,O,C,v)):m=!0}else if(N===Zt.IdList){let R=Er(o),$={};for(let F=0;F<R;F++){let ee=_r(o,bn);$[yn(ee)]=ee}if(m=!0,this.storage.iterate(L,O,F=>{let ee=F.id;const se=yn(ee);return $[se]?delete $[yn(ee)]:t?.(se),!0}),r)for(let F of Object.values($))r(yn(F))}else throw Error("unexpected mode");if(this.exceededFrameSizeLimit(s.length+v.length)){let R=this.storage.fingerprint(O,f);s.extend(this.encodeBound(this._bound(Number.MAX_VALUE))),s.extend(gt(Zt.Fingerprint)),s.extend(R);break}else s.extend(v);h=O,d=C}return s.length===1?null:yn(s.unwrap())}splitRange(e,t,r,o){let s=t-e,c=16;if(s<c*2)o.extend(this.encodeBound(r)),o.extend(gt(Zt.IdList)),o.extend(gt(s)),this.storage.iterate(e,t,f=>(o.extend(f.id),!0));else{let f=Math.floor(s/c),d=s%c,h=e;for(let m=0;m<c;m++){let v=f+(m<d?1:0),b=this.storage.fingerprint(h,h+v);h+=v;let C;if(h===t)C=r;else{let N,L;this.storage.iterate(h-1,h+1,(O,R)=>(R===h-1?N=O:L=O,!0)),C=this.getMinimalBound(N,L)}o.extend(this.encodeBound(C)),o.extend(gt(Zt.Fingerprint)),o.extend(b)}}}exceededFrameSizeLimit(e){return e>this.frameSizeLimit-200}decodeTimestampIn(e){let t=Er(e);return t=t===0?Number.MAX_VALUE:t-1,this.lastTimestampIn===Number.MAX_VALUE||t===Number.MAX_VALUE?(this.lastTimestampIn=Number.MAX_VALUE,Number.MAX_VALUE):(t+=this.lastTimestampIn,this.lastTimestampIn=t,t)}decodeBound(e){let t=this.decodeTimestampIn(e),r=Er(e);if(r>bn)throw Error("bound key too long");let o=_r(e,r);return{timestamp:t,id:o}}encodeTimestampOut(e){if(e===Number.MAX_VALUE)return this.lastTimestampOut=Number.MAX_VALUE,gt(0);let t=e;return e-=this.lastTimestampOut,this.lastTimestampOut=t,gt(e+1)}encodeBound(e){let t=new bt;return t.extend(this.encodeTimestampOut(e.timestamp)),t.extend(gt(e.id.length)),t.extend(e.id),t}getMinimalBound(e,t){if(t.timestamp!==e.timestamp)return this._bound(t.timestamp);{let r=0,o=t.id,s=e.id;for(let c=0;c<bn&&o[c]===s[c];c++)r++;return this._bound(t.timestamp,t.id.subarray(0,r+1))}}};function mc(e,t){for(let r=0;r<e.byteLength;r++){if(e[r]<t[r])return-1;if(e[r]>t[r])return 1}return e.byteLength>t.byteLength?1:e.byteLength<t.byteLength?-1:0}function qi(e,t){return e.timestamp===t.timestamp?mc(e.id,t.id):e.timestamp-t.timestamp}var rp=class{relay;storage;neg;filter;subscription;onhave;onneed;constructor(e,t,r,o={}){this.relay=e,this.storage=t,this.neg=new gc(t),this.onhave=o.onhave,this.onneed=o.onneed,this.filter=r,this.subscription=this.relay.prepareSubscription([{}],{label:o.label||"negentropy"}),this.subscription.oncustom=s=>{switch(s[0]){case"NEG-MSG":{s.length<3&&console.warn(`got invalid NEG-MSG from ${this.relay.url}: ${s}`);try{const c=this.neg.reconcile(s[2],this.onhave,this.onneed);c?this.relay.send(`["NEG-MSG", "${this.subscription.id}", "${c}"]`):(this.close(),o.onclose?.())}catch(c){console.error("negentropy reconcile error:",c),o?.onclose?.(`reconcile error: ${c}`)}break}case"NEG-CLOSE":{const c=s[2];console.warn("negentropy error:",c),o.onclose?.(c);break}case"NEG-ERR":o.onclose?.()}}}async start(){const e=this.neg.initiate();this.relay.send(`["NEG-OPEN","${this.subscription.id}",${JSON.stringify(this.filter)},"${e}"]`)}close(){this.relay.send(`["NEG-CLOSE","${this.subscription.id}"]`),this.subscription.close()}},ip={};ke(ip,{getToken:()=>op,hashPayload:()=>No,unpackEventFromToken:()=>vc,validateEvent:()=>Ac,validateEventKind:()=>Ec,validateEventMethodTag:()=>_c,validateEventPayloadTag:()=>kc,validateEventTimestamp:()=>wc,validateEventUrlTag:()=>xc,validateToken:()=>sp});var bc="Nostr ";async function op(e,t,r,o=!1,s){const c={kind:xo,tags:[["u",e],["method",t]],created_at:Math.round(new Date().getTime()/1e3),content:""};s&&c.tags.push(["payload",No(s)]);const f=await r(c);return(o?bc:"")+wt.encode(Qe.encode(JSON.stringify(f)))}async function sp(e,t,r){const o=await vc(e).catch(c=>{throw c});return await Ac(o,t,r).catch(c=>{throw c})}async function vc(e){if(!e)throw new Error("Missing token");e=e.replace(bc,"");const t=vt.decode(wt.decode(e));if(!t||t.length===0||!t.startsWith("{"))throw new Error("Invalid token");return JSON.parse(t)}function wc(e){return e.created_at?Math.round(new Date().getTime()/1e3)-e.created_at<60:!1}function Ec(e){return e.kind===xo}function xc(e,t){const r=e.tags.find(o=>o[0]==="u");return r?r.length>0&&r[1]===t:!1}function _c(e,t){const r=e.tags.find(o=>o[0]==="method");return r?r.length>0&&r[1].toLowerCase()===t.toLowerCase():!1}function No(e){const t=rn(Qe.encode(JSON.stringify(e)));return Ke(t)}function kc(e,t){const r=e.tags.find(s=>s[0]==="payload");if(!r)return!1;const o=No(t);return r.length>0&&r[1]===o}async function Ac(e,t,r,o){if(!Kr(e))throw new Error("Invalid nostr event, signature invalid");if(!Ec(e))throw new Error("Invalid nostr event, kind invalid");if(!wc(e))throw new Error("Invalid nostr event, created_at timestamp invalid");if(!xc(e,t))throw new Error("Invalid nostr event, url tag invalid");if(!_c(e,r))throw new Error("Invalid nostr event, method tag invalid");if(o&&typeof o=="object"&&Object.keys(o).length>0&&!kc(e,o))throw new Error("Invalid nostr event, payload tag does not match request body hash");return!0}var ap=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function cp(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}const Dn=["wss://relay.zapstore.dev","wss://relay.vertexlab.io"],Mo=["wss://relay.damus.io","wss://relay.primal.net","wss://nos.lol"];[...Mo,...Dn];const qp=6e4,We={PROFILE:0,RELAY_LIST:10002,COMMENT:1111,FILE_METADATA:1063,ZAP_REQUEST:9734,ZAP_RECEIPT:9735,RELEASE:30063,APP:32267,APP_STACK:30267},zn={"#f":["android-arm64-v8a"]};var kr={exports:{}},up=kr.exports,Ks;function lp(){return Ks||(Ks=1,(function(e,t){((r,o)=>{e.exports=o()})(up,function(){var r=function(n,i){return(r=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(a,u){a.__proto__=u}:function(a,u){for(var l in u)Object.prototype.hasOwnProperty.call(u,l)&&(a[l]=u[l])}))(n,i)},o=function(){return(o=Object.assign||function(n){for(var i,a=1,u=arguments.length;a<u;a++)for(var l in i=arguments[a])Object.prototype.hasOwnProperty.call(i,l)&&(n[l]=i[l]);return n}).apply(this,arguments)};function s(n,i,a){for(var u,l=0,p=i.length;l<p;l++)!u&&l in i||((u=u||Array.prototype.slice.call(i,0,l))[l]=i[l]);return n.concat(u||Array.prototype.slice.call(i))}var c=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:ap,f=Object.keys,d=Array.isArray;function h(n,i){return typeof i=="object"&&f(i).forEach(function(a){n[a]=i[a]}),n}typeof Promise>"u"||c.Promise||(c.Promise=Promise);var m=Object.getPrototypeOf,v={}.hasOwnProperty;function b(n,i){return v.call(n,i)}function C(n,i){typeof i=="function"&&(i=i(m(n))),(typeof Reflect>"u"?f:Reflect.ownKeys)(i).forEach(function(a){L(n,a,i[a])})}var N=Object.defineProperty;function L(n,i,a,u){N(n,i,h(a&&b(a,"get")&&typeof a.get=="function"?{get:a.get,set:a.set,configurable:!0}:{value:a,configurable:!0,writable:!0},u))}function O(n){return{from:function(i){return n.prototype=Object.create(i.prototype),L(n.prototype,"constructor",n),{extend:C.bind(null,n.prototype)}}}}var R=Object.getOwnPropertyDescriptor,$=[].slice;function F(n,i,a){return $.call(n,i,a)}function ee(n,i){return i(n)}function se(n){if(!n)throw new Error("Assertion Failed")}function ce(n){c.setImmediate?setImmediate(n):setTimeout(n,0)}function z(n,i){if(typeof i=="string"&&b(n,i))return n[i];if(!i)return n;if(typeof i!="string"){for(var a=[],u=0,l=i.length;u<l;++u){var p=z(n,i[u]);a.push(p)}return a}var y,g=i.indexOf(".");return g===-1||(y=n[i.substr(0,g)])==null?void 0:z(y,i.substr(g+1))}function Z(n,i,a){if(n&&i!==void 0&&!("isFrozen"in Object&&Object.isFrozen(n)))if(typeof i!="string"&&"length"in i){se(typeof a!="string"&&"length"in a);for(var u=0,l=i.length;u<l;++u)Z(n,i[u],a[u])}else{var p,y,g=i.indexOf(".");g!==-1?(p=i.substr(0,g),(g=i.substr(g+1))===""?a===void 0?d(n)&&!isNaN(parseInt(p))?n.splice(p,1):delete n[p]:n[p]=a:Z(y=(y=n[p])&&b(n,p)?y:n[p]={},g,a)):a===void 0?d(n)&&!isNaN(parseInt(i))?n.splice(i,1):delete n[i]:n[i]=a}}function te(n){var i,a={};for(i in n)b(n,i)&&(a[i]=n[i]);return a}var xe=[].concat;function le(n){return xe.apply([],n)}var fe="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(le([8,16,32,64].map(function(n){return["Int","Uint","Float"].map(function(i){return i+n+"Array"})}))).filter(function(n){return c[n]}),ae=new Set(fe.map(function(n){return c[n]})),me=null;function pe(n){return me=new WeakMap,n=(function i(a){if(!a||typeof a!="object")return a;var u=me.get(a);if(u)return u;if(d(a)){u=[],me.set(a,u);for(var l=0,p=a.length;l<p;++l)u.push(i(a[l]))}else if(ae.has(a.constructor))u=a;else{var y,g=m(a);for(y in u=g===Object.prototype?{}:Object.create(g),me.set(a,u),a)b(a,y)&&(u[y]=i(a[y]))}return u})(n),me=null,n}var Ae={}.toString;function q(n){return Ae.call(n).slice(8,-1)}var V=typeof Symbol<"u"?Symbol.iterator:"@@iterator",ne=typeof V=="symbol"?function(n){var i;return n!=null&&(i=n[V])&&i.apply(n)}:function(){return null};function oe(n,i){i=n.indexOf(i),0<=i&&n.splice(i,1)}var ie={};function ue(n){var i,a,u,l;if(arguments.length===1){if(d(n))return n.slice();if(this===ie&&typeof n=="string")return[n];if(l=ne(n))for(a=[];!(u=l.next()).done;)a.push(u.value);else{if(n==null)return[n];if(typeof(i=n.length)!="number")return[n];for(a=new Array(i);i--;)a[i]=n[i]}}else for(i=arguments.length,a=new Array(i);i--;)a[i]=arguments[i];return a}var Ee=typeof Symbol<"u"?function(n){return n[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},fe=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Ve=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(fe),Fe={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function je(n,i){this.name=n,this.message=i}function ft(n,i){return n+". Errors: "+Object.keys(i).map(function(a){return i[a].toString()}).filter(function(a,u,l){return l.indexOf(a)===u}).join(`
`)}function et(n,i,a,u){this.failures=i,this.failedKeys=u,this.successCount=a,this.message=ft(n,i)}function De(n,i){this.name="BulkError",this.failures=Object.keys(i).map(function(a){return i[a]}),this.failuresByPos=i,this.message=ft(n,this.failures)}O(je).from(Error).extend({toString:function(){return this.name+": "+this.message}}),O(et).from(je),O(De).from(je);var Kt=Ve.reduce(function(n,i){return n[i]=i+"Error",n},{}),ht=je,X=Ve.reduce(function(n,i){var a=i+"Error";function u(l,p){this.name=a,l?typeof l=="string"?(this.message="".concat(l).concat(p?`
 `+p:""),this.inner=p||null):typeof l=="object"&&(this.message="".concat(l.name," ").concat(l.message),this.inner=l):(this.message=Fe[i]||a,this.inner=null)}return O(u).from(ht),n[i]=u,n},{}),Sn=(X.Syntax=SyntaxError,X.Type=TypeError,X.Range=RangeError,fe.reduce(function(n,i){return n[i+"Error"]=X[i],n},{}));fe=Ve.reduce(function(n,i){return["Syntax","Type","Range"].indexOf(i)===-1&&(n[i+"Error"]=X[i]),n},{});function he(){}function Ge(n){return n}function on(n,i){return n==null||n===Ge?i:function(a){return i(n(a))}}function tt(n,i){return function(){n.apply(this,arguments),i.apply(this,arguments)}}function Gn(n,i){return n===he?i:function(){var a=n.apply(this,arguments),u=(a!==void 0&&(arguments[0]=a),this.onsuccess),l=this.onerror,p=(this.onsuccess=null,this.onerror=null,i.apply(this,arguments));return u&&(this.onsuccess=this.onsuccess?tt(u,this.onsuccess):u),l&&(this.onerror=this.onerror?tt(l,this.onerror):l),p!==void 0?p:a}}function Sc(n,i){return n===he?i:function(){n.apply(this,arguments);var a=this.onsuccess,u=this.onerror;this.onsuccess=this.onerror=null,i.apply(this,arguments),a&&(this.onsuccess=this.onsuccess?tt(a,this.onsuccess):a),u&&(this.onerror=this.onerror?tt(u,this.onerror):u)}}function Tc(n,i){return n===he?i:function(l){var u=n.apply(this,arguments),l=(h(l,u),this.onsuccess),p=this.onerror,y=(this.onsuccess=null,this.onerror=null,i.apply(this,arguments));return l&&(this.onsuccess=this.onsuccess?tt(l,this.onsuccess):l),p&&(this.onerror=this.onerror?tt(p,this.onerror):p),u===void 0?y===void 0?void 0:y:h(u,y)}}function Ic(n,i){return n===he?i:function(){return i.apply(this,arguments)!==!1&&n.apply(this,arguments)}}function Wr(n,i){return n===he?i:function(){var a=n.apply(this,arguments);if(a&&typeof a.then=="function"){for(var u=this,l=arguments.length,p=new Array(l);l--;)p[l]=arguments[l];return a.then(function(){return i.apply(u,p)})}return i.apply(this,arguments)}}fe.ModifyError=et,fe.DexieError=je,fe.BulkError=De;var nt=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Uo(n){nt=n}var Tn={},Ko=100,In=typeof Promise>"u"?[]:(Ve=Promise.resolve(),typeof crypto<"u"&&crypto.subtle?[In=crypto.subtle.digest("SHA-512",new Uint8Array([0])),m(In),Ve]:[Ve,m(Ve),Ve]),Ve=In[0],dn=In[1],dn=dn&&dn.then,qt=Ve&&Ve.constructor,Gr=!!In[2],Pn=function(n,i){On.push([n,i]),Zn&&(queueMicrotask(Oc),Zn=!1)},Zr=!0,Zn=!0,jt=[],Yn=[],Yr=Ge,kt={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:he,pgp:!1,env:{},finalize:he},Q=kt,On=[],Dt=0,Jn=[];function W(n){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var i=this._PSD=Q;if(typeof n!="function"){if(n!==Tn)throw new TypeError("Not a function");this._state=arguments[1],this._value=arguments[2],this._state===!1&&Xr(this,this._value)}else this._state=null,this._value=null,++i.ref,(function a(u,l){try{l(function(p){if(u._state===null){if(p===u)throw new TypeError("A promise cannot be resolved with itself.");var y=u._lib&&sn();p&&typeof p.then=="function"?a(u,function(g,x){p instanceof W?p._then(g,x):p.then(g,x)}):(u._state=!0,u._value=p,jo(u)),y&&an()}},Xr.bind(null,u))}catch(p){Xr(u,p)}})(this,n)}var Jr={get:function(){var n=Q,i=tr;function a(u,l){var p=this,y=!n.global&&(n!==Q||i!==tr),g=y&&!St(),x=new W(function(I,_){Qr(p,new qo(Ho(u,n,y,g),Ho(l,n,y,g),I,_,n))});return this._consoleTask&&(x._consoleTask=this._consoleTask),x}return a.prototype=Tn,a},set:function(n){L(this,"then",n&&n.prototype===Tn?Jr:{get:function(){return n},set:Jr.set})}};function qo(n,i,a,u,l){this.onFulfilled=typeof n=="function"?n:null,this.onRejected=typeof i=="function"?i:null,this.resolve=a,this.reject=u,this.psd=l}function Xr(n,i){var a,u;Yn.push(i),n._state===null&&(a=n._lib&&sn(),i=Yr(i),n._state=!1,n._value=i,u=n,jt.some(function(l){return l._value===u._value})||jt.push(u),jo(n),a)&&an()}function jo(n){var i=n._listeners;n._listeners=[];for(var a=0,u=i.length;a<u;++a)Qr(n,i[a]);var l=n._PSD;--l.ref||l.finalize(),Dt===0&&(++Dt,Pn(function(){--Dt==0&&ei()},[]))}function Qr(n,i){if(n._state===null)n._listeners.push(i);else{var a=n._state?i.onFulfilled:i.onRejected;if(a===null)return(n._state?i.resolve:i.reject)(n._value);++i.psd.ref,++Dt,Pn(Pc,[a,n,i])}}function Pc(n,i,a){try{var u,l=i._value;!i._state&&Yn.length&&(Yn=[]),u=nt&&i._consoleTask?i._consoleTask.run(function(){return n(l)}):n(l),i._state||Yn.indexOf(l)!==-1||(p=>{for(var y=jt.length;y;)if(jt[--y]._value===p._value)return jt.splice(y,1)})(i),a.resolve(u)}catch(p){a.reject(p)}finally{--Dt==0&&ei(),--a.psd.ref||a.psd.finalize()}}function Oc(){Ht(kt,function(){sn()&&an()})}function sn(){var n=Zr;return Zn=Zr=!1,n}function an(){var n,i,a;do for(;0<On.length;)for(n=On,On=[],a=n.length,i=0;i<a;++i){var u=n[i];u[0].apply(null,u[1])}while(0<On.length);Zn=Zr=!0}function ei(){for(var n=jt,i=(jt=[],n.forEach(function(u){u._PSD.onunhandled.call(null,u._value,u)}),Jn.slice(0)),a=i.length;a;)i[--a]()}function Xn(n){return new W(Tn,!1,n)}function Se(n,i){var a=Q;return function(){var u=sn(),l=Q;try{return Tt(a,!0),n.apply(this,arguments)}catch(p){i&&i(p)}finally{Tt(l,!1),u&&an()}}}C(W.prototype,{then:Jr,_then:function(n,i){Qr(this,new qo(null,null,n,i,Q))},catch:function(n){var i,a;return arguments.length===1?this.then(null,n):(i=n,a=arguments[1],typeof i=="function"?this.then(null,function(u){return(u instanceof i?a:Xn)(u)}):this.then(null,function(u){return(u&&u.name===i?a:Xn)(u)}))},finally:function(n){return this.then(function(i){return W.resolve(n()).then(function(){return i})},function(i){return W.resolve(n()).then(function(){return Xn(i)})})},timeout:function(n,i){var a=this;return n<1/0?new W(function(u,l){var p=setTimeout(function(){return l(new X.Timeout(i))},n);a.then(u,l).finally(clearTimeout.bind(null,p))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&L(W.prototype,Symbol.toStringTag,"Dexie.Promise"),kt.env=Do(),C(W,{all:function(){var n=ue.apply(null,arguments).map(nr);return new W(function(i,a){n.length===0&&i([]);var u=n.length;n.forEach(function(l,p){return W.resolve(l).then(function(y){n[p]=y,--u||i(n)},a)})})},resolve:function(n){return n instanceof W?n:n&&typeof n.then=="function"?new W(function(i,a){n.then(i,a)}):new W(Tn,!0,n)},reject:Xn,race:function(){var n=ue.apply(null,arguments).map(nr);return new W(function(i,a){n.map(function(u){return W.resolve(u).then(i,a)})})},PSD:{get:function(){return Q},set:function(n){return Q=n}},totalEchoes:{get:function(){return tr}},newPSD:At,usePSD:Ht,scheduler:{get:function(){return Pn},set:function(n){Pn=n}},rejectionMapper:{get:function(){return Yr},set:function(n){Yr=n}},follow:function(n,i){return new W(function(a,u){return At(function(l,p){var y=Q;y.unhandleds=[],y.onunhandled=p,y.finalize=tt(function(){var g,x=this;g=function(){x.unhandleds.length===0?l():p(x.unhandleds[0])},Jn.push(function I(){g(),Jn.splice(Jn.indexOf(I),1)}),++Dt,Pn(function(){--Dt==0&&ei()},[])},y.finalize),n()},i,a,u)})}}),qt&&(qt.allSettled&&L(W,"allSettled",function(){var n=ue.apply(null,arguments).map(nr);return new W(function(i){n.length===0&&i([]);var a=n.length,u=new Array(a);n.forEach(function(l,p){return W.resolve(l).then(function(y){return u[p]={status:"fulfilled",value:y}},function(y){return u[p]={status:"rejected",reason:y}}).then(function(){return--a||i(u)})})})}),qt.any&&typeof AggregateError<"u"&&L(W,"any",function(){var n=ue.apply(null,arguments).map(nr);return new W(function(i,a){n.length===0&&a(new AggregateError([]));var u=n.length,l=new Array(u);n.forEach(function(p,y){return W.resolve(p).then(function(g){return i(g)},function(g){l[y]=g,--u||a(new AggregateError(l))})})})}),qt.withResolvers)&&(W.withResolvers=qt.withResolvers);var Ce={awaits:0,echoes:0,id:0},Bc=0,Qn=[],er=0,tr=0,Cc=0;function At(n,y,a,u){var l=Q,p=Object.create(l),y=(p.parent=l,p.ref=0,p.global=!1,p.id=++Cc,kt.env,p.env=Gr?{Promise:W,PromiseProp:{value:W,configurable:!0,writable:!0},all:W.all,race:W.race,allSettled:W.allSettled,any:W.any,resolve:W.resolve,reject:W.reject}:{},y&&h(p,y),++l.ref,p.finalize=function(){--this.parent.ref||this.parent.finalize()},Ht(p,n,a,u));return p.ref===0&&p.finalize(),y}function cn(){return Ce.id||(Ce.id=++Bc),++Ce.awaits,Ce.echoes+=Ko,Ce.id}function St(){return!!Ce.awaits&&(--Ce.awaits==0&&(Ce.id=0),Ce.echoes=Ce.awaits*Ko,!0)}function nr(n){return Ce.echoes&&n&&n.constructor===qt?(cn(),n.then(function(i){return St(),i},function(i){return St(),Pe(i)})):n}function Rc(){var n=Qn[Qn.length-1];Qn.pop(),Tt(n,!1)}function Tt(n,i){var a,u,l=Q;(i?!Ce.echoes||er++&&n===Q:!er||--er&&n===Q)||queueMicrotask(i?function(p){++tr,Ce.echoes&&--Ce.echoes!=0||(Ce.echoes=Ce.awaits=Ce.id=0),Qn.push(Q),Tt(p,!0)}.bind(null,n):Rc),n!==Q&&(Q=n,l===kt&&(kt.env=Do()),Gr)&&(a=kt.env.Promise,u=n.env,l.global||n.global)&&(Object.defineProperty(c,"Promise",u.PromiseProp),a.all=u.all,a.race=u.race,a.resolve=u.resolve,a.reject=u.reject,u.allSettled&&(a.allSettled=u.allSettled),u.any)&&(a.any=u.any)}function Do(){var n=c.Promise;return Gr?{Promise:n,PromiseProp:Object.getOwnPropertyDescriptor(c,"Promise"),all:n.all,race:n.race,allSettled:n.allSettled,any:n.any,resolve:n.resolve,reject:n.reject}:{}}function Ht(n,i,a,u,l){var p=Q;try{return Tt(n,!0),i(a,u,l)}finally{Tt(p,!1)}}function Ho(n,i,a,u){return typeof n!="function"?n:function(){var l=Q;a&&cn(),Tt(i,!0);try{return n.apply(this,arguments)}finally{Tt(l,!1),u&&queueMicrotask(St)}}}function ti(n){Promise===qt&&Ce.echoes===0?er===0?n():enqueueNativeMicroTask(n):setTimeout(n,0)}(""+dn).indexOf("[native code]")===-1&&(cn=St=he);var Pe=W.reject,Ft="",dt="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Fo="String expected.",un=[],rr="__dbnames",ni="readonly",ri="readwrite";function Vt(n,i){return n?i?function(){return n.apply(this,arguments)&&i.apply(this,arguments)}:n:i}var Vo={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function ir(n){return typeof n!="string"||/\./.test(n)?function(i){return i}:function(i){return i[n]===void 0&&n in i&&delete(i=pe(i))[n],i}}function zo(){throw X.Type("Entity instances must never be new:ed. Instances are generated by the framework bypassing the constructor.")}function ye(n,i){try{var a=Wo(n),u=Wo(i);if(a!==u)return a==="Array"?1:u==="Array"?-1:a==="binary"?1:u==="binary"?-1:a==="string"?1:u==="string"?-1:a==="Date"?1:u!=="Date"?NaN:-1;switch(a){case"number":case"Date":case"string":return i<n?1:n<i?-1:0;case"binary":for(var l=Go(n),p=Go(i),y=l.length,g=p.length,x=y<g?y:g,I=0;I<x;++I)if(l[I]!==p[I])return l[I]<p[I]?-1:1;return y===g?0:y<g?-1:1;case"Array":for(var _=n,w=i,A=_.length,S=w.length,k=A<S?A:S,E=0;E<k;++E){var P=ye(_[E],w[E]);if(P!==0)return P}return A===S?0:A<S?-1:1}}catch{}return NaN}function Wo(n){var i=typeof n;return i=="object"&&(ArrayBuffer.isView(n)||(i=q(n))==="ArrayBuffer")?"binary":i}function Go(n){return n instanceof Uint8Array?n:ArrayBuffer.isView(n)?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):new Uint8Array(n)}function or(n,i,a){var u=n.schema.yProps;return u?(i&&0<a.numFailures&&(i=i.filter(function(l,p){return!a.failures[p]})),Promise.all(u.map(function(l){return l=l.updatesTable,i?n.db.table(l).where("k").anyOf(i).delete():n.db.table(l).clear()})).then(function(){return a})):a}Zo.prototype.execute=function(n){var i=this["@@propmod"];if(i.add!==void 0){var a=i.add;if(d(a))return s(s([],d(n)?n:[],!0),a).sort();if(typeof a=="number")return(Number(n)||0)+a;if(typeof a=="bigint")try{return BigInt(n)+a}catch{return BigInt(0)+a}throw new TypeError("Invalid term ".concat(a))}if(i.remove!==void 0){var u=i.remove;if(d(u))return d(n)?n.filter(function(l){return!u.includes(l)}).sort():[];if(typeof u=="number")return Number(n)-u;if(typeof u=="bigint")try{return BigInt(n)-u}catch{return BigInt(0)-u}throw new TypeError("Invalid subtrahend ".concat(u))}return a=(a=i.replacePrefix)==null?void 0:a[0],a&&typeof n=="string"&&n.startsWith(a)?i.replacePrefix[1]+n.substring(a.length):n};var Bn=Zo;function Zo(n){this["@@propmod"]=n}function Yo(n,i){for(var a=f(i),u=a.length,l=!1,p=0;p<u;++p){var y=a[p],g=i[y],x=z(n,y);g instanceof Bn?(Z(n,y,g.execute(x)),l=!0):x!==g&&(Z(n,y,g),l=!0)}return l}_e.prototype._trans=function(n,i,a){var u=this._tx||Q.trans,l=this.name,p=nt&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(n==="readonly"?"read":"write"," ").concat(this.name));function y(I,_,w){if(w.schema[l])return i(w.idbtrans,w);throw new X.NotFound("Table "+l+" not part of transaction")}var g=sn();try{var x=u&&u.db._novip===this.db._novip?u===Q.trans?u._promise(n,y,a):At(function(){return u._promise(n,y,a)},{trans:u,transless:Q.transless||Q}):(function I(_,w,A,S){if(_.idbdb&&(_._state.openComplete||Q.letThrough||_._vip)){var k=_._createTransaction(w,A,_._dbSchema);try{k.create(),_._state.PR1398_maxLoop=3}catch(E){return E.name===Kt.InvalidState&&_.isOpen()&&0<--_._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),_.close({disableAutoOpen:!1}),_.open().then(function(){return I(_,w,A,S)})):Pe(E)}return k._promise(w,function(E,P){return At(function(){return Q.trans=k,S(E,P,k)})}).then(function(E){if(w==="readwrite")try{k.idbtrans.commit()}catch{}return w==="readonly"?E:k._completion.then(function(){return E})})}if(_._state.openComplete)return Pe(new X.DatabaseClosed(_._state.dbOpenError));if(!_._state.isBeingOpened){if(!_._state.autoOpen)return Pe(new X.DatabaseClosed);_.open().catch(he)}return _._state.dbReadyPromise.then(function(){return I(_,w,A,S)})})(this.db,n,[this.name],y);return p&&(x._consoleTask=p,x=x.catch(function(I){return console.trace(I),Pe(I)})),x}finally{g&&an()}},_e.prototype.get=function(n,i){var a=this;return n&&n.constructor===Object?this.where(n).first(i):n==null?Pe(new X.Type("Invalid argument to Table.get()")):this._trans("readonly",function(u){return a.core.get({trans:u,key:n}).then(function(l){return a.hook.reading.fire(l)})}).then(i)},_e.prototype.where=function(n){if(typeof n=="string")return new this.db.WhereClause(this,n);if(d(n))return new this.db.WhereClause(this,"[".concat(n.join("+"),"]"));var i=f(n);if(i.length===1)return this.where(i[0]).equals(n[i[0]]);var a=this.schema.indexes.concat(this.schema.primKey).filter(function(g){if(g.compound&&i.every(function(I){return 0<=g.keyPath.indexOf(I)})){for(var x=0;x<i.length;++x)if(i.indexOf(g.keyPath[x])===-1)return!1;return!0}return!1}).sort(function(g,x){return g.keyPath.length-x.keyPath.length})[0];if(a&&this.db._maxKey!==Ft)return y=a.keyPath.slice(0,i.length),this.where(y).equals(y.map(function(g){return n[g]}));!a&&nt&&console.warn("The query ".concat(JSON.stringify(n)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(i.join("+"),"]"));var u=this.schema.idxByName;function l(g,x){return ye(g,x)===0}var y=i.reduce(function(_,x){var I=_[0],_=_[1],w=u[x],A=n[x];return[I||w,I||!w?Vt(_,w&&w.multi?function(S){return S=z(S,x),d(S)&&S.some(function(k){return l(A,k)})}:function(S){return l(A,z(S,x))}):_]},[null,null]),p=y[0],y=y[1];return p?this.where(p.name).equals(n[p.keyPath]).filter(y):a?this.filter(y):this.where(i).equals("")},_e.prototype.filter=function(n){return this.toCollection().and(n)},_e.prototype.count=function(n){return this.toCollection().count(n)},_e.prototype.offset=function(n){return this.toCollection().offset(n)},_e.prototype.limit=function(n){return this.toCollection().limit(n)},_e.prototype.each=function(n){return this.toCollection().each(n)},_e.prototype.toArray=function(n){return this.toCollection().toArray(n)},_e.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},_e.prototype.orderBy=function(n){return new this.db.Collection(new this.db.WhereClause(this,d(n)?"[".concat(n.join("+"),"]"):n))},_e.prototype.reverse=function(){return this.toCollection().reverse()},_e.prototype.mapToClass=function(n){for(var i=this.db,a=this.name,u=((this.schema.mappedClass=n).prototype instanceof zo&&(n=(y=>{var g=_,x=y;if(typeof x!="function"&&x!==null)throw new TypeError("Class extends value "+String(x)+" is not a constructor or null");function I(){this.constructor=g}function _(){return y!==null&&y.apply(this,arguments)||this}return r(g,x),g.prototype=x===null?Object.create(x):(I.prototype=x.prototype,new I),Object.defineProperty(_.prototype,"db",{get:function(){return i},enumerable:!1,configurable:!0}),_.prototype.table=function(){return a},_})(n)),new Set),l=n.prototype;l;l=m(l))Object.getOwnPropertyNames(l).forEach(function(y){return u.add(y)});function p(y){if(!y)return y;var g,x=Object.create(n.prototype);for(g in y)if(!u.has(g))try{x[g]=y[g]}catch{}return x}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=p,this.hook("reading",p),n},_e.prototype.defineClass=function(){return this.mapToClass(function(n){h(this,n)})},_e.prototype.add=function(n,i){var a=this,u=this.schema.primKey,l=u.auto,p=u.keyPath,y=n;return p&&l&&(y=ir(p)(n)),this._trans("readwrite",function(g){return a.core.mutate({trans:g,type:"add",keys:i!=null?[i]:null,values:[y]})}).then(function(g){return g.numFailures?W.reject(g.failures[0]):g.lastResult}).then(function(g){if(p)try{Z(n,p,g)}catch{}return g})},_e.prototype.upsert=function(n,i){var a=this,u=this.schema.primKey.keyPath;return this._trans("readwrite",function(l){return a.core.get({trans:l,key:n}).then(function(p){var y=p??{};return Yo(y,i),u&&Z(y,u,n),a.core.mutate({trans:l,type:"put",values:[y],keys:[n],upsert:!0,updates:{keys:[n],changeSpecs:[i]}}).then(function(g){return g.numFailures?W.reject(g.failures[0]):!!p})})})},_e.prototype.update=function(n,i){return typeof n!="object"||d(n)?this.where(":id").equals(n).modify(i):(n=z(n,this.schema.primKey.keyPath))===void 0?Pe(new X.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(n).modify(i)},_e.prototype.put=function(n,i){var a=this,u=this.schema.primKey,l=u.auto,p=u.keyPath,y=n;return p&&l&&(y=ir(p)(n)),this._trans("readwrite",function(g){return a.core.mutate({trans:g,type:"put",values:[y],keys:i!=null?[i]:null})}).then(function(g){return g.numFailures?W.reject(g.failures[0]):g.lastResult}).then(function(g){if(p)try{Z(n,p,g)}catch{}return g})},_e.prototype.delete=function(n){var i=this;return this._trans("readwrite",function(a){return i.core.mutate({trans:a,type:"delete",keys:[n]}).then(function(u){return or(i,[n],u)}).then(function(u){return u.numFailures?W.reject(u.failures[0]):void 0})})},_e.prototype.clear=function(){var n=this;return this._trans("readwrite",function(i){return n.core.mutate({trans:i,type:"deleteRange",range:Vo}).then(function(a){return or(n,null,a)})}).then(function(i){return i.numFailures?W.reject(i.failures[0]):void 0})},_e.prototype.bulkGet=function(n){var i=this;return this._trans("readonly",function(a){return i.core.getMany({keys:n,trans:a}).then(function(u){return u.map(function(l){return i.hook.reading.fire(l)})})})},_e.prototype.bulkAdd=function(n,i,a){var u=this,l=Array.isArray(i)?i:void 0,p=(a=a||(l?void 0:i))?a.allKeys:void 0;return this._trans("readwrite",function(y){var g=u.schema.primKey,I=g.auto,g=g.keyPath;if(g&&l)throw new X.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(l&&l.length!==n.length)throw new X.InvalidArgument("Arguments objects and keys must have the same length");var x=n.length,I=g&&I?n.map(ir(g)):n;return u.core.mutate({trans:y,type:"add",keys:l,values:I,wantResults:p}).then(function(_){var w=_.numFailures,A=_.failures;if(w===0)return p?_.results:_.lastResult;throw new De("".concat(u.name,".bulkAdd(): ").concat(w," of ").concat(x," operations failed"),A)})})},_e.prototype.bulkPut=function(n,i,a){var u=this,l=Array.isArray(i)?i:void 0,p=(a=a||(l?void 0:i))?a.allKeys:void 0;return this._trans("readwrite",function(y){var g=u.schema.primKey,I=g.auto,g=g.keyPath;if(g&&l)throw new X.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(l&&l.length!==n.length)throw new X.InvalidArgument("Arguments objects and keys must have the same length");var x=n.length,I=g&&I?n.map(ir(g)):n;return u.core.mutate({trans:y,type:"put",keys:l,values:I,wantResults:p}).then(function(_){var w=_.numFailures,A=_.failures;if(w===0)return p?_.results:_.lastResult;throw new De("".concat(u.name,".bulkPut(): ").concat(w," of ").concat(x," operations failed"),A)})})},_e.prototype.bulkUpdate=function(n){var i=this,a=this.core,u=n.map(function(y){return y.key}),l=n.map(function(y){return y.changes}),p=[];return this._trans("readwrite",function(y){return a.getMany({trans:y,keys:u,cache:"clone"}).then(function(g){var x=[],I=[],_=(n.forEach(function(w,A){var S=w.key,k=w.changes,E=g[A];if(E){for(var P=0,B=Object.keys(k);P<B.length;P++){var T=B[P],M=k[T];if(T===i.schema.primKey.keyPath){if(ye(M,S)!==0)throw new X.Constraint("Cannot update primary key in bulkUpdate()")}else Z(E,T,M)}p.push(A),x.push(S),I.push(E)}}),x.length);return a.mutate({trans:y,type:"put",keys:x,values:I,updates:{keys:u,changeSpecs:l}}).then(function(w){var A=w.numFailures,S=w.failures;if(A===0)return _;for(var k=0,E=Object.keys(S);k<E.length;k++){var P,B=E[k],T=p[Number(B)];T!=null&&(P=S[B],delete S[B],S[T]=P)}throw new De("".concat(i.name,".bulkUpdate(): ").concat(A," of ").concat(_," operations failed"),S)})})})},_e.prototype.bulkDelete=function(n){var i=this,a=n.length;return this._trans("readwrite",function(u){return i.core.mutate({trans:u,type:"delete",keys:n}).then(function(l){return or(i,n,l)})}).then(function(u){var l=u.numFailures,p=u.failures;if(l===0)return u.lastResult;throw new De("".concat(i.name,".bulkDelete(): ").concat(l," of ").concat(a," operations failed"),p)})};var Jo=_e;function _e(){}function Cn(n){function i(y,g){if(g){for(var x=arguments.length,I=new Array(x-1);--x;)I[x-1]=arguments[x];return a[y].subscribe.apply(null,I),n}if(typeof y=="string")return a[y]}var a={};i.addEventType=p;for(var u=1,l=arguments.length;u<l;++u)p(arguments[u]);return i;function p(y,g,x){var I,_;if(typeof y!="object")return g=g||Ic,_={subscribers:[],fire:x=x||he,subscribe:function(w){_.subscribers.indexOf(w)===-1&&(_.subscribers.push(w),_.fire=g(_.fire,w))},unsubscribe:function(w){_.subscribers=_.subscribers.filter(function(A){return A!==w}),_.fire=_.subscribers.reduce(g,x)}},a[y]=i[y]=_;f(I=y).forEach(function(w){var A=I[w];if(d(A))p(w,I[w][0],I[w][1]);else{if(A!=="asap")throw new X.InvalidArgument("Invalid event config");var S=p(w,Ge,function(){for(var k=arguments.length,E=new Array(k);k--;)E[k]=arguments[k];S.subscribers.forEach(function(P){ce(function(){P.apply(null,E)})})})}})}}function Rn(n,i){return O(i).from({prototype:n}),i}function ln(n,i){return!(n.filter||n.algorithm||n.or)&&(i?n.justLimit:!n.replayFilter)}function ii(n,i){n.filter=Vt(n.filter,i)}function oi(n,i,a){var u=n.replayFilter;n.replayFilter=u?function(){return Vt(u(),i())}:i,n.justLimit=a&&!u}function sr(n,i){if(n.isPrimKey)return i.primaryKey;var a=i.getIndexByKeyPath(n.index);if(a)return a;throw new X.Schema("KeyPath "+n.index+" on object store "+i.name+" is not indexed")}function Xo(n,i,a){var u=sr(n,i.schema);return i.openCursor({trans:a,values:!n.keysOnly,reverse:n.dir==="prev",unique:!!n.unique,query:{index:u,range:n.range}})}function ar(n,i,a,u){var l,p,y=n.replayFilter?Vt(n.filter,n.replayFilter()):n.filter;return n.or?(l={},p=function(g,x,I){var _,w;y&&!y(x,I,function(A){return x.stop(A)},function(A){return x.fail(A)})||((w=""+(_=x.primaryKey))=="[object ArrayBuffer]"&&(w=""+new Uint8Array(_)),b(l,w))||(l[w]=!0,i(g,x,I))},Promise.all([n.or._iterate(p,a),Qo(Xo(n,u,a),n.algorithm,p,!n.keysOnly&&n.valueMapper)])):Qo(Xo(n,u,a),Vt(n.algorithm,y),i,!n.keysOnly&&n.valueMapper)}function Qo(n,i,a,u){var l=Se(u?function(p,y,g){return a(u(p),y,g)}:a);return n.then(function(p){if(p)return p.start(function(){var y=function(){return p.continue()};i&&!i(p,function(g){return y=g},function(g){p.stop(g),y=he},function(g){p.fail(g),y=he})||l(p.value,p,function(g){return y=g}),y()})})}be.prototype._read=function(n,i){var a=this._ctx;return a.error?a.table._trans(null,Pe.bind(null,a.error)):a.table._trans("readonly",n).then(i)},be.prototype._write=function(n){var i=this._ctx;return i.error?i.table._trans(null,Pe.bind(null,i.error)):i.table._trans("readwrite",n,"locked")},be.prototype._addAlgorithm=function(n){var i=this._ctx;i.algorithm=Vt(i.algorithm,n)},be.prototype._iterate=function(n,i){return ar(this._ctx,n,i,this._ctx.table.core)},be.prototype.clone=function(n){var i=Object.create(this.constructor.prototype),a=Object.create(this._ctx);return n&&h(a,n),i._ctx=a,i},be.prototype.raw=function(){return this._ctx.valueMapper=null,this},be.prototype.each=function(n){var i=this._ctx;return this._read(function(a){return ar(i,n,a,i.table.core)})},be.prototype.count=function(n){var i=this;return this._read(function(a){var u,l=i._ctx,p=l.table.core;return ln(l,!0)?p.count({trans:a,query:{index:sr(l,p.schema),range:l.range}}).then(function(y){return Math.min(y,l.limit)}):(u=0,ar(l,function(){return++u,!1},a,p).then(function(){return u}))}).then(n)},be.prototype.sortBy=function(n,i){var a=n.split(".").reverse(),u=a[0],l=a.length-1;function p(x,I){return I?p(x[a[I]],I-1):x[u]}var y=this._ctx.dir==="next"?1:-1;function g(x,I){return ye(p(x,l),p(I,l))*y}return this.toArray(function(x){return x.sort(g)}).then(i)},be.prototype.toArray=function(n){var i=this;return this._read(function(a){var u,l,p,y=i._ctx;return y.dir==="next"&&ln(y,!0)&&0<y.limit?(u=y.valueMapper,l=sr(y,y.table.core.schema),y.table.core.query({trans:a,limit:y.limit,values:!0,query:{index:l,range:y.range}}).then(function(g){return g=g.result,u?g.map(u):g})):(p=[],ar(y,function(g){return p.push(g)},a,y.table.core).then(function(){return p}))},n)},be.prototype.offset=function(n){var i=this._ctx;return n<=0||(i.offset+=n,ln(i)?oi(i,function(){var a=n;return function(u,l){return a===0||(a===1?--a:l(function(){u.advance(a),a=0}),!1)}}):oi(i,function(){var a=n;return function(){return--a<0}})),this},be.prototype.limit=function(n){return this._ctx.limit=Math.min(this._ctx.limit,n),oi(this._ctx,function(){var i=n;return function(a,u,l){return--i<=0&&u(l),0<=i}},!0),this},be.prototype.until=function(n,i){return ii(this._ctx,function(a,u,l){return!n(a.value)||(u(l),i)}),this},be.prototype.first=function(n){return this.limit(1).toArray(function(i){return i[0]}).then(n)},be.prototype.last=function(n){return this.reverse().first(n)},be.prototype.filter=function(n){var i;return ii(this._ctx,function(a){return n(a.value)}),(i=this._ctx).isMatch=Vt(i.isMatch,n),this},be.prototype.and=function(n){return this.filter(n)},be.prototype.or=function(n){return new this.db.WhereClause(this._ctx.table,n,this)},be.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},be.prototype.desc=function(){return this.reverse()},be.prototype.eachKey=function(n){var i=this._ctx;return i.keysOnly=!i.isMatch,this.each(function(a,u){n(u.key,u)})},be.prototype.eachUniqueKey=function(n){return this._ctx.unique="unique",this.eachKey(n)},be.prototype.eachPrimaryKey=function(n){var i=this._ctx;return i.keysOnly=!i.isMatch,this.each(function(a,u){n(u.primaryKey,u)})},be.prototype.keys=function(n){var i=this._ctx,a=(i.keysOnly=!i.isMatch,[]);return this.each(function(u,l){a.push(l.key)}).then(function(){return a}).then(n)},be.prototype.primaryKeys=function(n){var i=this._ctx;if(i.dir==="next"&&ln(i,!0)&&0<i.limit)return this._read(function(u){var l=sr(i,i.table.core.schema);return i.table.core.query({trans:u,values:!1,limit:i.limit,query:{index:l,range:i.range}})}).then(function(u){return u.result}).then(n);i.keysOnly=!i.isMatch;var a=[];return this.each(function(u,l){a.push(l.primaryKey)}).then(function(){return a}).then(n)},be.prototype.uniqueKeys=function(n){return this._ctx.unique="unique",this.keys(n)},be.prototype.firstKey=function(n){return this.limit(1).keys(function(i){return i[0]}).then(n)},be.prototype.lastKey=function(n){return this.reverse().firstKey(n)},be.prototype.distinct=function(){var n,i=this._ctx,i=i.index&&i.table.schema.idxByName[i.index];return i&&i.multi&&(n={},ii(this._ctx,function(u){var u=u.primaryKey.toString(),l=b(n,u);return n[u]=!0,!l})),this},be.prototype.modify=function(n){var i=this,a=this._ctx;return this._write(function(u){function l(E,P){var B=P.failures;A+=E-P.numFailures;for(var T=0,M=f(B);T<M.length;T++){var U=M[T];w.push(B[U])}}var p=typeof n=="function"?n:function(E){return Yo(E,n)},y=a.table.core,_=y.schema.primaryKey,g=_.outbound,x=_.extractKey,I=200,_=i.db._options.modifyChunkSize,w=(_&&(I=typeof _=="object"?_[y.name]||_["*"]||200:_),[]),A=0,S=[],k=n===es;return i.clone().primaryKeys().then(function(E){function P(T){var M=Math.min(I,E.length-T),U=E.slice(T,T+M);return(k?Promise.resolve([]):y.getMany({trans:u,keys:U,cache:"immutable"})).then(function(D){var H=[],K=[],Y=g?[]:null,G=k?U:[];if(!k)for(var j=0;j<M;++j){var J=D[j],ge={value:pe(J),primKey:E[T+j]};p.call(ge,ge.value,ge)!==!1&&(ge.value==null?G.push(E[T+j]):g||ye(x(J),x(ge.value))===0?(K.push(ge.value),g&&Y.push(E[T+j])):(G.push(E[T+j]),H.push(ge.value)))}return Promise.resolve(0<H.length&&y.mutate({trans:u,type:"add",values:H}).then(function(ve){for(var re in ve.failures)G.splice(parseInt(re),1);l(H.length,ve)})).then(function(){return(0<K.length||B&&typeof n=="object")&&y.mutate({trans:u,type:"put",keys:Y,values:K,criteria:B,changeSpec:typeof n!="function"&&n,isAdditionalChunk:0<T}).then(function(ve){return l(K.length,ve)})}).then(function(){return(0<G.length||B&&k)&&y.mutate({trans:u,type:"delete",keys:G,criteria:B,isAdditionalChunk:0<T}).then(function(ve){return or(a.table,G,ve)}).then(function(ve){return l(G.length,ve)})}).then(function(){return E.length>T+M&&P(T+I)})})}var B=ln(a)&&a.limit===1/0&&(typeof n!="function"||k)&&{index:a.index,range:a.range};return P(0).then(function(){if(0<w.length)throw new et("Error modifying one or more objects",w,A,S);return E.length})})})},be.prototype.delete=function(){var n=this._ctx,i=n.range;return!ln(n)||n.table.schema.yProps||!n.isPrimKey&&i.type!==3?this.modify(es):this._write(function(a){var u=n.table.core.schema.primaryKey,l=i;return n.table.core.count({trans:a,query:{index:u,range:l}}).then(function(p){return n.table.core.mutate({trans:a,type:"deleteRange",range:l}).then(function(x){var g=x.failures,x=x.numFailures;if(x)throw new et("Could not delete some values",Object.keys(g).map(function(I){return g[I]}),p-x);return p-x})})})};var Lc=be;function be(){}var es=function(n,i){return i.value=null};function Nc(n,i){return n<i?-1:n===i?0:1}function Mc(n,i){return i<n?-1:n===i?0:1}function ze(n,i,a){return n=n instanceof ns?new n.Collection(n):n,n._ctx.error=new(a||TypeError)(i),n}function fn(n){return new n.Collection(n,function(){return ts("")}).limit(0)}function cr(S,i,a,u){var l,p,y,g,x,I,_,w=a.length;if(!a.every(function(E){return typeof E=="string"}))return ze(S,Fo);function A(E){l=E==="next"?function(B){return B.toUpperCase()}:function(B){return B.toLowerCase()},p=E==="next"?function(B){return B.toLowerCase()}:function(B){return B.toUpperCase()},y=E==="next"?Nc:Mc;var P=a.map(function(B){return{lower:p(B),upper:l(B)}}).sort(function(B,T){return y(B.lower,T.lower)});g=P.map(function(B){return B.upper}),x=P.map(function(B){return B.lower}),_=(I=E)==="next"?"":u}A("next");var S=new S.Collection(S,function(){return It(g[0],x[w-1]+u)}),k=(S._ondirectionchange=function(E){A(E)},0);return S._addAlgorithm(function(E,P,B){var T=E.key;if(typeof T=="string"){var M=p(T);if(i(M,x,k))return!0;for(var U=null,D=k;D<w;++D){var H=((K,Y,G,j,J,ge)=>{for(var ve=Math.min(K.length,j.length),re=-1,de=0;de<ve;++de){var Te=Y[de];if(Te!==j[de])return J(K[de],G[de])<0?K.substr(0,de)+G[de]+G.substr(de+1):J(K[de],j[de])<0?K.substr(0,de)+j[de]+G.substr(de+1):0<=re?K.substr(0,re)+Y[re]+G.substr(re+1):null;J(K[de],Te)<0&&(re=de)}return ve<j.length&&ge==="next"?K+G.substr(K.length):ve<K.length&&ge==="prev"?K.substr(0,G.length):re<0?null:K.substr(0,re)+j[re]+G.substr(re+1)})(T,M,g[D],x[D],y,I);H===null&&U===null?k=D+1:(U===null||0<y(U,H))&&(U=H)}P(U!==null?function(){E.continue(U+_)}:B)}return!1}),S}function It(n,i,a,u){return{type:2,lower:n,upper:i,lowerOpen:a,upperOpen:u}}function ts(n){return{type:1,lower:n,upper:n}}Object.defineProperty(Re.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),Re.prototype.between=function(n,i,a,u){a=a!==!1,u=u===!0;try{return 0<this._cmp(n,i)||this._cmp(n,i)===0&&(a||u)&&(!a||!u)?fn(this):new this.Collection(this,function(){return It(n,i,!a,!u)})}catch{return ze(this,dt)}},Re.prototype.equals=function(n){return n==null?ze(this,dt):new this.Collection(this,function(){return ts(n)})},Re.prototype.above=function(n){return n==null?ze(this,dt):new this.Collection(this,function(){return It(n,void 0,!0)})},Re.prototype.aboveOrEqual=function(n){return n==null?ze(this,dt):new this.Collection(this,function(){return It(n,void 0,!1)})},Re.prototype.below=function(n){return n==null?ze(this,dt):new this.Collection(this,function(){return It(void 0,n,!1,!0)})},Re.prototype.belowOrEqual=function(n){return n==null?ze(this,dt):new this.Collection(this,function(){return It(void 0,n)})},Re.prototype.startsWith=function(n){return typeof n!="string"?ze(this,Fo):this.between(n,n+Ft,!0,!0)},Re.prototype.startsWithIgnoreCase=function(n){return n===""?this.startsWith(n):cr(this,function(i,a){return i.indexOf(a[0])===0},[n],Ft)},Re.prototype.equalsIgnoreCase=function(n){return cr(this,function(i,a){return i===a[0]},[n],"")},Re.prototype.anyOfIgnoreCase=function(){var n=ue.apply(ie,arguments);return n.length===0?fn(this):cr(this,function(i,a){return a.indexOf(i)!==-1},n,"")},Re.prototype.startsWithAnyOfIgnoreCase=function(){var n=ue.apply(ie,arguments);return n.length===0?fn(this):cr(this,function(i,a){return a.some(function(u){return i.indexOf(u)===0})},n,Ft)},Re.prototype.anyOf=function(){var n,i,a=this,u=ue.apply(ie,arguments),l=this._cmp;try{u.sort(l)}catch{return ze(this,dt)}return u.length===0?fn(this):((n=new this.Collection(this,function(){return It(u[0],u[u.length-1])}))._ondirectionchange=function(p){l=p==="next"?a._ascending:a._descending,u.sort(l)},i=0,n._addAlgorithm(function(p,y,g){for(var x=p.key;0<l(x,u[i]);)if(++i===u.length)return y(g),!1;return l(x,u[i])===0||(y(function(){p.continue(u[i])}),!1)}),n)},Re.prototype.notEqual=function(n){return this.inAnyRange([[-1/0,n],[n,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},Re.prototype.noneOf=function(){var n=ue.apply(ie,arguments);if(n.length===0)return new this.Collection(this);try{n.sort(this._ascending)}catch{return ze(this,dt)}var i=n.reduce(function(a,u){return a?a.concat([[a[a.length-1][1],u]]):[[-1/0,u]]},null);return i.push([n[n.length-1],this.db._maxKey]),this.inAnyRange(i,{includeLowers:!1,includeUppers:!1})},Re.prototype.inAnyRange=function(n,B){var a=this,u=this._cmp,l=this._ascending,p=this._descending,y=this._min,g=this._max;if(n.length===0)return fn(this);if(!n.every(function(T){return T[0]!==void 0&&T[1]!==void 0&&l(T[0],T[1])<=0}))return ze(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",X.InvalidArgument);var x=!B||B.includeLowers!==!1,I=B&&B.includeUppers===!0,_,w=l;function A(T,M){return w(T[0],M[0])}try{(_=n.reduce(function(T,M){for(var U=0,D=T.length;U<D;++U){var H=T[U];if(u(M[0],H[1])<0&&0<u(M[1],H[0])){H[0]=y(H[0],M[0]),H[1]=g(H[1],M[1]);break}}return U===D&&T.push(M),T},[])).sort(A)}catch{return ze(this,dt)}var S=0,k=I?function(T){return 0<l(T,_[S][1])}:function(T){return 0<=l(T,_[S][1])},E=x?function(T){return 0<p(T,_[S][0])}:function(T){return 0<=p(T,_[S][0])},P=k,B=new this.Collection(this,function(){return It(_[0][0],_[_.length-1][1],!x,!I)});return B._ondirectionchange=function(T){w=T==="next"?(P=k,l):(P=E,p),_.sort(A)},B._addAlgorithm(function(T,M,U){for(var D,H=T.key;P(H);)if(++S===_.length)return M(U),!1;return!k(D=H)&&!E(D)||(a._cmp(H,_[S][1])===0||a._cmp(H,_[S][0])===0||M(function(){w===l?T.continue(_[S][0]):T.continue(_[S][1])}),!1)}),B},Re.prototype.startsWithAnyOf=function(){var n=ue.apply(ie,arguments);return n.every(function(i){return typeof i=="string"})?n.length===0?fn(this):this.inAnyRange(n.map(function(i){return[i,i+Ft]})):ze(this,"startsWithAnyOf() only works with strings")};var ns=Re;function Re(){}function rt(n){return Se(function(i){return Ln(i),n(i.target.error),!1})}function Ln(n){n.stopPropagation&&n.stopPropagation(),n.preventDefault&&n.preventDefault()}var Nn="storagemutated",si="x-storagemutated-1",Pt=Cn(null,Nn),$c=(it.prototype._lock=function(){return se(!Q.global),++this._reculock,this._reculock!==1||Q.global||(Q.lockOwnerFor=this),this},it.prototype._unlock=function(){if(se(!Q.global),--this._reculock==0)for(Q.global||(Q.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var n=this._blockedFuncs.shift();try{Ht(n[1],n[0])}catch{}}return this},it.prototype._locked=function(){return this._reculock&&Q.lockOwnerFor!==this},it.prototype.create=function(n){var i=this;if(this.mode){var a=this.db.idbdb,u=this.db._state.dbOpenError;if(se(!this.idbtrans),!n&&!a)switch(u&&u.name){case"DatabaseClosedError":throw new X.DatabaseClosed(u);case"MissingAPIError":throw new X.MissingAPI(u.message,u);default:throw new X.OpenFailed(u)}if(!this.active)throw new X.TransactionInactive;se(this._completion._state===null),(n=this.idbtrans=n||(this.db.core||a).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=Se(function(l){Ln(l),i._reject(n.error)}),n.onabort=Se(function(l){Ln(l),i.active&&i._reject(new X.Abort(n.error)),i.active=!1,i.on("abort").fire(l)}),n.oncomplete=Se(function(){i.active=!1,i._resolve(),"mutatedParts"in n&&Pt.storagemutated.fire(n.mutatedParts)})}return this},it.prototype._promise=function(n,i,a){var u,l=this;return n==="readwrite"&&this.mode!=="readwrite"?Pe(new X.ReadOnly("Transaction is readonly")):this.active?this._locked()?new W(function(p,y){l._blockedFuncs.push([function(){l._promise(n,i,a).then(p,y)},Q])}):a?At(function(){var p=new W(function(y,g){l._lock();var x=i(y,g,l);x&&x.then&&x.then(y,g)});return p.finally(function(){return l._unlock()}),p._lib=!0,p}):((u=new W(function(p,y){var g=i(p,y,l);g&&g.then&&g.then(p,y)}))._lib=!0,u):Pe(new X.TransactionInactive)},it.prototype._root=function(){return this.parent?this.parent._root():this},it.prototype.waitFor=function(n){var i,a=this._root(),u=W.resolve(n),l=(a._waitingFor?a._waitingFor=a._waitingFor.then(function(){return u}):(a._waitingFor=u,a._waitingQueue=[],i=a.idbtrans.objectStore(a.storeNames[0]),(function p(){for(++a._spinCount;a._waitingQueue.length;)a._waitingQueue.shift()();a._waitingFor&&(i.get(-1/0).onsuccess=p)})()),a._waitingFor);return new W(function(p,y){u.then(function(g){return a._waitingQueue.push(Se(p.bind(null,g)))},function(g){return a._waitingQueue.push(Se(y.bind(null,g)))}).finally(function(){a._waitingFor===l&&(a._waitingFor=null)})})},it.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new X.Abort))},it.prototype.table=function(n){var i=this._memoizedTables||(this._memoizedTables={});if(b(i,n))return i[n];var a=this.schema[n];if(a)return(a=new this.db.Table(n,a,this)).core=this.db.core.table(n),i[n]=a;throw new X.NotFound("Table "+n+" not part of transaction")},it);function it(){}function ai(n,i,a,u,l,p,y,g){return{name:n,keyPath:i,unique:a,multi:u,auto:l,compound:p,src:(a&&!y?"&":"")+(u?"*":"")+(l?"++":"")+rs(i),type:g}}function rs(n){return typeof n=="string"?n:n?"["+[].join.call(n,"+")+"]":""}function ci(n,i,a){return{name:n,primKey:i,indexes:a,mappedClass:null,idxByName:(u=function(l){return[l.name,l]},a.reduce(function(l,p,y){return p=u(p,y),p&&(l[p[0]]=p[1]),l},{}))};var u}var Mn=function(n){try{return n.only([[]]),Mn=function(){return[[]]},[[]]}catch{return Mn=function(){return Ft},Ft}};function ui(n){return n==null?function(){}:typeof n=="string"?(i=n).split(".").length===1?function(a){return a[i]}:function(a){return z(a,i)}:function(a){return z(a,n)};var i}function is(n){return[].slice.call(n)}var Uc=0;function $n(n){return n==null?":id":typeof n=="string"?n:"[".concat(n.join("+"),"]")}function Kc(n,i,x){function u(k){if(k.type===3)return null;if(k.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var w=k.lower,A=k.upper,S=k.lowerOpen,k=k.upperOpen;return w===void 0?A===void 0?null:i.upperBound(A,!!k):A===void 0?i.lowerBound(w,!!S):i.bound(w,A,!!S,!!k)}function l(_){var w,A=_.name;return{name:A,schema:_,mutate:function(S){var k=S.trans,E=S.type,P=S.keys,B=S.values,T=S.range;return new Promise(function(M,U){M=Se(M);var D=k.objectStore(A),H=D.keyPath==null,K=E==="put"||E==="add";if(!K&&E!=="delete"&&E!=="deleteRange")throw new Error("Invalid operation type: "+E);var Y,G=(P||B||{length:1}).length;if(P&&B&&P.length!==B.length)throw new Error("Given keys array must have same length as given values array.");if(G===0)return M({numFailures:0,failures:{},results:[],lastResult:void 0});function j(Ie){++ve,Ln(Ie)}var J=[],ge=[],ve=0;if(E==="deleteRange"){if(T.type===4)return M({numFailures:ve,failures:ge,results:[],lastResult:void 0});T.type===3?J.push(Y=D.clear()):J.push(Y=D.delete(u(T)))}else{var H=K?H?[B,P]:[B,null]:[P,null],re=H[0],de=H[1];if(K)for(var Te=0;Te<G;++Te)J.push(Y=de&&de[Te]!==void 0?D[E](re[Te],de[Te]):D[E](re[Te])),Y.onerror=j;else for(Te=0;Te<G;++Te)J.push(Y=D[E](re[Te])),Y.onerror=j}function Ze(Ie){Ie=Ie.target.result,J.forEach(function(Gt,Ti){return Gt.error!=null&&(ge[Ti]=Gt.error)}),M({numFailures:ve,failures:ge,results:E==="delete"?P:J.map(function(Gt){return Gt.result}),lastResult:Ie})}Y.onerror=function(Ie){j(Ie),Ze(Ie)},Y.onsuccess=Ze})},getMany:function(S){var k=S.trans,E=S.keys;return new Promise(function(P,B){P=Se(P);for(var T,M=k.objectStore(A),U=E.length,D=new Array(U),H=0,K=0,Y=function(J){J=J.target,D[J._pos]=J.result,++K===H&&P(D)},G=rt(B),j=0;j<U;++j)E[j]!=null&&((T=M.get(E[j]))._pos=j,T.onsuccess=Y,T.onerror=G,++H);H===0&&P(D)})},get:function(S){var k=S.trans,E=S.key;return new Promise(function(P,B){P=Se(P);var T=k.objectStore(A).get(E);T.onsuccess=function(M){return P(M.target.result)},T.onerror=rt(B)})},query:(w=g,function(S){return new Promise(function(k,E){k=Se(k);var P,B,T,K=S.trans,M=S.values,U=S.limit,H=S.query,D=U===1/0?void 0:U,Y=H.index,H=H.range,K=K.objectStore(A),K=Y.isPrimaryKey?K:K.index(Y.name),Y=u(H);if(U===0)return k({result:[]});w?((H=M?K.getAll(Y,D):K.getAllKeys(Y,D)).onsuccess=function(G){return k({result:G.target.result})},H.onerror=rt(E)):(P=0,B=!M&&"openKeyCursor"in K?K.openKeyCursor(Y):K.openCursor(Y),T=[],B.onsuccess=function(G){var j=B.result;return!j||(T.push(M?j.value:j.primaryKey),++P===U)?k({result:T}):void j.continue()},B.onerror=rt(E))})}),openCursor:function(S){var k=S.trans,E=S.values,P=S.query,B=S.reverse,T=S.unique;return new Promise(function(M,U){M=Se(M);var K=P.index,D=P.range,H=k.objectStore(A),H=K.isPrimaryKey?H:H.index(K.name),K=B?T?"prevunique":"prev":T?"nextunique":"next",Y=!E&&"openKeyCursor"in H?H.openKeyCursor(u(D),K):H.openCursor(u(D),K);Y.onerror=rt(U),Y.onsuccess=Se(function(G){var j,J,ge,ve,re=Y.result;re?(re.___id=++Uc,re.done=!1,j=re.continue.bind(re),J=(J=re.continuePrimaryKey)&&J.bind(re),ge=re.advance.bind(re),ve=function(){throw new Error("Cursor not stopped")},re.trans=k,re.stop=re.continue=re.continuePrimaryKey=re.advance=function(){throw new Error("Cursor not started")},re.fail=Se(U),re.next=function(){var de=this,Te=1;return this.start(function(){return Te--?de.continue():de.stop()}).then(function(){return de})},re.start=function(de){function Te(){if(Y.result)try{de()}catch(Ie){re.fail(Ie)}else re.done=!0,re.start=function(){throw new Error("Cursor behind last entry")},re.stop()}var Ze=new Promise(function(Ie,Gt){Ie=Se(Ie),Y.onerror=rt(Gt),re.fail=Gt,re.stop=function(Ti){re.stop=re.continue=re.continuePrimaryKey=re.advance=ve,Ie(Ti)}});return Y.onsuccess=Se(function(Ie){Y.onsuccess=Te,Te()}),re.continue=j,re.continuePrimaryKey=J,re.advance=ge,Te(),Ze},M(re)):M(null)},U)})},count:function(S){var k=S.query,E=S.trans,P=k.index,B=k.range;return new Promise(function(T,M){var U=E.objectStore(A),U=P.isPrimaryKey?U:U.index(P.name),D=u(B),D=D?U.count(D):U.count();D.onsuccess=Se(function(H){return T(H.target.result)}),D.onerror=rt(M)})}}}p=x,y=is((x=n).objectStoreNames);var p,x={schema:{name:x.name,tables:y.map(function(_){return p.objectStore(_)}).map(function(_){var w=_.keyPath,A=_.autoIncrement,k=d(w),S={},k={name:_.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:w==null,compound:k,keyPath:w,autoIncrement:A,unique:!0,extractKey:ui(w)},indexes:is(_.indexNames).map(function(E){return _.index(E)}).map(function(T){var M=T.name,P=T.unique,B=T.multiEntry,T=T.keyPath,M={name:M,compound:d(T),keyPath:T,unique:P,multiEntry:B,extractKey:ui(T)};return S[$n(T)]=M}),getIndexByKeyPath:function(E){return S[$n(E)]}};return S[":id"]=k.primaryKey,w!=null&&(S[$n(w)]=k.primaryKey),k})},hasGetAll:0<y.length&&"getAll"in p.objectStore(y[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)},y=x.schema,g=x.hasGetAll,x=y.tables.map(l),I={};return x.forEach(function(_){return I[_.name]=_}),{stack:"dbcore",transaction:n.transaction.bind(n),table:function(_){if(I[_])return I[_];throw new Error("Table '".concat(_,"' not found"))},MIN_KEY:-1/0,MAX_KEY:Mn(i),schema:y}}function qc(n,i,a,u){return a=a.IDBKeyRange,i=Kc(i,a,u),{dbcore:n.dbcore.reduce(function(l,p){return p=p.create,o(o({},l),p(l))},i)}}function ur(n,i){var a=i.db,a=qc(n._middlewares,a,n._deps,i);n.core=a.dbcore,n.tables.forEach(function(u){var l=u.name;n.core.schema.tables.some(function(p){return p.name===l})&&(u.core=n.core.table(l),n[l]instanceof n.Table)&&(n[l].core=u.core)})}function lr(n,i,a,u){a.forEach(function(l){var p=u[l];i.forEach(function(y){var g=(function x(I,_){return R(I,_)||(I=m(I))&&x(I,_)})(y,l);(!g||"value"in g&&g.value===void 0)&&(y===n.Transaction.prototype||y instanceof n.Transaction?L(y,l,{get:function(){return this.table(l)},set:function(x){N(this,l,{value:x,writable:!0,configurable:!0,enumerable:!0})}}):y[l]=new n.Table(l,p))})})}function li(n,i){i.forEach(function(a){for(var u in a)a[u]instanceof n.Table&&delete a[u]})}function jc(n,i){return n._cfg.version-i._cfg.version}function Dc(n,i,a,u){var l=n._dbSchema,p=(a.objectStoreNames.contains("$meta")&&!l.$meta&&(l.$meta=ci("$meta",ss("")[0],[]),n._storeNames.push("$meta")),n._createTransaction("readwrite",n._storeNames,l)),y=(p.create(a),p._completion.catch(u),p._reject.bind(p)),g=Q.transless||Q;At(function(){if(Q.trans=p,Q.transless=g,i!==0)return ur(n,a),I=i,((x=p).storeNames.includes("$meta")?x.table("$meta").get("version").then(function(_){return _??I}):W.resolve(I)).then(function(P){var w=n,A=P,S=p,k=a,E=[],P=w._versions,B=w._dbSchema=hr(0,w.idbdb,k);return(P=P.filter(function(T){return T._cfg.version>=A})).length===0?W.resolve():(P.forEach(function(T){E.push(function(){var M,U,D,H=B,K=T._cfg.dbschema,Y=(dr(w,H,k),dr(w,K,k),B=w._dbSchema=K,fi(H,K)),G=(Y.add.forEach(function(j){hi(k,j[0],j[1].primKey,j[1].indexes)}),Y.change.forEach(function(j){if(j.recreate)throw new X.Upgrade("Not yet support for changing primary key");var J=k.objectStore(j.name);j.add.forEach(function(ge){return fr(J,ge)}),j.change.forEach(function(ge){J.deleteIndex(ge.name),fr(J,ge)}),j.del.forEach(function(ge){return J.deleteIndex(ge)})}),T._cfg.contentUpgrade);if(G&&T._cfg.version>A)return ur(w,k),S._memoizedTables={},M=te(K),Y.del.forEach(function(j){M[j]=H[j]}),li(w,[w.Transaction.prototype]),lr(w,[w.Transaction.prototype],f(M),M),S.schema=M,(U=Ee(G))&&cn(),K=W.follow(function(){var j;(D=G(S))&&U&&(j=St.bind(null,null),D.then(j,j))}),D&&typeof D.then=="function"?W.resolve(D):K.then(function(){return D})}),E.push(function(M){var U,D,H=T._cfg.dbschema;U=H,D=M,[].slice.call(D.db.objectStoreNames).forEach(function(K){return U[K]==null&&D.db.deleteObjectStore(K)}),li(w,[w.Transaction.prototype]),lr(w,[w.Transaction.prototype],w._storeNames,w._dbSchema),S.schema=w._dbSchema}),E.push(function(M){w.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(w.idbdb.version/10)===T._cfg.version?(w.idbdb.deleteObjectStore("$meta"),delete w._dbSchema.$meta,w._storeNames=w._storeNames.filter(function(U){return U!=="$meta"})):M.objectStore("$meta").put(T._cfg.version,"version"))})}),(function T(){return E.length?W.resolve(E.shift()(S.idbtrans)).then(T):W.resolve()})().then(function(){os(B,k)}))}).catch(y);var x,I;f(l).forEach(function(_){hi(a,_,l[_].primKey,l[_].indexes)}),ur(n,a),W.follow(function(){return n.on.populate.fire(p)}).catch(y)})}function Hc(n,i){os(n._dbSchema,i),i.db.version%10!=0||i.objectStoreNames.contains("$meta")||i.db.createObjectStore("$meta").add(Math.ceil(i.db.version/10-1),"version");var a=hr(0,n.idbdb,i);dr(n,n._dbSchema,i);for(var u=0,l=fi(a,n._dbSchema).change;u<l.length;u++){var p=(y=>{if(y.change.length||y.recreate)return console.warn("Unable to patch indexes of table ".concat(y.name," because it has changes on the type of index or primary key.")),{value:void 0};var g=i.objectStore(y.name);y.add.forEach(function(x){nt&&console.debug("Dexie upgrade patch: Creating missing index ".concat(y.name,".").concat(x.src)),fr(g,x)})})(l[u]);if(typeof p=="object")return p.value}}function fi(n,i){var a,u={del:[],add:[],change:[]};for(a in n)i[a]||u.del.push(a);for(a in i){var l=n[a],p=i[a];if(l){var y={name:a,def:p,recreate:!1,del:[],add:[],change:[]};if(""+(l.primKey.keyPath||"")!=""+(p.primKey.keyPath||"")||l.primKey.auto!==p.primKey.auto)y.recreate=!0,u.change.push(y);else{var g=l.idxByName,x=p.idxByName,I=void 0;for(I in g)x[I]||y.del.push(I);for(I in x){var _=g[I],w=x[I];_?_.src!==w.src&&y.change.push(w):y.add.push(w)}(0<y.del.length||0<y.add.length||0<y.change.length)&&u.change.push(y)}}else u.add.push([a,p])}return u}function hi(n,i,a,u){var l=n.db.createObjectStore(i,a.keyPath?{keyPath:a.keyPath,autoIncrement:a.auto}:{autoIncrement:a.auto});u.forEach(function(p){return fr(l,p)})}function os(n,i){f(n).forEach(function(a){i.db.objectStoreNames.contains(a)||(nt&&console.debug("Dexie: Creating missing table",a),hi(i,a,n[a].primKey,n[a].indexes))})}function fr(n,i){n.createIndex(i.name,i.keyPath,{unique:i.unique,multiEntry:i.multi})}function hr(n,i,a){var u={};return F(i.objectStoreNames,0).forEach(function(l){for(var p=a.objectStore(l),y=ai(rs(I=p.keyPath),I||"",!0,!1,!!p.autoIncrement,I&&typeof I!="string",!0),g=[],x=0;x<p.indexNames.length;++x){var _=p.index(p.indexNames[x]),I=_.keyPath,_=ai(_.name,I,!!_.unique,!!_.multiEntry,!1,I&&typeof I!="string",!1);g.push(_)}u[l]=ci(l,y,g)}),u}function dr(n,i,a){for(var u=a.db.objectStoreNames,l=0;l<u.length;++l){var p=u[l],y=a.objectStore(p);n._hasGetAll="getAll"in y;for(var g=0;g<y.indexNames.length;++g){var x,I=y.indexNames[g],_=y.index(I).keyPath,_=typeof _=="string"?_:"["+F(_).join("+")+"]";i[p]&&(x=i[p].idxByName[_])&&(x.name=I,delete i[p].idxByName[_],i[p].idxByName[I]=x)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&c.WorkerGlobalScope&&c instanceof c.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(n._hasGetAll=!1)}function ss(n){return n.split(",").map(function(i,a){var l=i.split(":"),u=(u=l[1])==null?void 0:u.trim(),l=(i=l[0].trim()).replace(/([&*]|\+\+)/g,""),p=/^\[/.test(l)?l.match(/^\[(.*)\]$/)[1].split("+"):l;return ai(l,p||null,/\&/.test(i),/\*/.test(i),/\+\+/.test(i),d(p),a===0,u)})}hn.prototype._createTableSchema=ci,hn.prototype._parseIndexSyntax=ss,hn.prototype._parseStoresSpec=function(n,i){var a=this;f(n).forEach(function(u){if(n[u]!==null){var l=a._parseIndexSyntax(n[u]),p=l.shift();if(!p)throw new X.Schema("Invalid schema for table "+u+": "+n[u]);if(p.unique=!0,p.multi)throw new X.Schema("Primary key cannot be multiEntry*");l.forEach(function(y){if(y.auto)throw new X.Schema("Only primary key can be marked as autoIncrement (++)");if(!y.keyPath)throw new X.Schema("Index must have a name and cannot be an empty string")}),p=a._createTableSchema(u,p,l),i[u]=p}})},hn.prototype.stores=function(a){var i=this.db,a=(this._cfg.storesSource=this._cfg.storesSource?h(this._cfg.storesSource,a):a,i._versions),u={},l={};return a.forEach(function(p){h(u,p._cfg.storesSource),l=p._cfg.dbschema={},p._parseStoresSpec(u,l)}),i._dbSchema=l,li(i,[i._allTables,i,i.Transaction.prototype]),lr(i,[i._allTables,i,i.Transaction.prototype,this._cfg.tables],f(l),l),i._storeNames=f(l),this},hn.prototype.upgrade=function(n){return this._cfg.contentUpgrade=Wr(this._cfg.contentUpgrade||he,n),this};var Fc=hn;function hn(){}function di(n,i){var a=n._dbNamesDB;return a||(a=n._dbNamesDB=new pt(rr,{addons:[],indexedDB:n,IDBKeyRange:i})).version(1).stores({dbnames:"name"}),a.table("dbnames")}function pi(n){return n&&typeof n.databases=="function"}function yi(n){return At(function(){return Q.letThrough=!0,n()})}function gi(n){return!("from"in n)}var $e=function(n,i){var a;if(!this)return a=new $e,n&&"d"in n&&h(a,n),a;h(this,arguments.length?{d:1,from:n,to:1<arguments.length?i:n}:{d:0})};function Un(n,i,a){var u=ye(i,a);if(!isNaN(u)){if(0<u)throw RangeError();if(gi(n))return h(n,{from:i,to:a,d:1});var u=n.l,l=n.r;if(ye(a,n.from)<0)return u?Un(u,i,a):n.l={from:i,to:a,d:1,l:null,r:null},cs(n);if(0<ye(i,n.to))return l?Un(l,i,a):n.r={from:i,to:a,d:1,l:null,r:null},cs(n);ye(i,n.from)<0&&(n.from=i,n.l=null,n.d=l?l.d+1:1),0<ye(a,n.to)&&(n.to=a,n.r=null,n.d=n.l?n.l.d+1:1),i=!n.r,u&&!n.l&&Kn(n,u),l&&i&&Kn(n,l)}}function Kn(n,i){gi(i)||(function a(u,l){var p=l.from,y=l.l,g=l.r;Un(u,p,l.to),y&&a(u,y),g&&a(u,g)})(n,i)}function as(n,i){var a=pr(i),u=a.next();if(!u.done)for(var l=u.value,p=pr(n),y=p.next(l.from),g=y.value;!u.done&&!y.done;){if(ye(g.from,l.to)<=0&&0<=ye(g.to,l.from))return!0;ye(l.from,g.from)<0?l=(u=a.next(g.from)).value:g=(y=p.next(l.from)).value}return!1}function pr(n){var i=gi(n)?null:{s:0,n};return{next:function(a){for(var u=0<arguments.length;i;)switch(i.s){case 0:if(i.s=1,u)for(;i.n.l&&ye(a,i.n.from)<0;)i={up:i,n:i.n.l,s:1};else for(;i.n.l;)i={up:i,n:i.n.l,s:1};case 1:if(i.s=2,!u||ye(a,i.n.to)<=0)return{value:i.n,done:!1};case 2:if(i.n.r){i.s=3,i={up:i,n:i.n.r,s:0};continue}case 3:i=i.up}return{done:!0}}}}function cs(n){var i,a,u,l=(((l=n.r)==null?void 0:l.d)||0)-(((l=n.l)==null?void 0:l.d)||0),l=1<l?"r":l<-1?"l":"";l&&(i=l=="r"?"l":"r",a=o({},n),u=n[l],n.from=u.from,n.to=u.to,n[l]=u[l],a[l]=u[i],(n[i]=a).d=us(a)),n.d=us(n)}function us(a){var i=a.r,a=a.l;return(i?a?Math.max(i.d,a.d):i.d:a?a.d:0)+1}function yr(n,i){return f(i).forEach(function(a){n[a]?Kn(n[a],i[a]):n[a]=(function u(l){var p,y,g={};for(p in l)b(l,p)&&(y=l[p],g[p]=!y||typeof y!="object"||ae.has(y.constructor)?y:u(y));return g})(i[a])}),n}function mi(n,i){return n.all||i.all||Object.keys(n).some(function(a){return i[a]&&as(i[a],n[a])})}C($e.prototype,((Ve={add:function(n){return Kn(this,n),this},addKey:function(n){return Un(this,n,n),this},addKeys:function(n){var i=this;return n.forEach(function(a){return Un(i,a,a)}),this},hasKey:function(n){var i=pr(this).next(n).value;return i&&ye(i.from,n)<=0&&0<=ye(i.to,n)}})[V]=function(){return pr(this)},Ve));var zt={},bi={},vi=!1;function gr(n){yr(bi,n),vi||(vi=!0,setTimeout(function(){vi=!1,wi(bi,!(bi={}))},0))}function wi(n,i){i===void 0&&(i=!1);var a=new Set;if(n.all)for(var u=0,l=Object.values(zt);u<l.length;u++)ls(g=l[u],n,a,i);else for(var p in n){var y,g,p=/^idb\:\/\/(.*)\/(.*)\//.exec(p);p&&(y=p[1],p=p[2],g=zt["idb://".concat(y,"/").concat(p)])&&ls(g,n,a,i)}a.forEach(function(x){return x()})}function ls(n,i,a,u){for(var l=[],p=0,y=Object.entries(n.queries.query);p<y.length;p++){for(var g=y[p],x=g[0],I=[],_=0,w=g[1];_<w.length;_++){var A=w[_];mi(i,A.obsSet)?A.subscribers.forEach(function(P){return a.add(P)}):u&&I.push(A)}u&&l.push([x,I])}if(u)for(var S=0,k=l;S<k.length;S++){var E=k[S],x=E[0],I=E[1];n.queries.query[x]=I}}function Vc(n){var i=n._state,a=n._deps.indexedDB;if(i.isBeingOpened||n.idbdb)return i.dbReadyPromise.then(function(){return i.dbOpenError?Pe(i.dbOpenError):n});i.isBeingOpened=!0,i.dbOpenError=null,i.openComplete=!1;var u=i.openCanceller,l=Math.round(10*n.verno),p=!1;function y(){if(i.openCanceller!==u)throw new X.DatabaseClosed("db.open() was cancelled")}function g(){return new W(function(A,S){if(y(),!a)throw new X.MissingAPI;var k=n.name,E=i.autoSchema||!l?a.open(k):a.open(k,l);if(!E)throw new X.MissingAPI;E.onerror=rt(S),E.onblocked=Se(n._fireOnBlocked),E.onupgradeneeded=Se(function(P){var B;_=E.transaction,i.autoSchema&&!n._options.allowEmptyDB?(E.onerror=Ln,_.abort(),E.result.close(),(B=a.deleteDatabase(k)).onsuccess=B.onerror=Se(function(){S(new X.NoSuchDatabase("Database ".concat(k," doesnt exist")))})):(_.onerror=rt(S),B=P.oldVersion>Math.pow(2,62)?0:P.oldVersion,w=B<1,n.idbdb=E.result,p&&Hc(n,_),Dc(n,B/10,_,S))},S),E.onsuccess=Se(function(){_=null;var P,B,T,M,U,D,H=n.idbdb=E.result,K=F(H.objectStoreNames);if(0<K.length)try{var Y=H.transaction((U=K).length===1?U[0]:U,"readonly");if(i.autoSchema)D=H,M=Y,(T=n).verno=D.version/10,M=T._dbSchema=hr(0,D,M),T._storeNames=F(D.objectStoreNames,0),lr(T,[T._allTables],f(M),M);else if(dr(n,n._dbSchema,Y),B=Y,((B=fi(hr(0,(P=n).idbdb,B),P._dbSchema)).add.length||B.change.some(function(G){return G.add.length||G.change.length}))&&!p)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),H.close(),l=H.version+1,p=!0,A(g());ur(n,Y)}catch{}un.push(n),H.onversionchange=Se(function(G){i.vcFired=!0,n.on("versionchange").fire(G)}),H.onclose=Se(function(){n.close({disableAutoOpen:!1})}),w&&(K=n._deps,U=k,pi(D=K.indexedDB)||U===rr||di(D,K.IDBKeyRange).put({name:U}).catch(he)),A()},S)}).catch(function(A){switch(A?.name){case"UnknownError":if(0<i.PR1398_maxLoop)return i.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),g();break;case"VersionError":if(0<l)return l=0,g()}return W.reject(A)})}var x,I=i.dbReadyResolve,_=null,w=!1;return W.race([u,(typeof navigator>"u"?W.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(A){function S(){return indexedDB.databases().finally(A)}x=setInterval(S,100),S()}).finally(function(){return clearInterval(x)}):Promise.resolve()).then(g)]).then(function(){return y(),i.onReadyBeingFired=[],W.resolve(yi(function(){return n.on.ready.fire(n.vip)})).then(function A(){var S;if(0<i.onReadyBeingFired.length)return S=i.onReadyBeingFired.reduce(Wr,he),i.onReadyBeingFired=[],W.resolve(yi(function(){return S(n.vip)})).then(A)})}).finally(function(){i.openCanceller===u&&(i.onReadyBeingFired=null,i.isBeingOpened=!1)}).catch(function(A){i.dbOpenError=A;try{_&&_.abort()}catch{}return u===i.openCanceller&&n._close(),Pe(A)}).finally(function(){i.openComplete=!0,I()}).then(function(){var A;return w&&(A={},n.tables.forEach(function(S){S.schema.indexes.forEach(function(k){k.name&&(A["idb://".concat(n.name,"/").concat(S.name,"/").concat(k.name)]=new $e(-1/0,[[[]]]))}),A["idb://".concat(n.name,"/").concat(S.name,"/")]=A["idb://".concat(n.name,"/").concat(S.name,"/:dels")]=new $e(-1/0,[[[]]])}),Pt(Nn).fire(A),wi(A,!0)),n})}function Ei(n){function i(p){return n.next(p)}var a=l(i),u=l(function(p){return n.throw(p)});function l(p){return function(g){var g=p(g),x=g.value;return g.done?x:x&&typeof x.then=="function"?x.then(a,u):d(x)?Promise.all(x).then(a,u):a(x)}}return l(i)()}function mr(n,i,a){for(var u=d(n)?n.slice():[n],l=0;l<a;++l)u.push(i);return u}var zc={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(n){return o(o({},n),{table:function(u){var a=n.table(u),u=a.schema,l={},p=[];function y(A,S,k){var T=$n(A),E=l[T]=l[T]||[],P=A==null?0:typeof A=="string"?1:A.length,B=0<S,T=o(o({},k),{name:B?"".concat(T,"(virtual-from:").concat(k.name,")"):k.name,lowLevelIndex:k,isVirtual:B,keyTail:S,keyLength:P,extractKey:ui(A),unique:!B&&k.unique});return E.push(T),T.isPrimaryKey||p.push(T),1<P&&y(P===2?A[0]:A.slice(0,P-1),S+1,k),E.sort(function(M,U){return M.keyTail-U.keyTail}),T}var g=y(u.primaryKey.keyPath,0,u.primaryKey);l[":id"]=[g];for(var x=0,I=u.indexes;x<I.length;x++){var _=I[x];y(_.keyPath,0,_)}function w(A){var S,k=A.query.index;return k.isVirtual?o(o({},A),{query:{index:k.lowLevelIndex,range:(S=A.query.range,k=k.keyTail,{type:S.type===1?2:S.type,lower:mr(S.lower,S.lowerOpen?n.MAX_KEY:n.MIN_KEY,k),lowerOpen:!0,upper:mr(S.upper,S.upperOpen?n.MIN_KEY:n.MAX_KEY,k),upperOpen:!0})}}):A}return o(o({},a),{schema:o(o({},u),{primaryKey:g,indexes:p,getIndexByKeyPath:function(A){return(A=l[$n(A)])&&A[0]}}),count:function(A){return a.count(w(A))},query:function(A){return a.query(w(A))},openCursor:function(A){var S=A.query.index,k=S.keyTail,E=S.keyLength;return S.isVirtual?a.openCursor(w(A)).then(function(B){return B&&P(B)}):a.openCursor(A);function P(B){return Object.create(B,{continue:{value:function(T){T!=null?B.continue(mr(T,A.reverse?n.MAX_KEY:n.MIN_KEY,k)):A.unique?B.continue(B.key.slice(0,E).concat(A.reverse?n.MIN_KEY:n.MAX_KEY,k)):B.continue()}},continuePrimaryKey:{value:function(T,M){B.continuePrimaryKey(mr(T,n.MAX_KEY,k),M)}},primaryKey:{get:function(){return B.primaryKey}},key:{get:function(){var T=B.key;return E===1?T[0]:T.slice(0,E)}},value:{get:function(){return B.value}}})}}})}})}};function xi(n,i,a,u){return a=a||{},u=u||"",f(n).forEach(function(l){var p,y,g;b(i,l)?(p=n[l],y=i[l],typeof p=="object"&&typeof y=="object"&&p&&y?(g=q(p))!==q(y)?a[u+l]=i[l]:g==="Object"?xi(p,y,a,u+l+"."):p!==y&&(a[u+l]=i[l]):p!==y&&(a[u+l]=i[l])):a[u+l]=void 0}),f(i).forEach(function(l){b(n,l)||(a[u+l]=i[l])}),a}function _i(n,i){return i.type==="delete"?i.keys:i.keys||i.values.map(n.extractKey)}var Wc={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(n){return o(o({},n),{table:function(i){var a=n.table(i),u=a.schema.primaryKey;return o(o({},a),{mutate:function(l){var p=Q.trans,y=p.table(i).hook,g=y.deleting,x=y.creating,I=y.updating;switch(l.type){case"add":if(x.fire===he)break;return p._promise("readwrite",function(){return _(l)},!0);case"put":if(x.fire===he&&I.fire===he)break;return p._promise("readwrite",function(){return _(l)},!0);case"delete":if(g.fire===he)break;return p._promise("readwrite",function(){return _(l)},!0);case"deleteRange":if(g.fire===he)break;return p._promise("readwrite",function(){return(function w(A,S,k){return a.query({trans:A,values:!1,query:{index:u,range:S},limit:k}).then(function(E){var P=E.result;return _({type:"delete",keys:P,trans:A}).then(function(B){return 0<B.numFailures?Promise.reject(B.failures[0]):P.length<k?{failures:[],numFailures:0,lastResult:void 0}:w(A,o(o({},S),{lower:P[P.length-1],lowerOpen:!0}),k)})})})(l.trans,l.range,1e4)},!0)}return a.mutate(l);function _(w){var A,S,k,E=Q.trans,P=w.keys||_i(u,w);if(P)return(w=w.type==="add"||w.type==="put"?o(o({},w),{keys:P}):o({},w)).type!=="delete"&&(w.values=s([],w.values)),w.keys&&(w.keys=s([],w.keys)),A=a,k=P,((S=w).type==="add"?Promise.resolve([]):A.getMany({trans:S.trans,keys:k,cache:"immutable"})).then(function(B){var T=P.map(function(M,U){var D,H,K,Y=B[U],G={onerror:null,onsuccess:null};return w.type==="delete"?g.fire.call(G,M,Y,E):w.type==="add"||Y===void 0?(D=x.fire.call(G,M,w.values[U],E),M==null&&D!=null&&(w.keys[U]=M=D,u.outbound||Z(w.values[U],u.keyPath,M))):(D=xi(Y,w.values[U]),(H=I.fire.call(G,D,M,Y,E))&&(K=w.values[U],Object.keys(H).forEach(function(j){b(K,j)?K[j]=H[j]:Z(K,j,H[j])}))),G});return a.mutate(w).then(function(M){for(var U=M.failures,D=M.results,H=M.numFailures,M=M.lastResult,K=0;K<P.length;++K){var Y=(D||P)[K],G=T[K];Y==null?G.onerror&&G.onerror(U[K]):G.onsuccess&&G.onsuccess(w.type==="put"&&B[K]?w.values[K]:Y)}return{failures:U,results:D,numFailures:H,lastResult:M}}).catch(function(M){return T.forEach(function(U){return U.onerror&&U.onerror(M)}),Promise.reject(M)})});throw new Error("Keys missing")}}})}})}};function fs(n,i,a){try{if(!i||i.keys.length<n.length)return null;for(var u=[],l=0,p=0;l<i.keys.length&&p<n.length;++l)ye(i.keys[l],n[p])===0&&(u.push(a?pe(i.values[l]):i.values[l]),++p);return u.length===n.length?u:null}catch{return null}}var Gc={stack:"dbcore",level:-1,create:function(n){return{table:function(i){var a=n.table(i);return o(o({},a),{getMany:function(u){var l;return u.cache?(l=fs(u.keys,u.trans._cache,u.cache==="clone"))?W.resolve(l):a.getMany(u).then(function(p){return u.trans._cache={keys:u.keys,values:u.cache==="clone"?pe(p):p},p}):a.getMany(u)},mutate:function(u){return u.type!=="add"&&(u.trans._cache=null),a.mutate(u)}})}}}};function hs(n,i){return n.trans.mode==="readonly"&&!!n.subscr&&!n.trans.explicit&&n.trans.db._options.cache!=="disabled"&&!i.schema.primaryKey.outbound}function ds(n,i){switch(n){case"query":return i.values&&!i.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var Zc={stack:"dbcore",level:0,name:"Observability",create:function(n){var i=n.schema.name,a=new $e(n.MIN_KEY,n.MAX_KEY);return o(o({},n),{transaction:function(u,l,p){if(Q.subscr&&l!=="readonly")throw new X.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(Q.querier));return n.transaction(u,l,p)},table:function(u){function l(P){var E,P=P.query;return[E=P.index,new $e((E=(P=P.range).lower)!=null?E:n.MIN_KEY,(E=P.upper)!=null?E:n.MAX_KEY)]}var p=n.table(u),y=p.schema,g=y.primaryKey,x=y.indexes,I=g.extractKey,_=g.outbound,w=g.autoIncrement&&x.filter(function(k){return k.compound&&k.keyPath.includes(g.keyPath)}),A=o(o({},p),{mutate:function(k){function E(J){return J="idb://".concat(i,"/").concat(u,"/").concat(J),U[J]||(U[J]=new $e)}var P,B,T,M=k.trans,U=k.mutatedParts||(k.mutatedParts={}),D=E(""),H=E(":dels"),K=k.type,G=k.type==="deleteRange"?[k.range]:k.type==="delete"?[k.keys]:k.values.length<50?[_i(g,k).filter(function(J){return J}),k.values]:[],Y=G[0],G=G[1],j=k.trans._cache;return d(Y)?(D.addKeys(Y),(K=K==="delete"||Y.length===G.length?fs(Y,j):null)||H.addKeys(Y),(K||G)&&(P=E,B=K,T=G,y.indexes.forEach(function(J){var ge=P(J.name||"");function ve(de){return de!=null?J.extractKey(de):null}function re(de){J.multiEntry&&d(de)?de.forEach(function(Te){return ge.addKey(Te)}):ge.addKey(de)}(B||T).forEach(function(de,Ie){var Ze=B&&ve(B[Ie]),Ie=T&&ve(T[Ie]);ye(Ze,Ie)!==0&&(Ze!=null&&re(Ze),Ie!=null)&&re(Ie)})}))):Y?(G={from:(j=Y.lower)!=null?j:n.MIN_KEY,to:(K=Y.upper)!=null?K:n.MAX_KEY},H.add(G),D.add(G)):(D.add(a),H.add(a),y.indexes.forEach(function(J){return E(J.name).add(a)})),p.mutate(k).then(function(J){return!Y||k.type!=="add"&&k.type!=="put"||(D.addKeys(J.results),w&&w.forEach(function(ge){for(var ve=k.values.map(function(Ze){return ge.extractKey(Ze)}),re=ge.keyPath.findIndex(function(Ze){return Ze===g.keyPath}),de=0,Te=J.results.length;de<Te;++de)ve[de][re]=J.results[de];E(ge.name).addKeys(ve)})),M.mutatedParts=yr(M.mutatedParts||{},U),J})}}),S={get:function(k){return[g,new $e(k.key)]},getMany:function(k){return[g,new $e().addKeys(k.keys)]},count:l,query:l,openCursor:l};return f(S).forEach(function(k){A[k]=function(E){var P=Q.subscr,B=!!P,T=hs(Q,p)&&ds(k,E)?E.obsSet={}:P;if(B){var M,P=function(G){return G="idb://".concat(i,"/").concat(u,"/").concat(G),T[G]||(T[G]=new $e)},U=P(""),D=P(":dels"),B=S[k](E),H=B[0],B=B[1];if((k==="query"&&H.isPrimaryKey&&!E.values?D:P(H.name||"")).add(B),!H.isPrimaryKey){if(k!=="count")return M=k==="query"&&_&&E.values&&p.query(o(o({},E),{values:!1})),p[k].apply(this,arguments).then(function(G){if(k==="query"){if(_&&E.values)return M.then(function(ve){return ve=ve.result,U.addKeys(ve),G});var j=E.values?G.result.map(I):G.result;(E.values?U:D).addKeys(j)}else{var J,ge;if(k==="openCursor")return ge=E.values,(J=G)&&Object.create(J,{key:{get:function(){return D.addKey(J.primaryKey),J.key}},primaryKey:{get:function(){var ve=J.primaryKey;return D.addKey(ve),ve}},value:{get:function(){return ge&&U.addKey(J.primaryKey),J.value}}})}return G});D.add(a)}}return p[k].apply(this,arguments)}}),A}})}};function ps(n,i,a){var u;return a.numFailures===0?i:i.type==="deleteRange"||(u=i.keys?i.keys.length:"values"in i&&i.values?i.values.length:1,a.numFailures===u)?null:(u=o({},i),d(u.keys)&&(u.keys=u.keys.filter(function(l,p){return!(p in a.failures)})),"values"in u&&d(u.values)&&(u.values=u.values.filter(function(l,p){return!(p in a.failures)})),u)}function ki(n,i){return a=n,((u=i).lower===void 0||(u.lowerOpen?0<ye(a,u.lower):0<=ye(a,u.lower)))&&(a=n,(u=i).upper===void 0||(u.upperOpen?ye(a,u.upper)<0:ye(a,u.upper)<=0));var a,u}function ys(n,i,a,u,l,p){var y,g,x,I,_,w;return!a||a.length===0||(y=i.query.index,g=y.multiEntry,x=i.query.range,I=u.schema.primaryKey.extractKey,_=y.extractKey,w=(y.lowLevelIndex||y).extractKey,(u=a.reduce(function(A,S){var k=A,E=[];if(S.type==="add"||S.type==="put")for(var P=new $e,B=S.values.length-1;0<=B;--B){var T,M=S.values[B],U=I(M);!P.hasKey(U)&&(T=_(M),g&&d(T)?T.some(function(G){return ki(G,x)}):ki(T,x))&&(P.addKey(U),E.push(M))}switch(S.type){case"add":var D=new $e().addKeys(i.values?A.map(function(j){return I(j)}):A),k=A.concat(i.values?E.filter(function(j){return j=I(j),!D.hasKey(j)&&(D.addKey(j),!0)}):E.map(function(j){return I(j)}).filter(function(j){return!D.hasKey(j)&&(D.addKey(j),!0)}));break;case"put":var H=new $e().addKeys(S.values.map(function(j){return I(j)}));k=A.filter(function(j){return!H.hasKey(i.values?I(j):j)}).concat(i.values?E:E.map(function(j){return I(j)}));break;case"delete":var K=new $e().addKeys(S.keys);k=A.filter(function(j){return!K.hasKey(i.values?I(j):j)});break;case"deleteRange":var Y=S.range;k=A.filter(function(j){return!ki(I(j),Y)})}return k},n))===n)?n:(u.sort(function(A,S){return ye(w(A),w(S))||ye(I(A),I(S))}),i.limit&&i.limit<1/0&&(u.length>i.limit?u.length=i.limit:n.length===i.limit&&u.length<i.limit&&(l.dirty=!0)),p?Object.freeze(u):u)}function gs(n,i){return ye(n.lower,i.lower)===0&&ye(n.upper,i.upper)===0&&!!n.lowerOpen==!!i.lowerOpen&&!!n.upperOpen==!!i.upperOpen}function Yc(n,i){return((a,u,l,p)=>{if(a===void 0)return u!==void 0?-1:0;if(u===void 0)return 1;if((a=ye(a,u))===0){if(l&&p)return 0;if(l)return 1;if(p)return-1}return a})(n.lower,i.lower,n.lowerOpen,i.lowerOpen)<=0&&0<=((a,u,l,p)=>{if(a===void 0)return u!==void 0?1:0;if(u===void 0)return-1;if((a=ye(a,u))===0){if(l&&p)return 0;if(l)return-1;if(p)return 1}return a})(n.upper,i.upper,n.upperOpen,i.upperOpen)}function Jc(n,i,a,u){n.subscribers.add(a),u.addEventListener("abort",function(){var l,p;n.subscribers.delete(a),n.subscribers.size===0&&(l=n,p=i,setTimeout(function(){l.subscribers.size===0&&oe(p,l)},3e3))})}var Xc={stack:"dbcore",level:0,name:"Cache",create:function(n){var i=n.schema.name;return o(o({},n),{transaction:function(a,u,l){var p,y,g=n.transaction(a,u,l);return u==="readwrite"&&(l=(p=new AbortController).signal,g.addEventListener("abort",(y=function(x){return function(){if(p.abort(),u==="readwrite"){for(var I=new Set,_=0,w=a;_<w.length;_++){var A=w[_],S=zt["idb://".concat(i,"/").concat(A)];if(S){var k=n.table(A),E=S.optimisticOps.filter(function(J){return J.trans===g});if(g._explicit&&x&&g.mutatedParts)for(var P=0,B=Object.values(S.queries.query);P<B.length;P++)for(var T=0,M=(H=B[P]).slice();T<M.length;T++)mi((K=M[T]).obsSet,g.mutatedParts)&&(oe(H,K),K.subscribers.forEach(function(J){return I.add(J)}));else if(0<E.length){S.optimisticOps=S.optimisticOps.filter(function(J){return J.trans!==g});for(var U=0,D=Object.values(S.queries.query);U<D.length;U++)for(var H,K,Y,G=0,j=(H=D[U]).slice();G<j.length;G++)(K=j[G]).res!=null&&g.mutatedParts&&(x&&!K.dirty?(Y=Object.isFrozen(K.res),Y=ys(K.res,K.req,E,k,K,Y),K.dirty?(oe(H,K),K.subscribers.forEach(function(J){return I.add(J)})):Y!==K.res&&(K.res=Y,K.promise=W.resolve({result:Y}))):(K.dirty&&oe(H,K),K.subscribers.forEach(function(J){return I.add(J)})))}}}I.forEach(function(J){return J()})}}})(!1),{signal:l}),g.addEventListener("error",y(!1),{signal:l}),g.addEventListener("complete",y(!0),{signal:l})),g},table:function(a){var u=n.table(a),l=u.schema.primaryKey;return o(o({},u),{mutate:function(p){var y,g=Q.trans;return!l.outbound&&g.db._options.cache!=="disabled"&&!g.explicit&&g.idbtrans.mode==="readwrite"&&(y=zt["idb://".concat(i,"/").concat(a)])?(g=u.mutate(p),p.type!=="add"&&p.type!=="put"||!(50<=p.values.length||_i(l,p).some(function(x){return x==null}))?(y.optimisticOps.push(p),p.mutatedParts&&gr(p.mutatedParts),g.then(function(x){0<x.numFailures&&(oe(y.optimisticOps,p),(x=ps(0,p,x))&&y.optimisticOps.push(x),p.mutatedParts)&&gr(p.mutatedParts)}),g.catch(function(){oe(y.optimisticOps,p),p.mutatedParts&&gr(p.mutatedParts)})):g.then(function(x){var I=ps(0,o(o({},p),{values:p.values.map(function(_,w){var A;return x.failures[w]?_:(Z(A=(A=l.keyPath)!=null&&A.includes(".")?pe(_):o({},_),l.keyPath,x.results[w]),A)})}),x);y.optimisticOps.push(I),queueMicrotask(function(){return p.mutatedParts&&gr(p.mutatedParts)})}),g):u.mutate(p)},query:function(p){var y,g,x,I,_,w,A;return hs(Q,u)&&ds("query",p)?(y=((x=Q.trans)==null?void 0:x.db._options.cache)==="immutable",g=(x=Q).requery,x=x.signal,w=((S,k,E,P)=>{var B=zt["idb://".concat(S,"/").concat(k)];if(!B)return[];if(!(S=B.queries[E]))return[null,!1,B,null];var T=S[(P.query?P.query.index.name:null)||""];if(!T)return[null,!1,B,null];switch(E){case"query":var M=T.find(function(U){return U.req.limit===P.limit&&U.req.values===P.values&&gs(U.req.query.range,P.query.range)});return M?[M,!0,B,T]:[T.find(function(U){return("limit"in U.req?U.req.limit:1/0)>=P.limit&&(!P.values||U.req.values)&&Yc(U.req.query.range,P.query.range)}),!1,B,T];case"count":return M=T.find(function(U){return gs(U.req.query.range,P.query.range)}),[M,!!M,B,T]}})(i,a,"query",p),A=w[0],I=w[2],_=w[3],A&&w[1]?A.obsSet=p.obsSet:(w=u.query(p).then(function(S){var k=S.result;if(A&&(A.res=k),y){for(var E=0,P=k.length;E<P;++E)Object.freeze(k[E]);Object.freeze(k)}else S.result=pe(k);return S}).catch(function(S){return _&&A&&oe(_,A),Promise.reject(S)}),A={obsSet:p.obsSet,promise:w,subscribers:new Set,type:"query",req:p,dirty:!1},_?_.push(A):(_=[A],(I=I||(zt["idb://".concat(i,"/").concat(a)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[p.query.index.name||""]=_)),Jc(A,_,g,x),A.promise.then(function(S){return{result:ys(S.result,p,I?.optimisticOps,u,A,y)}})):u.query(p)}})}})}};function br(n,i){return new Proxy(n,{get:function(a,u,l){return u==="db"?i:Reflect.get(a,u,l)}})}Oe.prototype.version=function(n){if(isNaN(n)||n<.1)throw new X.Type("Given version is not a positive number");if(n=Math.round(10*n)/10,this.idbdb||this._state.isBeingOpened)throw new X.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,n);var i=this._versions,a=i.filter(function(u){return u._cfg.version===n})[0];return a||(a=new this.Version(n),i.push(a),i.sort(jc),a.stores({}),this._state.autoSchema=!1),a},Oe.prototype._whenReady=function(n){var i=this;return this.idbdb&&(this._state.openComplete||Q.letThrough||this._vip)?n():new W(function(a,u){if(i._state.openComplete)return u(new X.DatabaseClosed(i._state.dbOpenError));if(!i._state.isBeingOpened){if(!i._state.autoOpen)return void u(new X.DatabaseClosed);i.open().catch(he)}i._state.dbReadyPromise.then(a,u)}).then(n)},Oe.prototype.use=function(l){var i=l.stack,a=l.create,u=l.level,l=l.name,p=(l&&this.unuse({stack:i,name:l}),this._middlewares[i]||(this._middlewares[i]=[]));return p.push({stack:i,create:a,level:u??10,name:l}),p.sort(function(y,g){return y.level-g.level}),this},Oe.prototype.unuse=function(n){var i=n.stack,a=n.name,u=n.create;return i&&this._middlewares[i]&&(this._middlewares[i]=this._middlewares[i].filter(function(l){return u?l.create!==u:!!a&&l.name!==a})),this},Oe.prototype.open=function(){var n=this;return Ht(kt,function(){return Vc(n)})},Oe.prototype._close=function(){this.on.close.fire(new CustomEvent("close"));var n=this._state,i=un.indexOf(this);if(0<=i&&un.splice(i,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}n.isBeingOpened||(n.dbReadyPromise=new W(function(a){n.dbReadyResolve=a}),n.openCanceller=new W(function(a,u){n.cancelOpen=u}))},Oe.prototype.close=function(i){var i=(i===void 0?{disableAutoOpen:!0}:i).disableAutoOpen,a=this._state;i?(a.isBeingOpened&&a.cancelOpen(new X.DatabaseClosed),this._close(),a.autoOpen=!1,a.dbOpenError=new X.DatabaseClosed):(this._close(),a.autoOpen=this._options.autoOpen||a.isBeingOpened,a.openComplete=!1,a.dbOpenError=null)},Oe.prototype.delete=function(n){var i=this,a=(n===void 0&&(n={disableAutoOpen:!0}),0<arguments.length&&typeof arguments[0]!="object"),u=this._state;return new W(function(l,p){function y(){i.close(n);var g=i._deps.indexedDB.deleteDatabase(i.name);g.onsuccess=Se(function(){var x,I,_;x=i._deps,I=i.name,pi(_=x.indexedDB)||I===rr||di(_,x.IDBKeyRange).delete(I).catch(he),l()}),g.onerror=rt(p),g.onblocked=i._fireOnBlocked}if(a)throw new X.InvalidArgument("Invalid closeOptions argument to db.delete()");u.isBeingOpened?u.dbReadyPromise.then(y):y()})},Oe.prototype.backendDB=function(){return this.idbdb},Oe.prototype.isOpen=function(){return this.idbdb!==null},Oe.prototype.hasBeenClosed=function(){var n=this._state.dbOpenError;return n&&n.name==="DatabaseClosed"},Oe.prototype.hasFailed=function(){return this._state.dbOpenError!==null},Oe.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(Oe.prototype,"tables",{get:function(){var n=this;return f(this._allTables).map(function(i){return n._allTables[i]})},enumerable:!1,configurable:!0}),Oe.prototype.transaction=function(){var n=function(i,a,u){var l=arguments.length;if(l<2)throw new X.InvalidArgument("Too few arguments");for(var p=new Array(l-1);--l;)p[l-1]=arguments[l];return u=p.pop(),[i,le(p),u]}.apply(this,arguments);return this._transaction.apply(this,n)},Oe.prototype._transaction=function(n,i,a){var u,l,p=this,y=Q.trans,g=(y&&y.db===this&&n.indexOf("!")===-1||(y=null),n.indexOf("?")!==-1);n=n.replace("!","").replace("?","");try{if(l=i.map(function(I){if(I=I instanceof p.Table?I.name:I,typeof I!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return I}),n=="r"||n===ni)u=ni;else{if(n!="rw"&&n!=ri)throw new X.InvalidArgument("Invalid transaction mode: "+n);u=ri}if(y){if(y.mode===ni&&u===ri){if(!g)throw new X.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");y=null}y&&l.forEach(function(I){if(y&&y.storeNames.indexOf(I)===-1){if(!g)throw new X.SubTransaction("Table "+I+" not included in parent transaction.");y=null}}),g&&y&&!y.active&&(y=null)}}catch(I){return y?y._promise(null,function(_,w){w(I)}):Pe(I)}var x=function I(_,w,A,S,k){return W.resolve().then(function(){var T=Q.transless||Q,E=_._createTransaction(w,A,_._dbSchema,S),T=(E.explicit=!0,{trans:E,transless:T});if(S)E.idbtrans=S.idbtrans;else try{E.create(),E.idbtrans._explicit=!0,_._state.PR1398_maxLoop=3}catch(M){return M.name===Kt.InvalidState&&_.isOpen()&&0<--_._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),_.close({disableAutoOpen:!1}),_.open().then(function(){return I(_,w,A,null,k)})):Pe(M)}var P,B=Ee(k),T=(B&&cn(),W.follow(function(){var M;(P=k.call(E,E))&&(B?(M=St.bind(null,null),P.then(M,M)):typeof P.next=="function"&&typeof P.throw=="function"&&(P=Ei(P)))},T));return(P&&typeof P.then=="function"?W.resolve(P).then(function(M){return E.active?M:Pe(new X.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):T.then(function(){return P})).then(function(M){return S&&E._resolve(),E._completion.then(function(){return M})}).catch(function(M){return E._reject(M),Pe(M)})})}.bind(null,this,u,l,y,a);return y?y._promise(u,x,"lock"):Q.trans?Ht(Q.transless,function(){return p._whenReady(x)}):this._whenReady(x)},Oe.prototype.table=function(n){if(b(this._allTables,n))return this._allTables[n];throw new X.InvalidTable("Table ".concat(n," does not exist"))};var pt=Oe;function Oe(n,i){var a,u,l,p,y,g=this,x=(this._middlewares={},this.verno=0,Oe.dependencies),x=(this._options=i=o({addons:Oe.addons,autoOpen:!0,indexedDB:x.indexedDB,IDBKeyRange:x.IDBKeyRange,cache:"cloned"},i),this._deps={indexedDB:i.indexedDB,IDBKeyRange:i.IDBKeyRange},i.addons),I=(this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this,{dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:he,dbReadyPromise:null,cancelOpen:he,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:i.autoOpen}),_=(I.dbReadyPromise=new W(function(w){I.dbReadyResolve=w}),I.openCanceller=new W(function(w,A){I.cancelOpen=A}),this._state=I,this.name=n,this.on=Cn(this,"populate","blocked","versionchange","close",{ready:[Wr,he]}),this.once=function(w,A){var S=function(){for(var k=[],E=0;E<arguments.length;E++)k[E]=arguments[E];g.on(w).unsubscribe(S),A.apply(g,k)};return g.on(w,S)},this.on.ready.subscribe=ee(this.on.ready.subscribe,function(w){return function(A,S){Oe.vip(function(){var k,E=g._state;E.openComplete?(E.dbOpenError||W.resolve().then(A),S&&w(A)):E.onReadyBeingFired?(E.onReadyBeingFired.push(A),S&&w(A)):(w(A),k=g,S||w(function P(){k.on.ready.unsubscribe(A),k.on.ready.unsubscribe(P)}))})}}),this.Collection=(a=this,Rn(Lc.prototype,function(P,E){this.db=a;var S=Vo,k=null;if(E)try{S=E()}catch(T){k=T}var E=P._ctx,P=E.table,B=P.hook.reading.fire;this._ctx={table:P,index:E.index,isPrimKey:!E.index||P.schema.primKey.keyPath&&E.index===P.schema.primKey.name,range:S,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:k,or:E.or,valueMapper:B!==Ge?B:null}})),this.Table=(u=this,Rn(Jo.prototype,function(w,A,S){this.db=u,this._tx=S,this.name=w,this.schema=A,this.hook=u._allTables[w]?u._allTables[w].hook:Cn(null,{creating:[Gn,he],reading:[on,Ge],updating:[Tc,he],deleting:[Sc,he]})})),this.Transaction=(l=this,Rn($c.prototype,function(w,A,S,k,E){var P=this;w!=="readonly"&&A.forEach(function(B){B=(B=S[B])==null?void 0:B.yProps,B&&(A=A.concat(B.map(function(T){return T.updatesTable})))}),this.db=l,this.mode=w,this.storeNames=A,this.schema=S,this.chromeTransactionDurability=k,this.idbtrans=null,this.on=Cn(this,"complete","error","abort"),this.parent=E||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new W(function(B,T){P._resolve=B,P._reject=T}),this._completion.then(function(){P.active=!1,P.on.complete.fire()},function(B){var T=P.active;return P.active=!1,P.on.error.fire(B),P.parent?P.parent._reject(B):T&&P.idbtrans&&P.idbtrans.abort(),Pe(B)})})),this.Version=(p=this,Rn(Fc.prototype,function(w){this.db=p,this._cfg={version:w,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(y=this,Rn(ns.prototype,function(w,A,S){if(this.db=y,this._ctx={table:w,index:A===":id"?null:A,or:S},this._cmp=this._ascending=ye,this._descending=function(k,E){return ye(E,k)},this._max=function(k,E){return 0<ye(k,E)?k:E},this._min=function(k,E){return ye(k,E)<0?k:E},this._IDBKeyRange=y._deps.IDBKeyRange,!this._IDBKeyRange)throw new X.MissingAPI})),this.on("versionchange",function(w){0<w.newVersion?console.warn("Another connection wants to upgrade database '".concat(g.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(g.name,"'. Closing db now to resume the delete request.")),g.close({disableAutoOpen:!1})}),this.on("blocked",function(w){!w.newVersion||w.newVersion<w.oldVersion?console.warn("Dexie.delete('".concat(g.name,"') was blocked")):console.warn("Upgrade '".concat(g.name,"' blocked by other connection holding version ").concat(w.oldVersion/10))}),this._maxKey=Mn(i.IDBKeyRange),this._createTransaction=function(w,A,S,k){return new g.Transaction(w,A,S,g._options.chromeTransactionDurability,k)},this._fireOnBlocked=function(w){g.on("blocked").fire(w),un.filter(function(A){return A.name===g.name&&A!==g&&!A._state.vcFired}).map(function(A){return A.on("versionchange").fire(w)})},this.use(Gc),this.use(Xc),this.use(Zc),this.use(zc),this.use(Wc),new Proxy(this,{get:function(w,A,S){var k;return A==="_vip"||(A==="table"?function(E){return br(g.table(E),_)}:(k=Reflect.get(w,A,S))instanceof Jo?br(k,_):A==="tables"?k.map(function(E){return br(E,_)}):A==="_createTransaction"?function(){return br(k.apply(this,arguments),_)}:k)}}));this.vip=_,x.forEach(function(w){return w(g)})}var vr,dn=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",Qc=(Ai.prototype.subscribe=function(n,i,a){return this._subscribe(n&&typeof n!="function"?n:{next:n,error:i,complete:a})},Ai.prototype[dn]=function(){return this},Ai);function Ai(n){this._subscribe=n}try{vr={indexedDB:c.indexedDB||c.mozIndexedDB||c.webkitIndexedDB||c.msIndexedDB,IDBKeyRange:c.IDBKeyRange||c.webkitIDBKeyRange}}catch{vr={indexedDB:null,IDBKeyRange:null}}function ms(n){var i,a=!1,u=new Qc(function(l){var p=Ee(n),y,g=!1,x={},I={},_={get closed(){return g},unsubscribe:function(){g||(g=!0,y&&y.abort(),w&&Pt.storagemutated.unsubscribe(S))}},w=(l.start&&l.start(_),!1),A=function(){return ti(k)},S=function(E){yr(x,E),mi(I,x)&&A()},k=function(){var E,P,B;!g&&vr.indexedDB&&(x={},E={},y&&y.abort(),y=new AbortController,B=(T=>{var M=sn();try{p&&cn();var U=At(n,T);return U=p?U.finally(St):U}finally{M&&an()}})(P={subscr:E,signal:y.signal,requery:A,querier:n,trans:null}),Promise.resolve(B).then(function(T){a=!0,i=T,g||P.signal.aborted||(x={},(M=>{for(var U in M)if(b(M,U))return;return 1})(I=E)||w||(Pt(Nn,S),w=!0),ti(function(){return!g&&l.next&&l.next(T)}))},function(T){a=!1,["DatabaseClosedError","AbortError"].includes(T?.name)||g||ti(function(){g||l.error&&l.error(T)})}))};return setTimeout(A,0),_});return u.hasValue=function(){return a},u.getValue=function(){return i},u}var Wt=pt;function Si(n){var i=Ot;try{Ot=!0,Pt.storagemutated.fire(n),wi(n,!0)}finally{Ot=i}}C(Wt,o(o({},fe),{delete:function(n){return new Wt(n,{addons:[]}).delete()},exists:function(n){return new Wt(n,{addons:[]}).open().then(function(i){return i.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(n){try{return i=Wt.dependencies,a=i.indexedDB,i=i.IDBKeyRange,(pi(a)?Promise.resolve(a.databases()).then(function(u){return u.map(function(l){return l.name}).filter(function(l){return l!==rr})}):di(a,i).toCollection().primaryKeys()).then(n)}catch{return Pe(new X.MissingAPI)}var i,a},defineClass:function(){return function(n){h(this,n)}},ignoreTransaction:function(n){return Q.trans?Ht(Q.transless,n):n()},vip:yi,async:function(n){return function(){try{var i=Ei(n.apply(this,arguments));return i&&typeof i.then=="function"?i:W.resolve(i)}catch(a){return Pe(a)}}},spawn:function(n,i,a){try{var u=Ei(n.apply(a,i||[]));return u&&typeof u.then=="function"?u:W.resolve(u)}catch(l){return Pe(l)}},currentTransaction:{get:function(){return Q.trans||null}},waitFor:function(n,i){return n=W.resolve(typeof n=="function"?Wt.ignoreTransaction(n):n).timeout(i||6e4),Q.trans?Q.trans.waitFor(n):n},Promise:W,debug:{get:function(){return nt},set:function(n){Uo(n)}},derive:O,extend:h,props:C,override:ee,Events:Cn,on:Pt,liveQuery:ms,extendObservabilitySet:yr,getByKeyPath:z,setByKeyPath:Z,delByKeyPath:function(n,i){typeof i=="string"?Z(n,i,void 0):"length"in i&&[].map.call(i,function(a){Z(n,a,void 0)})},shallowClone:te,deepClone:pe,getObjectDiff:xi,cmp:ye,asap:ce,minKey:-1/0,addons:[],connections:un,errnames:Kt,dependencies:vr,cache:zt,semVer:"4.3.0",version:"4.3.0".split(".").map(function(n){return parseInt(n)}).reduce(function(n,i,a){return n+i/Math.pow(10,2*a)})})),Wt.maxKey=Mn(Wt.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(Pt(Nn,function(n){Ot||(n=new CustomEvent(si,{detail:n}),Ot=!0,dispatchEvent(n),Ot=!1)}),addEventListener(si,function(n){n=n.detail,Ot||Si(n)}));var pn,Ot=!1,bs=function(){};return typeof BroadcastChannel<"u"&&((bs=function(){(pn=new BroadcastChannel(si)).onmessage=function(n){return n.data&&Si(n.data)}})(),typeof pn.unref=="function"&&pn.unref(),Pt(Nn,function(n){Ot||pn.postMessage(n)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(n){if(!pt.disableBfCache&&n.persisted){nt&&console.debug("Dexie: handling persisted pagehide"),pn?.close();for(var i=0,a=un;i<a.length;i++)a[i].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(n){!pt.disableBfCache&&n.persisted&&(nt&&console.debug("Dexie: handling persisted pageshow"),bs(),Si({all:new $e(-1/0,[[]])}))})),W.rejectionMapper=function(n,i){return!n||n instanceof je||n instanceof TypeError||n instanceof SyntaxError||!n.name||!Sn[n.name]?n:(i=new Sn[n.name](i||n.message,n),"stack"in n&&L(i,"stack",{get:function(){return this.inner.stack}}),i)},Uo(nt),o(pt,Object.freeze({__proto__:null,Dexie:pt,Entity:zo,PropModification:Bn,RangeSet:$e,add:function(n){return new Bn({add:n})},cmp:ye,default:pt,liveQuery:ms,mergeRanges:Kn,rangesOverlap:as,remove:function(n){return new Bn({remove:n})},replacePrefix:function(n,i){return new Bn({replacePrefix:[n,i]})}}),{default:pt}),pt})})(kr)),kr.exports}var fp=lp();const eo=cp(fp),qs=Symbol.for("Dexie"),_n=globalThis[qs]||(globalThis[qs]=eo);if(eo.semVer!==_n.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${eo.semVer} and ${_n.semVer}`);const{liveQuery:jp,mergeRanges:Dp,rangesOverlap:Hp,RangeSet:Fp,cmp:Vp,Entity:zp,PropModification:Wp,replacePrefix:Gp,add:Zp,remove:Yp,DexieYProvider:Jp}=_n,to=3,js="zapstore_schema_version";try{parseInt(localStorage.getItem(js)??"0",10)!==to&&(indexedDB.deleteDatabase("zapstore"),localStorage.setItem(js,String(to)))}catch{}const Le=new _n("zapstore");Le.version(to).stores({events:"id, kind, pubkey, created_at, [kind+created_at], [kind+pubkey], *_tags"});const hp=new Set(["d","a","A","e","i"]);function dp(e){if(!e.tags||e.tags.length===0)return[];const t=[],r=new Set;for(const o of e.tags)if(o[0]&&o[1]){const s=`${o[0]}:${o[1]}`;r.has(s)||(r.add(s),t.push(s))}return t}function pp(e,t){for(const[r,o]of Object.entries(t)){if(!r.startsWith("#")||!Array.isArray(o)||o.length===0)continue;const s=r.slice(1),c=new Set(o);if(!e.tags?.some(d=>d[0]===s&&d[1]&&c.has(d[1])))return!1}return!0}function yp(e){let t=null;for(const[r,o]of Object.entries(e)){if(!r.startsWith("#")||!Array.isArray(o)||o.length===0)continue;const s=r.slice(1);hp.has(s)&&(!t||o.length<t.values.length)&&(t={tagName:s,values:o,filterKey:r})}return t}async function Vr(e){if(!e||e.length===0)return;const t=e.filter(c=>c?.id&&typeof c.kind=="number"&&!(c.kind===We.APP_STACK&&c.content));if(t.length===0)return;const r=[],o=new Map;for(const c of t)if(c.kind===0||c.kind===3||c.kind>=1e4&&c.kind<2e4||c.kind>=3e4){const d=c.kind>=3e4?c.tags?.find(v=>v[0]==="d")?.[1]??"":"",h=`${c.kind}:${c.pubkey}:${d}`,m=o.get(h);(!m||c.created_at>m.created_at)&&o.set(h,c)}else r.push(c);const s=[...r,...o.values()].map(c=>({...c,_tags:dp(c)}));await Le.transaction("rw",Le.events,async()=>{if(o.size>0){const c=new Map;for(const m of o.values()){const v=`${m.kind}:${m.pubkey}`;c.has(v)||c.set(v,[m.kind,m.pubkey])}const f=await Le.events.where("[kind+pubkey]").anyOf([...c.values()]).toArray(),d=new Set([...o.values()].map(m=>m.id)),h=[];for(const m of f){const v=m.tags?.find(C=>C[0]==="d")?.[1]??"",b=`${m.kind}:${m.pubkey}:${v}`;o.has(b)&&!d.has(m.id)&&h.push(m.id)}h.length>0&&await Le.events.bulkDelete(h)}await Le.events.bulkPut(s)})}async function Br(e){let t,r=null;if(e.ids?.length>0)t=await Le.events.where("id").anyOf(e.ids).toArray();else{const o=yp(e);if(o){const s=o.values.map(c=>`${o.tagName}:${c}`);s.length===1?t=await Le.events.where("_tags").equals(s[0]).toArray():t=await Le.events.where("_tags").anyOf(s).toArray(),r=o.filterKey}else e.kinds?.length===1&&e.authors?.length===1?t=await Le.events.where("[kind+pubkey]").equals([e.kinds[0],e.authors[0]]).toArray():e.kinds?.length===1?t=await Le.events.where("kind").equals(e.kinds[0]).toArray():e.kinds?.length>1?t=await Le.events.where("kind").anyOf(e.kinds).toArray():e.authors?.length>0?t=await Le.events.where("pubkey").anyOf(e.authors).toArray():t=await Le.events.toArray()}if(e.kinds?.length>0&&(r||!e.ids&&e.authors?.length!==1)){const o=new Set(e.kinds);t=t.filter(s=>o.has(s.kind))}if(e.authors?.length>0&&!(e.kinds?.length===1&&e.authors.length===1&&!r)){const s=new Set(e.authors);t=t.filter(c=>s.has(c.pubkey))}if(e.since!==void 0&&(t=t.filter(o=>o.created_at>=e.since)),e.until!==void 0&&(t=t.filter(o=>o.created_at<=e.until)),r?t=t.filter(o=>{for(const[s,c]of Object.entries(e)){if(s===r||!s.startsWith("#")||!Array.isArray(c)||c.length===0)continue;const f=s.slice(1),d=new Set(c);if(!o.tags?.some(m=>m[0]===f&&m[1]&&d.has(m[1])))return!1}return!0}):t=t.filter(o=>pp(o,e)),r){const o=new Set;t=t.filter(s=>o.has(s.id)?!1:(o.add(s.id),!0))}return t.sort((o,s)=>s.created_at-o.created_at),e.limit&&e.limit>0&&(t=t.slice(0,e.limit)),t}async function Xp(e){return(await Br({...e,limit:1}))[0]??null}const gp={[We.COMMENT]:500,[We.ZAP_REQUEST]:200,[We.ZAP_RECEIPT]:500,[We.FILE_METADATA]:300,[We.RELEASE]:500},mp=500;async function Qp(){try{const t=(await Le.events.orderBy("kind").uniqueKeys()).filter(r=>r!==0&&r!==3&&!(r>=1e4&&r<2e4)&&!(r>=3e4));for(const r of t){const o=gp[r]??mp;if(await Le.events.where("kind").equals(r).count()<=o)continue;const c=await Le.events.where("[kind+created_at]").between([r,_n.minKey],[r,_n.maxKey]).reverse().offset(o).primaryKeys();c.length>0&&(await Le.events.bulkDelete(c),console.log(`[Dexie] Evicted ${c.length} old kind ${r} events (kept ${o})`))}}catch(e){console.error("[Dexie] Eviction failed:",e)}}const bp=48,vp=24,Ds=bp*3,wp=vp*3;let ji=null;function $o(){return ji||(ji=new Rh),ji}const Ep=300;let mn=[],vn=[],wn=null;const xp=100;function _p(e){e?.id&&(vn.push(e),wn||(wn=setTimeout(kp,xp)))}async function kp(){wn=null;const e=vn;vn=[],e.length>0&&await Vr(e).catch(t=>console.error("[Service] Failed to flush events to Dexie:",t))}function ey(){if(mn.length>0)return;const e=$o(),t={onevent(r){_p(r)},oneose(){},onclose(r){console.log("[Service] Catalog subscription closed:",r)}};mn.push(e.subscribeMany(Dn,{kinds:[We.APP],...zn,limit:Ds},t)),mn.push(e.subscribeMany(Dn,{kinds:[We.RELEASE],limit:Ds},t)),mn.push(e.subscribeMany(Dn,{kinds:[We.APP_STACK],...zn,limit:wp},t)),console.log("[Service] Live subscriptions started")}function ty(){for(const e of mn)try{e.close()}catch{}if(mn=[],wn&&(clearTimeout(wn),wn=null),vn.length>0){const e=vn;vn=[],Vr(e).catch(()=>{})}console.log("[Service] Live subscriptions stopped")}async function Xe(e,t,r={}){const{timeout:o=5e3,signal:s}=r;return s?.aborted?[]:new Promise(c=>{const f=[];let d=!1,h=null,m=null;const v=async()=>{if(!d){d=!0,h&&clearTimeout(h),m&&clearTimeout(m);try{C?.close()}catch{}f.length>0&&await Vr(f).catch(N=>console.error("[Service] Failed to persist events:",N)),c(f)}},C=$o().subscribeMany(e,t,{onevent(N){N?.id&&f.push(N)},oneose(){h||(h=setTimeout(v,Ep))},onclose(){d||v()}});s?.addEventListener("abort",v,{once:!0}),m=setTimeout(v,o)})}async function ny(e,t,r={}){const{limit:o=50,timeout:s=5e3,signal:c}=r;if(c?.aborted||!t.trim())return[];const f={kinds:[32267],search:t.trim(),...zn,limit:o};return Xe(e,f,{timeout:s,signal:c})}async function ry(e,t,r={}){const{limit:o=50,timeout:s=5e3,signal:c}=r;if(c?.aborted||!t)return[];const f={kinds:[32267],authors:[t],...zn,limit:o};return Xe(e,f,{timeout:s,signal:c})}async function iy(e,t,r,o={}){const{timeout:s=5e3,signal:c}=o;if(c?.aborted||!t||!r)return null;const f={kinds:[32267],authors:[t],"#d":[r],...zn,limit:1},d=await Xe(e,f,{timeout:s,signal:c});return d.length>0?d[0]:null}async function oy(e,t={}){const{limit:r=25,until:o,timeout:s=5e3,signal:c}=t;if(c?.aborted)return[];const f={kinds:[30063],limit:r};return o!=null&&!isNaN(o)&&(f.until=Number(o)),Xe(e,f,{timeout:s,signal:c})}async function sy(e,t={}){const{timeout:r=5e3,signal:o}=t;return o?.aborted||!e?null:(await Ap([e],{timeout:r,signal:o})).get(e)??null}async function Ap(e,t={}){const{timeout:r=5e3,signal:o}=t,s=new Map;if(!e||e.length===0||o?.aborted)return s;const c=[...new Set(e.map(h=>String(h).trim().toLowerCase()).filter(h=>/^[a-f0-9]{64}$/.test(h)))],f=await Br({kinds:[0],authors:c});for(const h of f){const m=h.pubkey?.toLowerCase();m&&!s.has(m)&&s.set(m,h)}const d=c.filter(h=>!s.has(h));if(d.length>0&&typeof window<"u")try{const h=[...Mo,...Dn],m=await Xe(h,{kinds:[0],authors:d,limit:d.length*2},{timeout:r,signal:o});for(const v of m){const b=v.pubkey?.toLowerCase();if(!b)continue;const C=s.get(b);(!C||v.created_at>C.created_at)&&s.set(b,v)}}catch{}return s}const zr=[...Mo];async function ay(e,t,r=32267){if(!e||!t)return[];const o=`${r}:${e}:${t}`,s=await Br({kinds:[1111],"#a":[o],limit:500}),c=await Br({kinds:[1111],"#A":[o],limit:500}),f=new Map;for(const d of[...s,...c])f.has(d.id)||f.set(d.id,d);return Array.from(f.values()).sort((d,h)=>h.created_at-d.created_at)}async function cy(e,t,r={}){const{timeout:o=5e3,signal:s,relays:c=zr,aTagKind:f=32267}=r;if(s?.aborted||!e||!t)return[];const d=`${f}:${e}:${t}`,h={kinds:[1111],"#a":[d],limit:500},m={kinds:[1111],"#A":[d],limit:500},[v,b]=await Promise.all([Xe(c,h,{timeout:o,signal:s}),Xe(c,m,{timeout:o,signal:s})]),C=new Map;for(const N of[...v,...b])C.has(N.id)||C.set(N.id,N);return Array.from(C.values()).sort((N,L)=>L.created_at-N.created_at)}const Hs=100;async function uy(e,t={}){if(e.length===0)return[];const{timeout:r=5e3,signal:o,relays:s=zr}=t,c=new Map;for(let f=0;f<e.length;f+=Hs){const d=e.slice(f,f+Hs),m=await Xe(s,{kinds:[1111],"#e":d,limit:500},{timeout:r,signal:o});for(const v of m)c.set(v.id,v)}return Array.from(c.values())}async function ly(e,t,r={}){const{timeout:o=5e3,signal:s,relays:c=zr}=r;if(s?.aborted||!e||!t)return[];const f=`32267:${e}:${t}`,d=new Map,h=[{kinds:[9735],"#a":[f],limit:100},{kinds:[9735],"#A":[f],limit:100}],m=await Promise.all(h.map(b=>Xe(c,b,{timeout:o,signal:s})));for(const b of m)for(const C of b)d.has(C.id)||d.set(C.id,C);const v=(r.eventIds??[]).map(b=>b.trim().toLowerCase()).filter(b=>/^[a-f0-9]{64}$/.test(b));if(v.length>0&&!s?.aborted){const b={kinds:[9735],"#e":v,limit:100},C={kinds:[9735],"#E":v,limit:100},[N,L]=await Promise.all([Xe(c,b,{timeout:o,signal:s}),Xe(c,C,{timeout:o,signal:s})]);for(const O of[...N,...L])d.has(O.id)||d.set(O.id,O)}return Array.from(d.values()).sort((b,C)=>C.created_at-b.created_at)}function fy(e){const t={senderPubkey:null,recipientPubkey:null,amountSats:0,comment:"",emojiTags:[],createdAt:e.created_at,zappedEventId:null},r=e.tags.find(f=>f[0]==="p");r?.[1]&&(t.recipientPubkey=r[1]);const o=e.tags.find(f=>f[0]==="bolt11");if(o?.[1]){const d=o[1].toLowerCase().match(/^lnbc(\d+)([munp]?)/);if(d){const h=parseInt(d[1],10);switch(d[2]||""){case"m":t.amountSats=h*1e5;break;case"u":t.amountSats=h*100;break;case"n":t.amountSats=Math.round(h/10);break;case"p":t.amountSats=Math.round(h/1e4);break;default:t.amountSats=h*1e8;break}}}const s=e.tags.find(f=>f[0]?.toLowerCase()==="e"&&!!f[1]);s?.[1]&&(t.zappedEventId=s[1].toLowerCase());const c=e.tags.find(f=>f[0]==="description");if(c?.[1])try{const f=JSON.parse(c[1]);if(t.senderPubkey=f.pubkey,t.comment=f.content||"",t.zappedEventId==null){const h=f.tags?.find(m=>m[0]==="e"&&!!m[1]);h?.[1]&&(t.zappedEventId=h[1].toLowerCase())}const d=new Set;for(const h of f.tags??[])h[0]==="emoji"&&h[1]&&h[2]&&!d.has(h[1])&&(d.add(h[1]),t.emojiTags.push({shortcode:h[1],url:h[2]}))}catch{}return t}async function hy(e,t,r,o,s,c,f){if(!e?.trim())throw new Error("Comment content is required");if(!t?.pubkey?.trim()||!t?.identifier?.trim())throw new Error("Comment target (pubkey, identifier) is required");const d=32267,h=30267,m=t.contentType==="app"?`${d}:${t.pubkey}:${t.identifier}`:`${h}:${t.pubkey}:${t.identifier}`,v=t.contentType==="app"?d:h,b=[["a",m],["A",m],["K",String(v)],["P",t.pubkey.trim().toLowerCase()]];if(s){const R=s.trim().toLowerCase();if(!/^[a-f0-9]{64}$/.test(R))throw new Error(`Invalid parent event id: ${s.slice(0,20)}...`);b.push(["e",R]),b.push(["k",String(f??1111)]),c&&b.push(["p",c.trim().toLowerCase()])}const C=o??[];if(C.length>0){const R=new Set;for(const{shortcode:$,url:F}of C)$&&F&&!R.has($)&&(R.add($),b.push(["emoji",$,F]))}const N={kind:1111,content:e.trim(),tags:b,created_at:Math.floor(Date.now()/1e3)},L=await r(N),O=$o();return await Promise.allSettled(O.publish(zr,L)),await Vr([L]),L}function dy(e){const t=e.tags.filter(f=>(f[0]==="e"||f[0]==="E")&&!!f[1]),o=t.find(f=>f[3]==="reply")?.[1]??t[t.length-1]?.[1]??null,s=[];for(const f of e.tags)f[0]==="emoji"&&f[1]&&f[2]&&s.push({shortcode:f[1],url:f[2]});const c=e.content.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>");return{id:e.id,pubkey:e.pubkey,content:e.content,contentHtml:`<p>${c}</p>`,emojiTags:s,createdAt:e.created_at,parentId:o,isReply:o!==null}}function py(e){const t=e.tags.find(f=>f[0]==="d")?.[1]??"";let r={};try{r=JSON.parse(e.content)}catch{r={description:e.content}}const o=nn.naddrEncode({kind:We.APP,pubkey:e.pubkey,identifier:t}),s=nn.npubEncode(e.pubkey),c=r.description??"";return{id:e.id,pubkey:e.pubkey,npub:s,dTag:t,name:e.tags.find(f=>f[0]==="name")?.[1]??r.name??t,description:c,descriptionHtml:c?`<p>${c.replace(/\n/g,"</p><p>")}</p>`:void 0,icon:e.tags.find(f=>f[0]==="icon")?.[1]??r.icon,images:e.tags.filter(f=>f[0]==="image").map(f=>f[1]),platform:e.tags.find(f=>f[0]==="platform")?.[1]??r.platform??"Android",repository:e.tags.find(f=>f[0]==="repository")?.[1]??r.repository,license:e.tags.find(f=>f[0]==="license")?.[1]??r.license,url:e.tags.find(f=>f[0]==="url")?.[1]??r.url,createdAt:e.created_at,naddr:o}}function Sp(e,t){if(e)return e;const r=t.lastIndexOf("@");return r!==-1&&r<t.length-1?t.slice(r+1):t}function yy(e){const t=e.tags.find(h=>h[0]==="d")?.[1]??"",r=e.tags.find(h=>h[0]==="a")?.[1]??"",o=e.tags.find(h=>h[0]==="version")?.[1],s=Sp(o,t),c=e.tags.find(h=>h[0]==="url")?.[1],f=r.split(":")[2]??"",d=e.content||void 0;return{id:e.id,pubkey:e.pubkey,dTag:t,appDTag:f,version:s,releaseNotes:d,notes:d,notesHtml:d?`<p>${d.replace(/\n/g,"</p><p>")}</p>`:void 0,artifacts:e.tags.filter(h=>h[0]==="e").map(h=>h[1]),createdAt:e.created_at,url:c}}function gy(e){let t={};try{t=JSON.parse(e.content)}catch{t={}}return{pubkey:e.pubkey,name:t.name,displayName:t.display_name,picture:t.picture,about:t.about,nip05:t.nip05,lud16:t.lud16,createdAt:e.created_at}}function my(e){const t=e.tags.find(d=>d[0]==="d")?.[1]??"",r=e.tags.find(d=>d[0]==="title")?.[1]??e.tags.find(d=>d[0]==="name")?.[1]??t,o=e.content||"",s=e.tags.find(d=>d[0]==="image")?.[1],c=e.tags.filter(d=>d[0]==="a").map(d=>{const h=d[1]?.split(":")??[];return{kind:parseInt(h[0]??"0",10),pubkey:h[1]??"",identifier:h[2]??""}}).filter(d=>d.pubkey&&d.identifier),f=nn.naddrEncode({kind:We.APP_STACK,pubkey:e.pubkey,identifier:t});return{id:e.id,pubkey:e.pubkey,dTag:t,title:r,description:o,image:s,appRefs:c,createdAt:e.created_at,naddr:f}}function by(e,t){return nn.naddrEncode({kind:We.APP,pubkey:e,identifier:t})}function vy(e,t){return nn.naddrEncode({kind:We.APP_STACK,pubkey:e,identifier:t})}function wy(e){try{const t=nn.decode(e);if(t.type==="naddr")return{kind:t.data.kind,pubkey:t.data.pubkey,identifier:t.data.identifier}}catch{}return null}function Ey(e){const t=e.trim().toUpperCase();if(t.length===0)return{r:128,g:128,b:128};let r=BigInt(0);for(let R=0;R<t.length;R++){const $=BigInt(t.charCodeAt(R)),F=BigInt(256)**BigInt(R);r=r+$*F}const o=Number(r%BigInt(360)),s=o/60,c=.7,f=o>=32&&o<=204?.7:o>=216&&o<=273?.96:.9,d=f*c,h=d*(1-Math.abs(s%2-1)),m=f-d;let v,b,C;s<1?(v=d,b=h,C=0):s<2?(v=h,b=d,C=0):s<3?(v=0,b=d,C=h):s<4?(v=0,b=h,C=d):s<5?(v=h,b=0,C=d):(v=d,b=0,C=h);const N=Math.round((v+m)*255),L=Math.round((b+m)*255),O=Math.round((C+m)*255);return{r:N,g:L,b:O}}function xy(e){if(!e||!/^[0-9a-fA-F]+$/.test(e))return{r:128,g:128,b:128};const t=BigInt(`0x${e}`),r=Number(t%BigInt(360)),o=r/60,s=.7,c=r>=32&&r<=204?.75:r>=216&&r<=273?.96:.9,f=c*s,d=f*(1-Math.abs(o%2-1)),h=c-f;let m,v,b;o<1?(m=f,v=d,b=0):o<2?(m=d,v=f,b=0):o<3?(m=0,v=f,b=d):o<4?(m=0,v=d,b=f):o<5?(m=d,v=0,b=f):(m=f,v=0,b=d);const C=Math.round((m+h)*255),N=Math.round((v+h)*255),L=Math.round((b+h)*255);return{r:C,g:N,b:L}}function Tp(e,t){return{r:Math.min(255,Math.max(0,Math.round(e.r*t))),g:Math.min(255,Math.max(0,Math.round(e.g*t))),b:Math.min(255,Math.max(0,Math.round(e.b*t)))}}function _y(e,t){return Tp(e,t?1.08:.95)}function ky(e){return`rgb(${e.r}, ${e.g}, ${e.b})`}var Ip=iu('<div role="status" aria-label="Loading..."><span class="sr-only svelte-y9vpsa">Loading...</span></div>');function Ay(e,t){let r=su(t,"className",8,"");var o=Ip();nu(()=>ou(o,1,`skeleton-loader ${r()??""}`,"svelte-y9vpsa")),ru(e,o)}export{bp as A,dy as B,cy as C,Dn as D,We as E,hy as F,ey as G,Qp as H,ty as I,yy as J,ly as K,fy as L,uy as M,Gl as N,xn as O,zn as P,Ke as Q,tn as R,vp as S,cp as T,qn as U,rn as V,Rh as W,Mo as X,Vr as a,iy as b,qp as c,my as d,Ay as e,oy as f,_y as g,xy as h,Lp as i,ny as j,by as k,jp as l,Ap as m,nn as n,gy as o,py as p,Br as q,ky as r,Ey as s,Xe as t,vy as u,sy as v,ry as w,wy as x,Xp as y,ay as z};
