import{a as Ge,x as He,y as he,E as q,d as ye,t as Xe,D as We,P as Ve,m as Se,o as Qe,n as O,z as $e,B as se,q as et,p as tt,C as at,e as Y,i as xe,k as je,u as rt,F as st}from"../chunks/CFWGTvxy.js";import"../chunks/DsnmJJEf.js";import{o as ot}from"../chunks/D3QfO92x.js";import{p as nt,j as S,K as oe,e as ne,s as T,a as x,b as it,t as J,ac as lt,f as j,h as e,i as n,$ as ct,c,r as l,ab as b,n as G}from"../chunks/BjvSjcul.js";import{s as H}from"../chunks/Bq_urSBn.js";import{i as K}from"../chunks/BzP6EuCB.js";import{e as X,a as W}from"../chunks/DdQPfq-y.js";import{h as dt}from"../chunks/D1qDpKgB.js";import{s as pt}from"../chunks/CW0Rmjp7.js";import{b as ut}from"../chunks/DK2YmtLx.js";import{s as vt,a as mt}from"../chunks/Cv4tKeMm.js";import{p as ft}from"../chunks/BeOLnvA-.js";import{b as Te,A as gt}from"../chunks/DBzRdpWB.js";import{b as kt}from"../chunks/DGij43mE.js";import{i as _t}from"../chunks/6UbeEZpn.js";import{w as Ae}from"../chunks/BXdq22aZ.js";import{D as Ee,S as bt,B as ht,c as yt}from"../chunks/BL4U3kE8.js";import{g as ie,s as St,c as xt,a as jt}from"../chunks/NIlIHDGW.js";const Tt=!1,At=async({params:C})=>({stack:null,apps:[],error:null,seedEvents:[]}),ra=Object.freeze(Object.defineProperty({__proto__:null,load:At,prerender:Tt},Symbol.toStringTag,{value:"Module"}));function Et(C){!Array.isArray(C)||C.length===0||Ge(C).catch(h=>console.error("[CacheWriter] Background persist failed:",h))}var wt=j('<meta name="description"/>'),Pt=j('<div class="skeleton-card svelte-lakxjo"><div class="skeleton-icon svelte-lakxjo"><!></div> <div class="skeleton-info svelte-lakxjo"><div class="skeleton-name svelte-lakxjo"><!></div> <div class="skeleton-desc-small svelte-lakxjo"></div></div></div>'),Ct=j('<div class="app-column svelte-lakxjo"></div>'),Nt=j('<div class="skeleton-publisher-row svelte-lakxjo"><div class="skeleton-publisher svelte-lakxjo"><div class="skeleton-avatar svelte-lakxjo"><!></div> <div class="skeleton-name-small svelte-lakxjo"></div></div></div> <div class="stack-header-skeleton svelte-lakxjo"><div class="skeleton-title svelte-lakxjo"><!></div> <div class="skeleton-desc svelte-lakxjo"></div></div> <div class="section-container svelte-lakxjo"><div class="horizontal-scroll svelte-lakxjo"><div class="scroll-content svelte-lakxjo"></div></div></div>',1),It=j('<div class="flex items-center justify-center py-24"><div class="text-center"><div class="rounded-lg bg-destructive/10 border border-destructive/20 p-6 max-w-md"><h3 class="text-lg font-semibold text-destructive mb-2">Error Loading Stack</h3> <p class="text-muted-foreground mb-4"> </p> <a href="/discover" class="btn-primary">Back to Discover</a></div></div></div>'),Lt=j('<span class="stack-page-app-count svelte-lakxjo"> </span>'),Ot=j('<div class="app-column svelte-lakxjo"></div>'),Ft=j('<div class="horizontal-scroll svelte-lakxjo"><div class="scroll-content svelte-lakxjo"></div></div>'),Dt=j('<div class="placeholder-content svelte-lakxjo"><p class="text-muted-foreground text-sm">No apps found in this stack.</p></div>'),zt=j('<div class="stack-header svelte-lakxjo"><h1 class="stack-title svelte-lakxjo"> </h1> <div class="stack-desc-row svelte-lakxjo"><p class="stack-description svelte-lakxjo"> </p> <!></div></div> <div class="section-container svelte-lakxjo"><!></div> <div class="mb-8"><!></div>',1),Rt=j('<!> <section class="stack-page svelte-lakxjo"><div class="container mx-auto px-4 sm:px-6 lg:px-8 pt-4 pb-24"><!></div></section> <!>',1);function sa(C,h){nt(h,!0);const le=()=>mt(ft,"$page",we),[we,Pe]=vt(),ce=[{name:"Zapstore",pictureUrl:"https://zapstore.dev/zapstore-icon.png",pubkey:"78ce6faa72264387284e647ba6938995735ec8c7d5c5a65737e55f2fe2202182"}];let r=S(null),w=S(oe([])),V=S(!1),N=S(null),m=S(oe([])),Q=S(!1),U=S(""),I=S(!1),F=S(oe({})),$=S(!1);const de=b(()=>xt(()=>ie())),pe=b(()=>yt(ie())),ue=b(()=>le().params.naddr);let D=S(null);kt(()=>{const t={scrollY:window.scrollY,appsScrollX:e(D)?.scrollLeft??0,timestamp:Date.now(),stackNaddr:e(ue)};sessionStorage.setItem("stack_detail_scroll",JSON.stringify(t))});let z=null;function Ce(){const t=sessionStorage.getItem("stack_detail_scroll");if(t){try{const a=JSON.parse(t);Date.now()-a.timestamp<300*1e3&&a.stackNaddr===e(ue)&&(z=a,a.scrollY>0&&window.scrollTo(0,a.scrollY),ve())}catch{}sessionStorage.removeItem("stack_detail_scroll")}}function ve(){z&&(e(D)&&z.appsScrollX>0?(e(D).scrollLeft=z.appsScrollX,z=null):requestAnimationFrame(ve))}ot(()=>{n(r,h.data.stack??null,!0),n(w,h.data.apps??[],!0),n(N,h.data.error??null,!0),Ne(),Ce()});async function Ne(){try{n(N,null);let t=h.data.stack;const a=Te?He(le().params.naddr):null;if(!t&&a){const o=await he({kinds:[q.APP_STACK],authors:[a.pubkey],"#d":[a.identifier]});o&&(t=ye(o))}if(!t&&Te&&a&&_t()){n(V,!0);const o=await Xe(We,{kinds:[q.APP_STACK],authors:[a.pubkey],"#d":[a.identifier],...Ve,limit:1});o.length>0&&(t=ye(o[0]))}if(!t){n(N,h.data.error??"Stack not found",!0);return}Et(h.data.seedEvents??[]);let i=null;const s=t.pubkey;if(s)try{const o=(await Se([s])).get(s)??null;if(o){const d=Qe(o);i={name:d?.displayName||d?.name,picture:d?.picture,pubkey:s,npub:O.npubEncode(s)}}else i={name:void 0,picture:void 0,pubkey:s,npub:O.npubEncode(s)}}catch{i={name:void 0,picture:void 0,pubkey:s,npub:O.npubEncode(s)}}n(r,{...t,creator:i},!0);const p=await $e(t.pubkey,t.dTag,q.APP_STACK);if(p.length>0){n(m,p.map(se),!0);const o={...e(F)},d=[...new Set(e(m).map(u=>u.pubkey))];for(const u of d){const k=await he({kinds:[0],authors:[u]});if(k?.content)try{const v=JSON.parse(k.content);o[u]={displayName:v.display_name??v.name,name:v.name,picture:v.picture}}catch{}}n(F,o,!0)}if(Ie(t.pubkey,t.dTag),h.data.apps?.length>0)n(w,h.data.apps,!0);else if(t.appRefs?.length>0){const o=t.appRefs.filter(d=>d.kind===32267).map(d=>d.identifier);if(o.length>0){const d=await et({kinds:[32267],"#d":o});n(w,d.map(tt),!0)}}}catch(t){console.error("Error loading stack:",t),n(N,t instanceof Error?t.message:"Unknown error",!0)}finally{n(V,!1)}}async function Ie(t,a){e(m).length>0||n(Q,!0),n(U,"");try{const s=await at(t,a,{aTagKind:q.APP_STACK});n(m,s.map(se),!0);const p=[...new Set(e(m).map(u=>u.pubkey))];n($,!0);const o={...e(F)},d=await Se(p);for(const u of p){const k=d.get(u);if(!k?.content){o[u]=o[u]??null;continue}try{const v=JSON.parse(k.content);o[u]={displayName:v.display_name??v.name,name:v.name,picture:v.picture}}catch{o[u]=o[u]??null}}n(F,o,!0)}catch(s){n(U,"Failed to load comments"),console.error(s)}finally{n(Q,!1),n($,!1)}}async function me(t){const a=ie();if(!a||!e(r))return;const{text:i,emojiTags:s,parentId:p,replyToPubkey:o,rootPubkey:d,parentKind:u}=t,k=`pending-${Date.now()}`,v={id:k,pubkey:a,content:i,contentHtml:"",emojiTags:s??[],createdAt:Math.floor(Date.now()/1e3),parentId:p??null,isReply:p!=null,pending:!0,npub:O.npubEncode(a)};n(m,[...e(m),v],!0);try{const f=await st(i,{contentType:"stack",pubkey:e(r).pubkey,identifier:e(r).dTag},St,s,p,o??d,u),A=se(f);A.npub=O.npubEncode(f.pubkey),n(m,e(m).filter(P=>P.id!==k),!0),n(m,[...e(m),A],!0)}catch(f){console.error("Failed to publish comment:",f),n(m,e(m).filter(A=>A.id!==k),!0),n(U,f instanceof Error?f.message:"Comment could not be published to any relay.",!0)}}function Le(t){return`/apps/${je(t.pubkey,t.dTag)}`}function Oe(t,a=3){const i=[];for(let s=0;s<t.length;s+=a)i.push(t.slice(s,s+a));return i}const Fe=b(()=>Oe(e(w),3));function fe(t){return t?t.charAt(0).toUpperCase()+t.slice(1):""}function De(t,a=5){if(!t)return"";const i=t.trim().split(/\s+/),s=i.slice(0,a).join(" ");return i.length>a?s+"…":s}function ze(t,a){return!t||!a?!1:t.toLowerCase().trim()===a.toLowerCase().trim()}const ee=b(()=>fe(e(r)?.title)||fe(De(e(r)?.description,5))||"Untitled Stack"),Re=b(()=>!e(r)?.title||!e(r)?.description||ze(e(r)?.title,e(r)?.description)?`A stack of curated ${e(ee)} applications`:e(r)?.description);var ge=Rt();dt("lakxjo",t=>{var a=wt();J(()=>pt(a,"content",e(r)?.description||"A curated collection of apps on Zapstore")),lt(()=>{ct.title=`${(e(r)?.title||"Stack")??""} — Zapstore`}),x(t,a)});var ke=ne(ge);{var Me=t=>{{let a=b(()=>e(r).creator?.npub?`/profile/${e(r).creator.npub}`:"#");Ee(t,{get publisherPic(){return e(r).creator.picture},get publisherName(){return e(r).creator.name},get publisherPubkey(){return e(r).creator.pubkey},get publisherUrl(){return e(a)},get timestamp(){return e(r).createdAt},get catalogs(){return ce},catalogText:"In Zapstore",showPublisher:!0,get getStartedModalOpen(){return e(I)},set getStartedModalOpen(i){n(I,i,!0)}})}},Be=t=>{Ee(t,{get catalogs(){return ce},catalogText:"In Zapstore",showPublisher:!1,get getStartedModalOpen(){return e(I)},set getStartedModalOpen(a){n(I,a,!0)}})};K(ke,t=>{e(r)?.creator?t(Me):e(r)&&t(Be,1)})}var te=T(ke,2),_e=c(te),Ke=c(_e);{var Ue=t=>{var a=Nt(),i=ne(a),s=c(i),p=c(s),o=c(p);Y(o,{}),l(p),G(2),l(s),l(i);var d=T(i,2),u=c(d),k=c(u);Y(k,{}),l(u),G(2),l(d);var v=T(d,2),f=c(v),A=c(f);X(A,20,()=>Array(3),W,(P,be)=>{var L=Ct();X(L,20,()=>Array(3),W,(ae,_,g,E)=>{var y=Pt(),R=c(y),M=c(R);Y(M,{}),l(R);var Z=T(R,2),B=c(Z),re=c(B);Y(re,{}),l(B),G(2),l(Z),l(y),x(ae,y)}),l(L),x(P,L)}),l(A),l(f),xe(f,P=>Ae?.(P)),l(v),x(t,a)},Ze=t=>{var a=It(),i=c(a),s=c(i),p=T(c(s),2),o=c(p,!0);l(p),G(2),l(s),l(i),l(a),J(()=>H(o,e(N))),x(t,a)},qe=t=>{var a=zt(),i=ne(a),s=c(i),p=c(s,!0);l(s);var o=T(s,2),d=c(o),u=c(d,!0);l(d);var k=T(d,2);{var v=_=>{var g=Lt(),E=c(g);l(g),J(()=>H(E,`${e(w).length??""} Apps`)),x(_,g)};K(k,_=>{e(w).length>0&&_(v)})}l(o),l(i);var f=T(i,2),A=c(f);{var P=_=>{var g=Ft(),E=c(g);X(E,21,()=>e(Fe),W,(y,R)=>{var M=Ot();X(M,21,()=>e(R),W,(Z,B)=>{{let re=b(()=>Le(e(B)));gt(Z,{get app(){return e(B)},get href(){return e(re)}})}}),l(M),x(y,M)}),l(E),l(g),xe(g,y=>Ae?.(y)),ut(g,y=>n(D,y),()=>e(D)),x(_,g)},be=_=>{var g=Dt();x(_,g)};K(A,_=>{e(w).length>0?_(P):_(be,!1)})}l(f);var L=T(f,2),ae=c(L);{let _=b(()=>({pubkey:e(r).pubkey,dTag:e(r).dTag})),g=b(()=>e(r).creator?{displayName:e(r).creator.name,name:e(r).creator.name,picture:e(r).creator.picture}:null);bt(ae,{get stack(){return e(r)},get app(){return e(_)},get getStackSlug(){return rt},getAppSlug:(E,y)=>je(E,y),pubkeyToNpub:E=>O.npubEncode(E),get publisherProfile(){return e(g)},get comments(){return e(m)},get commentsLoading(){return e(Q)},get commentsError(){return e(U)},get profiles(){return e(F)},get profilesLoading(){return e($)},get searchProfiles(){return e(de)},get searchEmojis(){return e(pe)},onCommentSubmit:me,onZapReceived:()=>{},onGetStarted:()=>n(I,!0)})}l(L),J(()=>{H(p,e(ee)),H(u,e(Re))}),x(t,a)};K(Ke,t=>{e(V)?t(Ue):e(N)?t(Ze,1):e(r)&&t(qe,2)})}l(_e),l(te);var Ye=T(te,2);{var Je=t=>{const a=b(()=>e(r)?{name:e(r).title||e(ee),pubkey:e(r).pubkey,dTag:e(r).dTag,id:e(r).id,pictureUrl:e(r).creator?.picture}:null);{let i=b(()=>e(r)?.creator?.name||""),s=b(jt);ht(t,{get publisherName(){return e(i)},contentType:"stack",get zapTarget(){return e(a)},otherZaps:[],get isSignedIn(){return e(s)},onGetStarted:()=>n(I,!0),get searchProfiles(){return e(de)},get searchEmojis(){return e(pe)},oncommentSubmit:p=>me({text:p.text,emojiTags:p.emojiTags,mentions:p.mentions,parentId:void 0}),onzapReceived:()=>{}})}};K(Ye,t=>{e(r)&&t(Je)})}x(C,ge),it(),Pe()}export{sa as component,ra as universal};
