import"../chunks/DsnmJJEf.js";import{o as pe,a as fe}from"../chunks/D3QfO92x.js";import{p as ke,j as x,K as Q,ar as U,i as _,h as a,s as f,c as o,a as c,b as me,g as _e,f as u,$ as ge,r,ab as M,n as G,e as I,d as he}from"../chunks/BjvSjcul.js";import{i as T}from"../chunks/BzP6EuCB.js";import{e as P,a as A}from"../chunks/DdQPfq-y.js";import{h as ye}from"../chunks/D1qDpKgB.js";import{A as be}from"../chunks/Cj3ZQUn7.js";import{m as ze,o as Se,n as Ee,D as q,t as J,e as g,u as xe}from"../chunks/CFWGTvxy.js";import{c as Le,s as we,l as V,g as Ce,i as He}from"../chunks/DlhqLWsV.js";import{g as N,s as X}from"../chunks/Cr_bOBiy.js";const Me=!1,Te=async()=>({seedEvents:[]}),Ve=Object.freeze(Object.defineProperty({__proto__:null,load:Te,prerender:Me},Symbol.toStringTag,{value:"Module"}));var Pe=u('<meta name="description" content="Browse curated app collections on Zapstore"/>'),Ae=u('<div class="skeleton-stack svelte-vto7zu"><div class="skeleton-stack-grid svelte-vto7zu"><!></div> <div class="skeleton-stack-info svelte-vto7zu"><div class="skeleton-stack-name svelte-vto7zu"><!></div> <div class="skeleton-stack-desc svelte-vto7zu"></div> <div class="skeleton-stack-creator svelte-vto7zu"><div class="skeleton-stack-avatar svelte-vto7zu"><!></div> <div class="skeleton-stack-creator-name svelte-vto7zu"></div></div></div></div>'),Ne=u('<div class="stacks-grid svelte-vto7zu"></div>'),Oe=u('<div class="skeleton-stack svelte-vto7zu"><div class="skeleton-stack-grid svelte-vto7zu"><!></div> <div class="skeleton-stack-info svelte-vto7zu"><div class="skeleton-stack-name svelte-vto7zu"><!></div> <div class="skeleton-stack-desc svelte-vto7zu"></div> <div class="skeleton-stack-creator svelte-vto7zu"><div class="skeleton-stack-avatar svelte-vto7zu"><!></div> <div class="skeleton-stack-creator-name svelte-vto7zu"></div></div></div></div>'),je=u(`<p class="end-message svelte-vto7zu">You've reached the end</p>`),De=u('<div class="stacks-grid svelte-vto7zu"><!> <!></div> <!>',1),Re=u('<div class="empty-state svelte-vto7zu"><p class="text-muted-foreground">No app stacks found yet. Create one in the Zapstore app!</p></div>'),Ye=u('<section class="stacks-page svelte-vto7zu"><div class="container mx-auto px-4 sm:px-6 lg:px-8 py-6"><div class="page-header svelte-vto7zu"><h1 class="text-2xl md:text-3xl font-bold">Latest Stacks</h1></div> <!></div></section>');function Xe(W,y){ke(y,!0);const $=800;let b=x(Q(N("stacks")));const O=M(Ce),j=M(He);U(()=>{const e=Le().subscribe({next:t=>{_(b,t,!0),X("stacks",t)},error:t=>console.error("[StacksPage] liveQuery error:",t)});return()=>e.unsubscribe()});let h=x(Q(N("stacks:resolved")??[])),z=x(!N("stacks:resolved")),D=x("");function S(e){return typeof e=="string"&&/^[0-9a-f]{64}$/i.test(e.trim())}function ee(e){return typeof e=="string"&&e.trim().length>0}function te(e,t){if(!S(e)||!ee(t))return"";try{return xe(e.trim().toLowerCase(),t.trim())}catch{return""}}function se(e){if(!S(e))return"";try{return Ee.npubEncode(e.trim().toLowerCase())}catch{return""}}function ae(e){const t=te(e?.pubkey,e?.dTag);return t?`/stacks/${t}`:"#"}async function re(e){if(e.length===0){_(z,!1);return}_(z,!0);try{const t=[...new Set(e.map(s=>s.stack.pubkey).filter(s=>S(s)))],i=await ze(t);_(h,e.map(({stack:s,apps:p})=>{let d;if(S(s.pubkey)){const k=i.get(s.pubkey);if(k){const l=Se(k);d={name:l.displayName||l.name,picture:l.picture,pubkey:s.pubkey,npub:se(s.pubkey)}}}return{name:s.title,description:s.description,apps:p,creator:d,pubkey:s.pubkey,dTag:s.dTag}}),!0),X("stacks:resolved",a(h))}catch(t){console.error("Error resolving stacks:",t)}finally{_(z,!1)}}U(()=>{if(a(b)===null)return;const e=a(b).map(t=>t.stack.id).join(",");e!==a(D)&&(_(D,e,!0),re(a(b)))});function oe(){const e=window.scrollY||document.documentElement.scrollTop,t=document.documentElement.scrollHeight,i=window.innerHeight;return t-e-i<$}function R(){a(O)&&!a(j)&&oe()&&V(J,q)}pe(async()=>{we(y.data.seedEvents??[]),(!y.data.seedEvents||y.data.seedEvents.length===0)&&navigator.onLine&&await V(J,q),window.addEventListener("scroll",R,{passive:!0})}),fe(()=>{window.removeEventListener("scroll",R)});var L=Ye();ye("vto7zu",e=>{var t=Pe();_e(()=>{ge.title="App Stacks â€” Zapstore"}),c(e,t)});var Y=o(L),ne=f(o(Y),2);{var ie=e=>{var t=Ne();P(t,20,()=>[1,2,3],A,(i,s)=>{var p=Ae(),d=o(p),k=o(d);g(k,{}),r(d);var l=f(d,2),n=o(l),v=o(n);g(v,{}),r(n);var m=f(n,4),E=o(m),Z=o(E);g(Z,{}),r(E),G(2),r(m),r(l),r(p),c(i,p)}),r(t),c(e,t)},ve=e=>{var t=De(),i=I(t),s=o(i);P(s,17,()=>a(h),A,(n,v)=>{{let m=M(()=>ae(a(v)));be(n,{get stack(){return a(v)},get href(){return a(m)}})}});var p=f(s,2);{var d=n=>{var v=he(),m=I(v);P(m,16,()=>[1,2,3,4,5,6],A,(E,Z)=>{var w=Oe(),C=o(w),de=o(C);g(de,{}),r(C);var B=f(C,2),H=o(B),le=o(H);g(le,{}),r(H);var F=f(H,4),K=o(F),ue=o(K);g(ue,{}),r(K),G(2),r(F),r(B),r(w),c(E,w)}),c(n,v)};T(p,n=>{a(j)&&n(d)})}r(i);var k=f(i,2);{var l=n=>{var v=je();c(n,v)};T(k,n=>{a(O)||n(l)})}c(e,t)},ce=e=>{var t=Re();c(e,t)};T(ne,e=>{a(z)&&a(h).length===0?e(ie):a(h).length>0?e(ve,1):e(ce,!1)})}r(Y),r(L),c(W,L),me()}export{Xe as component,Ve as universal};
